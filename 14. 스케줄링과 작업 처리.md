# 14. ìŠ¤ì¼€ì¤„ë§ê³¼ ì‘ì—… ì²˜ë¦¬

## `@Scheduled`, `@EnableScheduling`

Spring FrameworkëŠ” **ìŠ¤ì¼€ì¤„ë§ ê¸°ëŠ¥**ì„ ê¸°ë³¸ ì œê³µí•œë‹¤.
 `@Scheduled`ì™€ `@EnableScheduling` ì–´ë…¸í…Œì´ì…˜ì„ í™œìš©í•˜ë©´ ê°„ë‹¨í•˜ê²Œ **ì£¼ê¸°ì ì¸ ì‘ì—…(ë°°ì¹˜, ëª¨ë‹ˆí„°ë§, ì•Œë¦¼ ë“±)ì„ ìë™ìœ¼ë¡œ ì‹¤í–‰**í•  ìˆ˜ ìˆë‹¤.

êµ¬í˜„ì´ ë§¤ìš° ê°„ë‹¨í•˜ë©°, ë³„ë„ ì™¸ë¶€ ìŠ¤ì¼€ì¤„ëŸ¬ ì—†ì´ **Spring Context** ë‚´ì—ì„œ ê´€ë¦¬ëœë‹¤.

------

### 1ï¸âƒ£ ê¸°ë³¸ êµ¬ì„±

#### `@EnableScheduling`

- ìŠ¤ì¼€ì¤„ë§ ê¸°ëŠ¥ì„ í™œì„±í™”í•˜ëŠ” ì–´ë…¸í…Œì´ì…˜.
- ì¼ë°˜ì ìœ¼ë¡œ **Configuration í´ë˜ìŠ¤**ì— ì„ ì–¸.

```
@Configuration
@EnableScheduling
public class SchedulingConfig {
    // ë¹ˆ ë“±ë¡ì´ë‚˜ ë³„ë„ ì„¤ì • ê°€ëŠ¥
}
```

ì´ ì–´ë…¸í…Œì´ì…˜ì´ ì„ ì–¸ë˜ì–´ ìˆì–´ì•¼ `@Scheduled`ê°€ ì •ìƒ ë™ì‘í•œë‹¤.
 â†’ ìŠ¤í”„ë§ì´ ë‚´ë¶€ì ìœ¼ë¡œ **TaskScheduler**ë¥¼ ë“±ë¡í•œë‹¤.

------

#### `@Scheduled`

- ì£¼ê¸°ì ìœ¼ë¡œ ì‹¤í–‰í•  **ë©”ì„œë“œì— ì ìš©**í•˜ëŠ” ì–´ë…¸í…Œì´ì…˜.

```
@Component
public class ScheduledTasks {

    @Scheduled(fixedRate = 5000)  // 5ì´ˆë§ˆë‹¤ ì‹¤í–‰
    public void reportCurrentTime() {
        System.out.println("í˜„ì¬ ì‹œê°„: " + LocalDateTime.now());
    }
}
```

ğŸ“ ì£¼ì˜: `@Scheduled`ê°€ ë¶™ì€ ë©”ì„œë“œëŠ” **ë°˜ë“œì‹œ void ë¦¬í„´**, ì¸ì ì—†ì–´ì•¼ í•¨.
 (Springì´ í”„ë¡ì‹œë¡œ ê°ì‹¸ì„œ ìŠ¤ì¼€ì¤„ë§í•˜ê¸° ë•Œë¬¸)

------

### 2ï¸âƒ£ ì£¼ìš” ì†ì„± ì •ë¦¬ ğŸ—‚ï¸

| ì†ì„±ëª…         | ì„¤ëª…                                           | ì˜ˆì‹œ                                             |
| -------------- | ---------------------------------------------- | ------------------------------------------------ |
| `fixedRate`    | ì´ì „ ì‹¤í–‰ ì‹œì‘ ì‹œì  ê¸°ì¤€ **ê³ ì • ì£¼ê¸°**ë¡œ ì‹¤í–‰  | `fixedRate = 5000` â†’ 5ì´ˆë§ˆë‹¤ ì‹¤í–‰                |
| `fixedDelay`   | ì´ì „ ì‹¤í–‰ ì¢…ë£Œ ì‹œì  ê¸°ì¤€ **ê³ ì • ì§€ì—° í›„** ì‹¤í–‰ | `fixedDelay = 5000` â†’ ì‹¤í–‰ ëë‚œ í›„ 5ì´ˆ í›„ ì¬ì‹¤í–‰ |
| `initialDelay` | ì²˜ìŒ ì‹¤í–‰ê¹Œì§€ ëŒ€ê¸° ì‹œê°„                        | `initialDelay = 10000` â†’ 10ì´ˆ í›„ ì²« ì‹¤í–‰         |
| `cron`         | cron í‘œí˜„ì‹ ê¸°ë°˜ìœ¼ë¡œ ì •êµí•˜ê²Œ ìŠ¤ì¼€ì¤„ë§         | `cron = "0 0 * * * *"` â†’ ë§¤ ì •ì‹œë§ˆë‹¤ ì‹¤í–‰        |

------

### 3ï¸âƒ£ cron í‘œí˜„ì‹ í™œìš© ğŸŒŸ

í˜•ì‹: `second minute hour day-of-month month day-of-week [year]`

#### ì˜ˆì‹œ

| cron í‘œí˜„ì‹           | ì˜ë¯¸                  |
| --------------------- | --------------------- |
| `"0 * * * * *"`       | ë§¤ ë¶„ 0ì´ˆë§ˆë‹¤         |
| `"0 0 * * * *"`       | ë§¤ ì •ì‹œë§ˆë‹¤           |
| `"0 0 9 * * *"`       | ë§¤ì¼ ì˜¤ì „ 9ì‹œ         |
| `"0 0 9 * * MON-FRI"` | ì›”~ê¸ˆ ì˜¤ì „ 9ì‹œì— ì‹¤í–‰ |
| `"0 0/5 * * * *"`     | ë§¤ 5ë¶„ë§ˆë‹¤            |

#### êµ¬ì„±ìš”ì†Œ ì„¤ëª…:

- `0` ì´ˆ ë‹¨ìœ„ (0ì´ˆë¶€í„° ì‹œì‘)
- `*` ì „ì²´ ë²”ìœ„
- `0/5` 5ë¶„ ê°„ê²©

ì°¸ê³  ì‚¬ì´íŠ¸ â†’ https://crontab.guru/
 (ì‹¤ì‹œê°„ cron í‘œí˜„ì‹ ê²€ì¦ ê°€ëŠ¥ ğŸ”)

------

### 4ï¸âƒ£ ì‹¤ì „ ì˜ˆì œ

#### ê³ ì • ì£¼ê¸° ì‹¤í–‰

```
@Scheduled(fixedRate = 10000)
public void sendHeartbeat() {
    System.out.println("Heartbeat ì „ì†¡: " + LocalDateTime.now());
}
```

#### ì´ˆê¸° ì§€ì—° + ê³ ì • ë”œë ˆì´

```
@Scheduled(initialDelay = 5000, fixedDelay = 10000)
public void performBatchJob() {
    System.out.println("ë°°ì¹˜ ì‘ì—… ì‹¤í–‰ ì™„ë£Œ: " + LocalDateTime.now());
}
```

#### cron ê¸°ë°˜ ìŠ¤ì¼€ì¤„ë§

```
@Scheduled(cron = "0 0 2 * * *")  // ë§¤ì¼ ìƒˆë²½ 2ì‹œ ì •ê° ì‹¤í–‰
public void backupDatabase() {
    System.out.println("ë°ì´í„°ë² ì´ìŠ¤ ë°±ì—… ì‹¤í–‰: " + LocalDateTime.now());
}
```

------

### 5ï¸âƒ£ ì£¼ì˜ ì‚¬í•­ âš ï¸

- ê¸°ë³¸ì ìœ¼ë¡œ `@Scheduled` ë©”ì„œë“œëŠ” **ì‹±ê¸€ ì“°ë ˆë“œ(TaskScheduler)** ì— ì˜í•´ ì‹¤í–‰ë¨ â†’ ë³‘ë ¬ ì²˜ë¦¬ í•„ìš” ì‹œ ë³„ë„ ì„¤ì • í•„ìš”.
- ë©”ì„œë“œ ì‹¤í–‰ ì‹œê°„ì´ ê³ ì • ì£¼ê¸°ë³´ë‹¤ ê¸¸ ê²½ìš° â†’ overlapping(ê²¹ì¹¨) ê°€ëŠ¥ì„± ìˆìŒ â†’ í•„ìš” ì‹œ `@Async` + ThreadPoolExecutor ì‚¬ìš© ê³ ë ¤.
- `@Scheduled`ëŠ” í”„ë¡œë•ì…˜ í™˜ê²½ì—ì„œ ë„ˆë¬´ ê³¼ë„í•˜ê²Œ ë‚¨ë°œ ì‹œ **ì• í”Œë¦¬ì¼€ì´ì…˜ ë¶€í•˜ ìœ ë°œ** â†’ ì‹ ì¤‘í•˜ê²Œ ì ìš©í•  ê²ƒ.

------

### 6ï¸âƒ£ ThreadPool ê¸°ë°˜ ìŠ¤ì¼€ì¤„ë§ ğŸš€

ê¸°ë³¸ì€ ì‹±ê¸€ ì“°ë ˆë“œ â†’ ë³‘ë ¬ ì‹¤í–‰í•˜ë ¤ë©´ ThreadPoolTaskScheduler ì‚¬ìš©.

```
@Configuration
@EnableScheduling
public class SchedulingConfig implements SchedulingConfigurer {

    @Override
    public void configureTasks(ScheduledTaskRegistrar taskRegistrar) {
        ThreadPoolTaskScheduler taskScheduler = new ThreadPoolTaskScheduler();
        taskScheduler.setPoolSize(5);
        taskScheduler.setThreadNamePrefix("Scheduler-");
        taskScheduler.initialize();
        taskRegistrar.setTaskScheduler(taskScheduler);
    }
}
```

#### íš¨ê³¼:

- ìŠ¤ì¼€ì¤„ë§ ì‘ì—…ì„ **ë©€í‹° ì“°ë ˆë“œ** ê¸°ë°˜ìœ¼ë¡œ ì²˜ë¦¬ ê°€ëŠ¥.
- long-running ì‘ì—… ê²¹ì¹¨ ë°©ì§€.

------

### 7ï¸âƒ£ í™œìš© ì‹œë‚˜ë¦¬ì˜¤ ğŸ¯

- ì£¼ê¸°ì  **ë°°ì¹˜ ì‘ì—… ì‹¤í–‰** (ex. í†µê³„ ì§‘ê³„)
- ì£¼ê¸°ì  **ë°ì´í„° ë™ê¸°í™”**
- ì‹œìŠ¤í…œ **ìƒíƒœ ì ê²€ / ëª¨ë‹ˆí„°ë§**
- ì™¸ë¶€ API ë°ì´í„° ì£¼ê¸°ì  ìˆ˜ì§‘
- **ë¡œê·¸ ì •ë¦¬ ì‘ì—…** ì£¼ê¸°ì  ì‹¤í–‰

------

### ê²°ë¡ 

| ì–´ë…¸í…Œì´ì…˜          | ì—­í•                          |
| ------------------- | ---------------------------- |
| `@EnableScheduling` | ìŠ¤ì¼€ì¤„ë§ ê¸°ëŠ¥ í™œì„±í™”         |
| `@Scheduled`        | ë©”ì„œë“œ ë‹¨ìœ„ ì£¼ê¸°ì  ì‹¤í–‰ ë“±ë¡ |

- **ê°„ë‹¨í•œ ì£¼ê¸°ì  ì‘ì—… êµ¬í˜„ ì‹œ ë§¤ìš° ìœ ìš©**í•œ ê¸°ëŠ¥.
- ê³ ì • ì£¼ê¸°(fixedRate), ê³ ì • ì§€ì—°(fixedDelay), cron í‘œí˜„ì‹ ëª¨ë‘ ì§€ì›.
- ë³µì¡í•œ ë³‘ë ¬ ì²˜ë¦¬ ì‹œ ë³„ë„ ThreadPool êµ¬ì„± ê°€ëŠ¥.

## Quartz ìŠ¤ì¼€ì¤„ëŸ¬ ì—°ë™

QuartzëŠ” ê°•ë ¥í•˜ê³  ìœ ì—°í•œ **ìŠ¤ì¼€ì¤„ë§ ë¼ì´ë¸ŒëŸ¬ë¦¬**ë¡œ, **ì •êµí•œ ìŠ¤ì¼€ì¤„ ê´€ë¦¬**ê°€ í•„ìš”í•œ ì—”í„°í”„ë¼ì´ì¦ˆê¸‰ ì• í”Œë¦¬ì¼€ì´ì…˜ì—ì„œ ë„ë¦¬ ì‚¬ìš©ëœë‹¤.
 Spring Bootì—ì„œëŠ” Quartzë¥¼ ì†ì‰½ê²Œ í†µí•©í•  ìˆ˜ ìˆìœ¼ë©°, `@Scheduled` ë³´ë‹¤ ê³ ê¸‰ ê¸°ëŠ¥ì„ ì œê³µí•œë‹¤.

QuartzëŠ” ë‹¤ìŒê³¼ ê°™ì€ ê¸°ëŠ¥ì„ ì œê³µí•œë‹¤:

- Cron í‘œí˜„ì‹ ê¸°ë°˜ ìŠ¤ì¼€ì¤„ë§
- Job ìƒíƒœ ê´€ë¦¬ ë° ì˜ì†í™” (DB ì—°ë™)
- ë¶„ì‚° í™˜ê²½ ì§€ì› (í´ëŸ¬ìŠ¤í„°ë§)
- Job ì¤‘ë³µ ë°©ì§€(ë™ì‹œ ì‹¤í–‰ ë°©ì§€)
- Job ì‹¤í–‰ ê¸°ë¡ ê´€ë¦¬
- ì¬ì‹œë„, Misfire ì²˜ë¦¬ ì§€ì›

------

### 1ï¸âƒ£ Quartz ê¸°ë³¸ ê°œë…

QuartzëŠ” ë‹¤ìŒ êµ¬ì„±ìš”ì†Œë¡œ ì´ë£¨ì–´ì§„ë‹¤:

| êµ¬ì„±ìš”ì†Œ  | ì„¤ëª…                                |
| --------- | ----------------------------------- |
| Job       | ì‹¤í–‰í•  ì‘ì—… ë‹¨ìœ„                    |
| Trigger   | Job ì‹¤í–‰ ì¡°ê±´ ë° ì‹œì  ì„¤ì •          |
| Scheduler | Jobê³¼ Triggerë¥¼ ê´€ë¦¬í•˜ë©° ì‹¤í–‰ ì£¼ê´€  |
| JobStore  | Trigger/Job ìƒíƒœ ì €ì¥ì†Œ (ë©”ëª¨ë¦¬/DB) |

QuartzëŠ” ê¸°ë³¸ì ìœ¼ë¡œ **RAMJobStore**(ë©”ëª¨ë¦¬ ê¸°ë°˜)ë¥¼ ì‚¬ìš©í•˜ì§€ë§Œ, ìš´ì˜ í™˜ê²½ì—ì„œëŠ” **JDBCJobStore**(DB ê¸°ë°˜ ì˜ì†í™”)ë¥¼ ì‚¬ìš©í•˜ëŠ” ê²½ìš°ê°€ ë§ë‹¤.

------

### 2ï¸âƒ£ ì˜ì¡´ì„± ì¶”ê°€

#### Maven

```
<dependency>
    <groupId>org.springframework.boot</groupId>
    <artifactId>spring-boot-starter-quartz</artifactId>
</dependency>
```

#### Gradle

```
implementation 'org.springframework.boot:spring-boot-starter-quartz'
```

ğŸ‘‰ ì´ë¡œì¨ Spring Bootì—ì„œ Quartz Schedulerê°€ ìë™ìœ¼ë¡œ êµ¬ì„±ëœë‹¤.

------

### 3ï¸âƒ£ Quartz Job ì‘ì„±

Quartzì—ì„œ ì‹¤í–‰í•  ì‘ì—…ì€ **Job ì¸í„°í˜ì´ìŠ¤**ë¥¼ êµ¬í˜„í•˜ì—¬ ì‘ì„±í•œë‹¤.

```
@Component
public class SampleJob implements Job {

    @Override
    public void execute(JobExecutionContext context) throws JobExecutionException {
        System.out.println("SampleJob ì‹¤í–‰ ì‹œê°„: " + LocalDateTime.now());
    }
}
```

- `execute` ë©”ì„œë“œê°€ ì‹¤í–‰ ì‹œ í˜¸ì¶œëœë‹¤.
- í•„ìš”í•œ ê²½ìš° **JobDataMap**ì„ í†µí•´ íŒŒë¼ë¯¸í„° ì „ë‹¬ ê°€ëŠ¥.

------

### 4ï¸âƒ£ JobDetailê³¼ Trigger ì„¤ì •

Quartzì—ì„œ Job ì‹¤í–‰ì„ ìœ„í•´ì„œëŠ” **JobDetail**ê³¼ **Trigger**ë¥¼ ë“±ë¡í•´ì•¼ í•œë‹¤.

```
@Configuration
public class QuartzConfig {

    @Bean
    public JobDetail sampleJobDetail() {
        return JobBuilder.newJob(SampleJob.class)
            .withIdentity("sampleJob")
            .storeDurably()
            .build();
    }

    @Bean
    public Trigger sampleJobTrigger() {
        SimpleScheduleBuilder scheduleBuilder = SimpleScheduleBuilder.simpleSchedule()
            .withIntervalInSeconds(10)  // 10ì´ˆë§ˆë‹¤ ì‹¤í–‰
            .repeatForever();

        return TriggerBuilder.newTrigger()
            .forJob(sampleJobDetail())
            .withIdentity("sampleTrigger")
            .withSchedule(scheduleBuilder)
            .build();
    }
}
```

#### ì£¼ìš” êµ¬ì„± ìš”ì†Œ

- `JobDetail` â†’ ì‹¤í–‰í•  Job ì •ì˜
- `Trigger` â†’ ì‹¤í–‰ ì£¼ê¸°/ì‹œì  ì •ì˜

ğŸ‘‰ ìœ„ ì˜ˆì‹œëŠ” 10ì´ˆë§ˆë‹¤ `SampleJob`ì„ ë°˜ë³µ ì‹¤í–‰í•˜ëŠ” êµ¬ì„±ì´ë‹¤.

------

### 5ï¸âƒ£ CronTrigger ì‚¬ìš© (ê³ ê¸‰ ìŠ¤ì¼€ì¤„ë§) ğŸŒŸ

ë³´ë‹¤ ì •êµí•œ ìŠ¤ì¼€ì¤„ë§ì„ ìœ„í•´ **CronTrigger**ë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.

```
@Bean
public Trigger sampleJobCronTrigger() {
    return TriggerBuilder.newTrigger()
        .forJob(sampleJobDetail())
        .withIdentity("sampleCronTrigger")
        .withSchedule(CronScheduleBuilder.cronSchedule("0 0/1 * * * ?"))  // ë§¤ 1ë¶„ë§ˆë‹¤ ì‹¤í–‰
        .build();
}
```

Cron í‘œí˜„ì‹ì€ Quartzì—ì„œ `?` ë¬¸ë²• ë“±ì„ ì‚¬ìš©í•˜ë¯€ë¡œ ì¼ë°˜ Cronê³¼ ì•½ê°„ ì°¨ì´ê°€ ìˆìŒ.

ì˜ˆì‹œ ì°¸ê³  â†’ https://www.freeformatter.com/cron-expression-generator-quartz.html ğŸ”

------

### 6ï¸âƒ£ Quartz ì˜ì†í™” êµ¬ì„± (JDBCJobStore) ğŸ—‚ï¸

ìš´ì˜ í™˜ê²½ì—ì„œ Job ìƒíƒœ(Trigger ìƒíƒœ, ì‹¤í–‰ ì´ë ¥ ë“±)ë¥¼ DBì— ì˜ì†í™”í•˜ë ¤ë©´ ë‹¤ìŒ ì„¤ì •ì´ í•„ìš”í•˜ë‹¤.

#### 1. Quartz í…Œì´ë¸” ìƒì„±

Quartz ê³µì‹ ë¬¸ì„œì—ì„œ ì œê³µí•˜ëŠ” **DDL ìŠ¤í¬ë¦½íŠ¸**ë¥¼ ì‹¤í–‰í•˜ì—¬ DBì— í…Œì´ë¸” êµ¬ì„±.

```
org/quartz/impl/jdbcjobstore/tables_mysql_innodb.sql
```

(â€» DBMSë³„ë¡œ ì œê³µë¨ â†’ MySQL, PostgreSQL, Oracle ë“±)

#### 2. application.yml ì„¤ì •

```
spring:
  quartz:
    job-store-type: jdbc
    jdbc:
      initialize-schema: always  # ì´ˆê¸° í…Œì´ë¸” ìë™ ìƒì„± (ìš´ì˜ í™˜ê²½ì—ì„œëŠ” off ì¶”ì²œ)
    properties:
      org:
        quartz:
          scheduler:
            instanceName: QuartzScheduler
          threadPool:
            threadCount: 10
```

- `job-store-type: jdbc` ì„¤ì • ì‹œ JDBCJobStore ì‚¬ìš©
- ì˜ì†í™”ëœ Trigger ìƒíƒœëŠ” DBì— ì €ì¥ â†’ ì„œë²„ ì¬ì‹œì‘ í›„ì—ë„ ìœ ì§€ë¨ ğŸ”„

------

### 7ï¸âƒ£ Quartz vs @Scheduled ë¹„êµ

| í•­ëª©           | Quartz                               | @Scheduled           |
| -------------- | ------------------------------------ | -------------------- |
| ìŠ¤ì¼€ì¤„ ê´€ë¦¬    | ì •êµí•œ Trigger ì„¤ì •                  | ë‹¨ìˆœ ì£¼ê¸° ì‹¤í–‰       |
| ìƒíƒœ ì˜ì†í™”    | ì§€ì› (JDBCJobStore ì‚¬ìš© ì‹œ)          | ë¯¸ì§€ì› (ë©”ëª¨ë¦¬ ê¸°ë°˜) |
| ë¶„ì‚° í™˜ê²½ ì§€ì› | í´ëŸ¬ìŠ¤í„°ë§ ì§€ì›                      | ë¯¸ì§€ì›               |
| Job ê´€ë¦¬ ê¸°ëŠ¥  | ë‹¤ì–‘í•œ Trigger, ì¬ì‹œë„, Misfire ì²˜ë¦¬ | ë‹¨ìˆœ Timer ê¸°ë°˜      |
| ì‚¬ìš© ìš©ë„      | ì—”í„°í”„ë¼ì´ì¦ˆ ë°°ì¹˜/ìŠ¤ì¼€ì¤„ë§           | ê°„ë‹¨í•œ ì£¼ê¸°ì  ì‘ì—…   |

 ğŸ‘‰ QuartzëŠ” **ìš´ì˜ í™˜ê²½ì—ì„œ ì•ˆì •ì ì´ê³  ì •êµí•œ ë°°ì¹˜/ìŠ¤ì¼€ì¤„ë§**ì´ í•„ìš”í•œ ê²½ìš° ì í•©.
 ğŸ‘‰ `@Scheduled`ëŠ” **ê°„ë‹¨í•œ ë‚´ë¶€ ì£¼ê¸° ì‘ì—…** ì²˜ë¦¬ì— ì í•©.

------

### 8ï¸âƒ£ ì¢…í•© êµ¬ì„± íë¦„

```
Application Startup â†’ Quartz Scheduler ì´ˆê¸°í™”
   â†“
JobDetail ë“±ë¡ â†’ Trigger ë“±ë¡
   â†“
Schedulerê°€ Trigger ì‹œê°„ì— ë”°ë¼ Job ì‹¤í–‰
   â†“
Job ExecutionContext â†’ execute() í˜¸ì¶œ
   â†“
Job ìƒíƒœ ë° ì‹¤í–‰ ì´ë ¥ ê´€ë¦¬ (JDBCJobStore ì‚¬ìš© ì‹œ DB ë°˜ì˜)
```

------

### ê²°ë¡ 

 âœ… QuartzëŠ” ê°•ë ¥í•œ ìŠ¤ì¼€ì¤„ë§ ê¸°ëŠ¥ì„ ì œê³µí•˜ëŠ” ì™¸ë¶€ ë¼ì´ë¸ŒëŸ¬ë¦¬.
 âœ… Spring Boot Starterë¡œ ì†ì‰½ê²Œ í†µí•© ê°€ëŠ¥.
 âœ… JDBCJobStore êµ¬ì„± ì‹œ ë¶„ì‚° í™˜ê²½ì—ì„œë„ ì•ˆì •ì ì¸ Job ê´€ë¦¬ ê°€ëŠ¥.
 âœ… `@Scheduled` ë³´ë‹¤ ìœ ì—°í•˜ê³  í™•ì¥ì„± ë†’ì€ ìŠ¤ì¼€ì¤„ë§ ê¸°ëŠ¥ ì œê³µ.

## TaskExecutor, ThreadPool ì„¤ì •

Springì—ì„œëŠ” **ë¹„ë™ê¸° ì²˜ë¦¬** ë˜ëŠ” **ë³‘ë ¬ ì²˜ë¦¬**ê°€ í•„ìš”í•œ ê²½ìš°, `TaskExecutor`ì™€ `ThreadPool`ì„ êµ¬ì„±í•˜ì—¬ **íš¨ìœ¨ì ì´ê³  ì•ˆì •ì ì¸ ìŠ¤ë ˆë“œ ê´€ë¦¬**ë¥¼ êµ¬í˜„í•  ìˆ˜ ìˆë‹¤.
 ê¸°ë³¸ì ìœ¼ë¡œ `TaskExecutor`ëŠ” **Springì˜ ë¹„ë™ê¸° ì‘ì—…ì„ ì¶”ìƒí™”**í•œ ì¸í„°í˜ì´ìŠ¤ì´ë©°, ë‚´ë¶€ì ìœ¼ë¡œëŠ” `java.util.concurrent.Executor` ê¸°ë°˜ìœ¼ë¡œ êµ¬í˜„ëœë‹¤.

------

### 1ï¸âƒ£ ì£¼ìš” ìš©ë„

- `@Async` ë©”ì„œë“œ ì‹¤í–‰ ì‹œ TaskExecutor ì‚¬ìš©
- `@Scheduled` ìŠ¤ì¼€ì¤„ë§ ì‹œ ThreadPool êµ¬ì„±
- ë¹„ë™ê¸° ì´ë²¤íŠ¸ ì²˜ë¦¬
- ë³‘ë ¬ ì²˜ë¦¬ ê¸°ë°˜ ë°°ì¹˜ ì‘ì—…
- ëŒ€ìš©ëŸ‰ API í˜¸ì¶œ ì‹œ ë¹„ë™ê¸° ë³‘ë ¬ ì²˜ë¦¬

------

### 2ï¸âƒ£ ê¸°ë³¸ ê°œë…

| êµ¬ì„±ìš”ì†Œ                | ì„¤ëª…                                              |
| ----------------------- | ------------------------------------------------- |
| TaskExecutor            | ìŠ¤ë ˆë“œ í’€ì„ ì¶”ìƒí™”í•œ Spring ì¸í„°í˜ì´ìŠ¤            |
| ThreadPoolTaskExecutor  | ê¸°ë³¸ ì œê³µë˜ëŠ” ThreadPool ê¸°ë°˜ TaskExecutor êµ¬í˜„ì²´ |
| ThreadPoolTaskScheduler | ìŠ¤ì¼€ì¤„ë§ ì‘ì—…ìš© ThreadPool ê¸°ë°˜ Scheduler         |

Spring Bootì—ì„œëŠ” `ThreadPoolTaskExecutor`ë¥¼ ì£¼ë¡œ ì‚¬ìš©í•˜ì—¬ ë¹„ë™ê¸° ì‘ì—…ì„ ìˆ˜í–‰í•œë‹¤.

------

### 3ï¸âƒ£ ThreadPoolTaskExecutor ì„¤ì • ğŸš€

#### 1. Bean ì •ì˜

```
@Configuration
public class AsyncConfig {

    @Bean(name = "taskExecutor")
    public TaskExecutor taskExecutor() {
        ThreadPoolTaskExecutor executor = new ThreadPoolTaskExecutor();
        executor.setCorePoolSize(10);            // ê¸°ë³¸ ìŠ¤ë ˆë“œ ìˆ˜
        executor.setMaxPoolSize(20);              // ìµœëŒ€ ìŠ¤ë ˆë“œ ìˆ˜
        executor.setQueueCapacity(500);           // í í¬ê¸° (ëŒ€ê¸° ì‘ì—… ìˆ˜)
        executor.setThreadNamePrefix("Async-");   // ìŠ¤ë ˆë“œ ì´ë¦„ ì ‘ë‘ì‚¬
        executor.setWaitForTasksToCompleteOnShutdown(true);  // ì¢…ë£Œ ì‹œ ëŒ€ê¸° ì—¬ë¶€
        executor.setAwaitTerminationSeconds(30);  // ì¢…ë£Œ ëŒ€ê¸° ì‹œê°„
        executor.initialize();
        return executor;
    }
}
```

#### ì£¼ìš” ì„¤ì • ê°’

| ì„¤ì •ê°’                             | ì„¤ëª…                                                    |
| ---------------------------------- | ------------------------------------------------------- |
| `corePoolSize`                     | ê¸°ë³¸ ìœ ì§€ ìŠ¤ë ˆë“œ ìˆ˜                                     |
| `maxPoolSize`                      | ìµœëŒ€ ìƒì„± ê°€ëŠ¥ ìŠ¤ë ˆë“œ ìˆ˜                                |
| `queueCapacity`                    | ì‘ì—… í ìš©ëŸ‰ (íê°€ ê½‰ ì°¨ë©´ maxPoolSizeê¹Œì§€ ìŠ¤ë ˆë“œ ìƒì„±) |
| `threadNamePrefix`                 | ìŠ¤ë ˆë“œ ì´ë¦„ ì ‘ë‘ì‚¬ ì§€ì • (ë””ë²„ê¹… ì‹œ ìœ ìš©)                |
| `waitForTasksToCompleteOnShutdown` | ì• í”Œë¦¬ì¼€ì´ì…˜ ì¢…ë£Œ ì‹œ ëŒ€ê¸° ì—¬ë¶€                          |
| `awaitTerminationSeconds`          | ì¢…ë£Œ ì‹œ ìµœëŒ€ ëŒ€ê¸° ì‹œê°„ (ì´ˆ)                             |

------

#### 2. @Async ì ìš©

ë¹„ë™ê¸° ì‹¤í–‰ ë©”ì„œë“œëŠ” `@Async` ì–´ë…¸í…Œì´ì…˜ìœ¼ë¡œ ì„ ì–¸í•œë‹¤.

```
@Service
public class AsyncService {

    @Async("taskExecutor")
    public void performAsyncTask() {
        System.out.println("Async ì‘ì—… ì‹œì‘: " + Thread.currentThread().getName());
        // ë¹„ë™ê¸° ì‘ì—… ë¡œì§
    }
}
```

- `@Async` ì–´ë…¸í…Œì´ì…˜ìœ¼ë¡œ TaskExecutorë¥¼ ëª…ì‹œì ìœ¼ë¡œ ì§€ì • ê°€ëŠ¥.
- ë©”ì„œë“œëŠ” ë°˜ë“œì‹œ `void` ë˜ëŠ” `Future<T>`, `CompletableFuture<T>` í˜•íƒœë¡œ ì •ì˜.

------

### 4ï¸âƒ£ ThreadPoolTaskScheduler ì„¤ì • ğŸ•’

ìŠ¤ì¼€ì¤„ë§ ì‘ì—…(`@Scheduled`)ì— ì‚¬ìš©í•  ë³„ë„ ThreadPoolë„ êµ¬ì„± ê°€ëŠ¥í•˜ë‹¤.

```
@Configuration
@EnableScheduling
public class SchedulingConfig implements SchedulingConfigurer {

    @Override
    public void configureTasks(ScheduledTaskRegistrar taskRegistrar) {
        ThreadPoolTaskScheduler taskScheduler = new ThreadPoolTaskScheduler();
        taskScheduler.setPoolSize(5);  // ìŠ¤ì¼€ì¤„ë§ìš© ìŠ¤ë ˆë“œ í’€ í¬ê¸°
        taskScheduler.setThreadNamePrefix("Scheduler-");
        taskScheduler.initialize();
        taskRegistrar.setTaskScheduler(taskScheduler);
    }
}
```

#### í™œìš© íš¨ê³¼

- ê¸°ë³¸ `@Scheduled`ëŠ” ë‹¨ì¼ ì“°ë ˆë“œë¡œ ë™ì‘ â†’ **ë³‘ë ¬ ìŠ¤ì¼€ì¤„ë§ ì‹œ ThreadPoolTaskScheduler ì‚¬ìš© í•„ìš”**.

------

### 5ï¸âƒ£ ThreadPool tuning ì „ëµ âš™ï¸

#### íŠœë‹ ì‹œ ê³ ë ¤ ì‚¬í•­

| í•­ëª©              | ê³ ë ¤ ìš”ì†Œ                                                    |
| ----------------- | ------------------------------------------------------------ |
| corePoolSize      | ì„œë²„ CPU ì½”ì–´ ìˆ˜ ê¸°ë°˜ ì„¤ì • (ex. CPU ì½”ì–´ ìˆ˜ * 2 ë“±)          |
| maxPoolSize       | ê³¼ë¶€í•˜ ìƒí™© ëŒ€ì‘ â†’ ë¹„ì¦ˆë‹ˆìŠ¤ íŠ¹ì„±ì— ë§ê²Œ ì„¤ì •                 |
| queueCapacity     | ì‘ì—…ëŸ‰ íŠ¹ì„± ë¶„ì„ í›„ ì ì • í¬ê¸° ì„¤ì • (ë„ˆë¬´ í¬ë©´ ì‘ë‹µ ì§€ì—° ë°œìƒ ê°€ëŠ¥) |
| threadNamePrefix  | ìš´ì˜ ë””ë²„ê¹… í¸ì˜ì„± í™•ë³´                                      |
| graceful shutdown | shutdown ì‹œ ì‘ì—… ì •ìƒ ì¢…ë£Œ ë³´ì¥ í•„ìš”                         |

#### ì¼ë°˜ì ì¸ ì¶”ì²œ ê°’

- CPU ë°”ìš´ë“œ ì‘ì—… â†’ corePoolSize = CPU ì½”ì–´ ìˆ˜
- I/O ë°”ìš´ë“œ ì‘ì—… â†’ corePoolSize = CPU ì½”ì–´ ìˆ˜ * 2~4
- queueCapacityëŠ” íŠ¸ë˜í”½ íŒ¨í„´ê³¼ latency íŠ¹ì„± ê³ ë ¤í•˜ì—¬ ì„¤ì •

------

### 6ï¸âƒ£ ì¢…í•© êµ¬ì„± íë¦„

```
Application Startup â†’ ThreadPoolTaskExecutor Bean ë“±ë¡
   â†“
Service Layer â†’ @Async ë©”ì„œë“œ í˜¸ì¶œ
   â†“
TaskExecutor â†’ ë³„ë„ ìŠ¤ë ˆë“œ í’€ì—ì„œ ë¹„ë™ê¸° ì‹¤í–‰
   â†“
ThreadPoolTaskScheduler â†’ ë‹¤ì¤‘ ìŠ¤ì¼€ì¤„ë§ ì‘ì—… ê´€ë¦¬
```

------

### 7ï¸âƒ£ TaskExecutor vs ExecutorService ì°¨ì´

| í•­ëª©             | TaskExecutor            | ExecutorService       |
| ---------------- | ----------------------- | --------------------- |
| ì •ì˜             | Spring ì¶”ìƒí™”           | Java í‘œì¤€ ë¼ì´ë¸ŒëŸ¬ë¦¬  |
| êµ¬ì„± ë°©ì‹        | Beanìœ¼ë¡œ ê´€ë¦¬ â†’ DI ê°€ëŠ¥ | ì§ì ‘ ì½”ë“œë¡œ êµ¬ì„± í•„ìš” |
| ìŠ¤í”„ë§ í†µí•©      | ì‰½ê²Œ í†µí•©               | ìˆ˜ë™ ì„¤ì • í•„ìš”        |
| AOP, @Async ì§€ì› | ì§€ì›                    | ì§ì ‘ êµ¬í˜„ í•„ìš”        |

 ğŸ‘‰ ì¼ë°˜ì ì¸ Spring Boot í™˜ê²½ì—ì„œëŠ” **TaskExecutor ì‚¬ìš© ê¶Œì¥**.
 ğŸ‘‰ Spring Batch, Quartz ë“±ê³¼ë„ ì‰½ê²Œ í†µí•© ê°€ëŠ¥.

------

### ê²°ë¡  ğŸ—‚ï¸

 âœ… TaskExecutorëŠ” Springì—ì„œ ë¹„ë™ê¸° ë° ë³‘ë ¬ ì²˜ë¦¬ êµ¬í˜„ ì‹œ í‘œì¤€ì ìœ¼ë¡œ ì‚¬ìš©í•˜ëŠ” ìŠ¤ë ˆë“œ í’€ ì¸í„°í˜ì´ìŠ¤.
 âœ… ThreadPoolTaskExecutorë¥¼ í†µí•´ ìœ ì—°í•˜ê³  ê°•ë ¥í•œ ThreadPool êµ¬ì„± ê°€ëŠ¥.
 âœ… ìŠ¤ì¼€ì¤„ë§ ì‘ì—…ì—ëŠ” ThreadPoolTaskScheduler êµ¬ì„±ìœ¼ë¡œ ë³‘ë ¬ ì‹¤í–‰ ì§€ì›.
 âœ… ì ì ˆí•œ ThreadPool íŠœë‹ì„ í†µí•´ ì•ˆì •ì ì´ê³  íš¨ìœ¨ì ì¸ ì„œë¹„ìŠ¤ ìš´ì˜ ê°€ëŠ¥.