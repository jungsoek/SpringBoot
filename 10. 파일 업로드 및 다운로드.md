# 10. íŒŒì¼ ì—…ë¡œë“œ ë° ë‹¤ìš´ë¡œë“œ

## MultipartFile ì²˜ë¦¬

Spring Bootì—ì„œ `MultipartFile`ì„ ì‚¬ìš©í•˜ë©´ **íŒŒì¼ ì—…ë¡œë“œ ìš”ì²­ì„ ê°„ë‹¨í•˜ê²Œ ì²˜ë¦¬**í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
 ì‚¬ìš©ìëŠ” HTML `<form>`ì´ë‚˜ REST APIë¥¼ í†µí•´ íŒŒì¼ì„ ì „ì†¡í•˜ê³ ,
 ì„œë²„ëŠ” `MultipartFile` ê°ì²´ë¡œ í•´ë‹¹ íŒŒì¼ì„ ë°›ê³  **ì €ì¥, ë³€í™˜, ì²˜ë¦¬**í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ì•„ë˜ëŠ” `MultipartFile`ì˜ **ê¸°ë³¸ ê°œë…, ìš”ì²­ ì²˜ë¦¬, ì €ì¥ ì „ëµ, ì‹¤ë¬´ ì˜ˆì‹œ, ì£¼ì˜ì‚¬í•­**ê¹Œì§€ ì „ë¶€ ì •ë¦¬í•œ ì‹¤ë¬´ ê°€ì´ë“œì…ë‹ˆë‹¤.

------

### âœ… 1. Multipartë€?

> HTTP ìš”ì²­ì—ì„œ **`Content-Type: multipart/form-data`** í˜•ì‹ìœ¼ë¡œ
>  í…ìŠ¤íŠ¸ + íŒŒì¼ ë“± ì—¬ëŸ¬ ì¢…ë¥˜ì˜ ë°ì´í„°ë¥¼ **í•œ ë²ˆì— ì „ì†¡**í•˜ëŠ” ë°©ì‹ì…ë‹ˆë‹¤.

------

### âœ… 2. ê¸°ë³¸ êµ¬ì¡° ë° ì˜ì¡´ì„±

Spring BootëŠ” ê¸°ë³¸ì ìœ¼ë¡œ `spring-boot-starter-web`ì— íŒŒì¼ ì—…ë¡œë“œ ê´€ë ¨ ì²˜ë¦¬ë¥¼ í¬í•¨í•˜ê³  ìˆì–´
 **ë³„ë„ì˜ ì˜ì¡´ì„± ì¶”ê°€ê°€ í•„ìš” ì—†ìŠµë‹ˆë‹¤.**

------

### âœ… 3. application.yml ì„¤ì •

```
spring:
  servlet:
    multipart:
      enabled: true
      max-file-size: 10MB
      max-request-size: 20MB
```

- `max-file-size`: ë‹¨ì¼ íŒŒì¼ ìµœëŒ€ í¬ê¸°
- `max-request-size`: ìš”ì²­ ì „ì²´ í¬ê¸° ì œí•œ (ì—¬ëŸ¬ íŒŒì¼ í¬í•¨ ì‹œ)

------

### âœ… 4. ì»¨íŠ¸ë¡¤ëŸ¬ì—ì„œ íŒŒì¼ ë°›ê¸°

#### ğŸ”¹ ë‹¨ì¼ íŒŒì¼

```
@PostMapping("/upload")
public ResponseEntity<String> upload(@RequestParam("file") MultipartFile file) throws IOException {
    String originalName = file.getOriginalFilename();
    long size = file.getSize();
    byte[] content = file.getBytes(); // ë˜ëŠ” file.getInputStream()

    // ì €ì¥, ì²˜ë¦¬ ë“± ìˆ˜í–‰

    return ResponseEntity.ok("íŒŒì¼ ì—…ë¡œë“œ ì„±ê³µ: " + originalName);
}
```

------

#### ğŸ”¹ ì—¬ëŸ¬ íŒŒì¼

```
@PostMapping("/upload-multiple")
public ResponseEntity<?> uploadMultiple(@RequestParam("files") List<MultipartFile> files) {
    for (MultipartFile file : files) {
        // íŒŒì¼ë³„ ì²˜ë¦¬
    }
    return ResponseEntity.ok("ì—…ë¡œë“œ ì™„ë£Œ");
}
```

------

#### ğŸ”¹ DTOë¡œ ë°›ê¸°

```
@Data
public class UploadRequest {
    private String title;
    private MultipartFile file;
}
```

â†’ `@ModelAttribute`ë¥¼ í™œìš©í•˜ì—¬ í•¨ê»˜ ë°›ê¸° ê°€ëŠ¥ (ë‹¨, `@RequestBody`ì™€ëŠ” í˜¸í™˜ë˜ì§€ ì•ŠìŒ)

------

### âœ… 5. íŒŒì¼ ì €ì¥ ì˜ˆì‹œ

```
public void saveFile(MultipartFile file, String uploadDir) throws IOException {
    String filename = UUID.randomUUID() + "_" + file.getOriginalFilename();
    Path path = Paths.get(uploadDir + File.separator + filename);
    Files.createDirectories(path.getParent());
    file.transferTo(path);
}
```

- `transferTo()`ëŠ” ë¡œì»¬ íŒŒì¼ ì‹œìŠ¤í…œì— ì§ì ‘ ì €ì¥
- ì €ì¥ ì „ì— `íŒŒì¼ ì´ë¦„ ì¸ì½”ë”©, í™•ì¥ì ê²€ì‚¬, í¬ê¸° ê²€ì¦` í•„ìš”

------

### âœ… 6. í´ë¼ì´ì–¸íŠ¸ ìš”ì²­ ì˜ˆì‹œ (HTML)

```
<form method="post" action="/upload" enctype="multipart/form-data">
  <input type="file" name="file">
  <input type="submit" value="ì—…ë¡œë“œ">
</form>
```

------

### âœ… 7. í´ë¼ì´ì–¸íŠ¸ ìš”ì²­ ì˜ˆì‹œ (Postman)

- `POST /upload`
- `Body â†’ form-data â†’ key=file (type: file)` â†’ íŒŒì¼ ì„ íƒ

------

### âœ… 8. ì‹¤ë¬´ ì‹œ ê³ ë ¤ì‚¬í•­

| í•­ëª©                 | ì„¤ëª…                                                        |
| -------------------- | ----------------------------------------------------------- |
| **íŒŒì¼ í¬ê¸° ì œí•œ**   | `application.yml` ì„¤ì • ë˜ëŠ” ì»¨íŠ¸ë¡¤ëŸ¬ì—ì„œ í™•ì¸               |
| **íŒŒì¼ ì´ë¦„ ì •ê·œí™”** | UUID, timestamp ë“±ìœ¼ë¡œ ë³€ê²½ ê¶Œì¥                            |
| **ì €ì¥ ìœ„ì¹˜ ë¶„ë¦¬**   | OS ë³„ ë””ë ‰í„°ë¦¬ êµ¬ì¡° ì£¼ì˜ (ex: `/tmp`, `/uploads`)           |
| **í™•ì¥ì ê²€ì¦**      | `.jpg`, `.pdf` ë“± í—ˆìš© í™•ì¥ìë§Œ í—ˆìš©                        |
| **ë³´ì•ˆ ìœ„í—˜**        | `.jsp`, `.exe`, `.sh` ë“± ì‹¤í–‰ íŒŒì¼ì€ ì €ì¥í•˜ì§€ ì•Šë„ë¡ í•„í„°ë§ |
| **ì„ì‹œ íŒŒì¼ ì²˜ë¦¬**   | ì„œë²„ ì¬ì‹œì‘ ì‹œ ì„ì‹œíŒŒì¼ ìë™ ì‚­ì œë¨ (`/tmp`)                |

------

### âœ… 9. íŒŒì¼ ë‹¤ìš´ë¡œë“œ ì²˜ë¦¬ ì˜ˆ

```
@GetMapping("/download/{filename}")
public ResponseEntity<Resource> download(@PathVariable String filename) throws IOException {
    Path path = Paths.get("uploads").resolve(filename).normalize();
    Resource resource = new UrlResource(path.toUri());

    return ResponseEntity.ok()
        .contentType(MediaType.APPLICATION_OCTET_STREAM)
        .header(HttpHeaders.CONTENT_DISPOSITION, "attachment; filename=\"" + resource.getFilename() + "\"")
        .body(resource);
}
```

------

### âœ… 10. ê²°ë¡  ìš”ì•½

| í•­ëª©           | ì„¤ëª…                                        |
| -------------- | ------------------------------------------- |
| íŒŒì¼ ìˆ˜ì‹  ë°©ì‹ | `@RequestParam MultipartFile file`          |
| ì—¬ëŸ¬ íŒŒì¼      | `List<MultipartFile>` ì²˜ë¦¬                  |
| DTO ìˆ˜ì‹        | `@ModelAttribute` ì´ìš©                      |
| íŒŒì¼ ì €ì¥      | `file.transferTo(Path)`                     |
| ì„¤ì • ê´€ë¦¬      | `spring.servlet.multipart.*`                |
| ë³´ì•ˆ í•„í„°ë§    | í™•ì¥ì, ê²½ë¡œ, í¬ê¸° ì œí•œ ë“± ê°•ë ¥íˆ ê²€ì¦ í•„ìš” |

## ëŒ€ìš©ëŸ‰ íŒŒì¼ ìŠ¤íŠ¸ë¦¬ë°

**Spring Bootì—ì„œ ëŒ€ìš©ëŸ‰ íŒŒì¼ì„ ì²˜ë¦¬**í•  ë•ŒëŠ” ì¼ë°˜ì ì¸ `MultipartFile` ë°©ì‹ìœ¼ë¡œ ë©”ëª¨ë¦¬ì— ì˜¬ë¦¬ëŠ” ê²ƒë³´ë‹¤,
 **ìŠ¤íŠ¸ë¦¬ë°(Streaming)**ì„ ì‚¬ìš©í•˜ì—¬ **ë©”ëª¨ë¦¬ ë¶€ë‹´ ì—†ì´** ë°ì´í„°ë¥¼ ì£¼ê³ ë°›ëŠ” ê²ƒì´ ì¤‘ìš”í•©ë‹ˆë‹¤.
 íŠ¹íˆ **ìˆ˜ì‹­~ìˆ˜ë°± MB ì´ìƒì˜ íŒŒì¼ ì—…ë¡œë“œ/ë‹¤ìš´ë¡œë“œ**ì—ì„œëŠ” **InputStream/OutputStream ê¸°ë°˜ ì²˜ë¦¬**ê°€ í•µì‹¬ì…ë‹ˆë‹¤.

ì•„ë˜ëŠ” **ëŒ€ìš©ëŸ‰ íŒŒì¼ì˜ ì—…ë¡œë“œ ë° ë‹¤ìš´ë¡œë“œ ìŠ¤íŠ¸ë¦¬ë° ì²˜ë¦¬ ì „ëµ**ì„ ì •ë¦¬í•œ ì‹¤ë¬´ ê°€ì´ë“œì…ë‹ˆë‹¤.

------

### âœ… 1. ìŠ¤íŠ¸ë¦¬ë°ì´ë€?

> íŒŒì¼ ì „ì²´ë¥¼ ë©”ëª¨ë¦¬ì— ì ì¬í•˜ì§€ ì•Šê³ , **ì¼ì • í¬ê¸°ì”© ë‚˜ëˆ„ì–´ ìˆœì°¨ì ìœ¼ë¡œ ì½ê³ /ì“°ê¸°** í•˜ëŠ” ë°©ì‹.
>  `InputStream`/`OutputStream` ê¸°ë°˜ìœ¼ë¡œ ì²˜ë¦¬í•˜ë©°, **ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ì„ ì¼ì •í•˜ê²Œ ìœ ì§€**í•œë‹¤.

------

### âœ… 2. ëŒ€ìš©ëŸ‰ ë‹¤ìš´ë¡œë“œ ìŠ¤íŠ¸ë¦¬ë° (`OutputStream` í™œìš©)

```
@GetMapping("/download/{filename}")
public void downloadFile(@PathVariable String filename, HttpServletResponse response) throws IOException {
    File file = new File("files/" + filename);
    response.setContentType("application/octet-stream");
    response.setHeader("Content-Disposition", "attachment; filename=\"" + file.getName() + "\"");
    response.setContentLengthLong(file.length());

    try (InputStream in = new FileInputStream(file);
         OutputStream out = response.getOutputStream()) {

        byte[] buffer = new byte[8192];
        int bytesRead;

        while ((bytesRead = in.read(buffer)) != -1) {
            out.write(buffer, 0, bytesRead);
        }
    }
}
```

#### ğŸ”¸ íŠ¹ì§•

- ë¸Œë¼ìš°ì €ì— ì§ì ‘ ìŠ¤íŠ¸ë¦¬ë° ì „ì†¡
- ë©”ëª¨ë¦¬ ì‚¬ìš© ìµœì†Œí™”
- `application/octet-stream`ìœ¼ë¡œ ë°”ì´ë„ˆë¦¬ ì „ì†¡

------

### âœ… 3. ëŒ€ìš©ëŸ‰ ì—…ë¡œë“œ ìŠ¤íŠ¸ë¦¬ë° (`InputStream` í™œìš©)

```
@PostMapping("/upload")
public ResponseEntity<String> upload(HttpServletRequest request) throws IOException {
    String uploadPath = "uploads/large-file.dat";
    try (InputStream in = request.getInputStream();
         OutputStream out = new FileOutputStream(uploadPath)) {

        byte[] buffer = new byte[8192];
        int bytesRead;

        while ((bytesRead = in.read(buffer)) != -1) {
            out.write(buffer, 0, bytesRead);
        }
    }

    return ResponseEntity.ok("ì—…ë¡œë“œ ì™„ë£Œ");
}
```

#### ğŸ”¸ íŠ¹ì§•

- Multipart í˜•íƒœê°€ ì•„ë‹Œ **raw binary** ìš”ì²­ì— ì í•©
- í”„ë¡ íŠ¸ì—”ë“œì—ì„œëŠ” `Content-Type: application/octet-stream`ìœ¼ë¡œ ì „ì†¡ í•„ìš”
- ì‹¤ë¬´ì—ì„œëŠ” `StreamingHttpMessageConverter`, `StreamingResponseBody` ì‚¬ìš© ê°€ëŠ¥

------

### âœ… 4. MultipartFileë¡œ ìŠ¤íŠ¸ë¦¬ë° ì €ì¥ (ëŒ€ìš©ëŸ‰ë„ ê°€ëŠ¥í•˜ë‚˜ ì œí•œ ìˆìŒ)

```
@PostMapping("/upload-multipart")
public ResponseEntity<?> upload(@RequestParam MultipartFile file) throws IOException {
    try (InputStream in = file.getInputStream();
         OutputStream out = new FileOutputStream("uploads/" + file.getOriginalFilename())) {

        byte[] buffer = new byte[8192];
        int bytesRead;
        while ((bytesRead = in.read(buffer)) != -1) {
            out.write(buffer, 0, bytesRead);
        }
    }
    return ResponseEntity.ok("ì €ì¥ ì™„ë£Œ");
}
```

#### ğŸ”¸ ì£¼ì˜ì‚¬í•­

- MultipartFileì€ ë©”ëª¨ë¦¬ì— ì˜¬ë¼ê°€ëŠ” í•œê³„ ì„¤ì •ì´ `application.yml`ì— ë”°ë¼ ì œí•œë¨
- 10MB ì´ìƒì€ `DiskFileItem`ìœ¼ë¡œ ì„ì‹œ íŒŒì¼ ì²˜ë¦¬ë¨

------

### âœ… 5. `StreamingResponseBody` í™œìš© (Spring ì „ìš© ìŠ¤íŠ¸ë¦¬ë°)

```
@GetMapping("/stream/{filename}")
public ResponseEntity<StreamingResponseBody> stream(@PathVariable String filename) throws IOException {
    File file = new File("files/" + filename);

    StreamingResponseBody stream = outputStream -> {
        try (InputStream in = new FileInputStream(file)) {
            byte[] buffer = new byte[8192];
            int bytesRead;
            while ((bytesRead = in.read(buffer)) != -1) {
                outputStream.write(buffer, 0, bytesRead);
            }
        }
    };

    return ResponseEntity.ok()
        .header(HttpHeaders.CONTENT_DISPOSITION, "attachment; filename=" + file.getName())
        .contentType(MediaType.APPLICATION_OCTET_STREAM)
        .body(stream);
}
```

#### ğŸ”¸ ì¥ì 

- Spring MVC ë¹„ë™ê¸° ì§€ì› (`AsyncContext`)
- ìš”ì²­ ìŠ¤ë ˆë“œë¥¼ ë¸”ë¡œí‚¹í•˜ì§€ ì•ŠìŒ
- **ì‹¤ì‹œê°„ ì²˜ë¦¬ / ëŒ€ê·œëª¨ ë³‘ë ¬ ë‹¤ìš´ë¡œë“œ**ì— ì í•©

------

### âœ… 6. Spring WebFlux (Reactive ê¸°ë°˜ ìŠ¤íŠ¸ë¦¬ë°)

> Spring WebFlux í™˜ê²½ì—ì„œëŠ” `Flux<DataBuffer>` ê¸°ë°˜ìœ¼ë¡œ ì™„ì „ ë¹„ë™ê¸° ìŠ¤íŠ¸ë¦¬ë° ê°€ëŠ¥

```
@GetMapping(value = "/download", produces = MediaType.APPLICATION_OCTET_STREAM_VALUE)
public Mono<ResponseEntity<Flux<DataBuffer>>> download() {
    File file = new File("files/large.dat");
    Flux<DataBuffer> flux = DataBufferUtils.read(file.toPath(), new DefaultDataBufferFactory(), 4096);
    return Mono.just(ResponseEntity.ok(flux));
}
```

------

### âœ… 7. íŒŒì¼ ì—…ë¡œë“œ ì œí•œ ì„¤ì •

```
spring:
  servlet:
    multipart:
      max-file-size: 2GB
      max-request-size: 2GB
```

- Tomcat ë ˆë²¨ ì„¤ì •ë„ í•„ìš”í•  ìˆ˜ ìˆìŒ (server.tomcat.max-swallow-size)

------

### âœ… 8. ì‹¤ë¬´ íŒ ìš”ì•½

| ëª©ì                    | ë°©ë²•                                                 |
| ---------------------- | ---------------------------------------------------- |
| ë‹¤ìš´ë¡œë“œ ìŠ¤íŠ¸ë¦¬ë°      | `OutputStream`, `StreamingResponseBody`              |
| ì—…ë¡œë“œ ìŠ¤íŠ¸ë¦¬ë°        | `HttpServletRequest.getInputStream()`                |
| ëŒ€ìš©ëŸ‰ ì—…ë¡œë“œ/ë‹¤ìš´ë¡œë“œ | Chunked ë°©ì‹, ë³‘ë ¬ ë¶„í•  ì—…ë¡œë“œ ê³ ë ¤                  |
| ë©”ëª¨ë¦¬ ìµœì†Œí™”          | `byte[] buffer` ê¸°ë°˜ ì²˜ë¦¬                            |
| ë‹¤êµ­ì–´ íŒŒì¼ ì´ë¦„       | `URLEncoder.encode()`ë¡œ ì²˜ë¦¬                         |
| ë³´ì•ˆ                   | íŒŒì¼ ì´ë¦„ ê²€ì¦, ê²½ë¡œ ê²€ì¦ (ê²½ë¡œ traversal ë°©ì§€) í•„ìˆ˜ |

------

### âœ… ê²°ë¡  ìš”ì•½

| í•­ëª©              | ì„¤ëª…                                                         |
| ----------------- | ------------------------------------------------------------ |
| ê¸°ë³¸ ì „ëµ         | InputStream / OutputStream ê¸°ë°˜ ì²˜ë¦¬                         |
| Spring ì „ìš©       | `StreamingResponseBody` (MVC), `Flux<DataBuffer>` (WebFlux)  |
| Multipart ì‚¬ìš© ì‹œ | 10MB ì´ìƒì´ë©´ ë””ìŠ¤í¬ ì €ì¥ â†’ ìŠ¤íŠ¸ë¦¬ë° ìœ ì‚¬                    |
| ì¥ì               | ë©”ëª¨ë¦¬ ì‚¬ìš© ì œí•œ, ì‹¤ì‹œê°„ ì²˜ë¦¬ ê°€ëŠ¥                           |
| ì‹¤ë¬´ í™œìš©         | ì˜ìƒ/ë¡œê·¸ ë‹¤ìš´ë¡œë“œ, ëŒ€í˜• ì´ë¯¸ì§€ ì—…ë¡œë“œ, íŒŒì¼ ë°±ì—… API ë“±ì— ì í•© |

## S3, Cloud Storage ì—°ë™

Spring Bootì—ì„œ **Amazon S3** ë˜ëŠ” **Google Cloud Storage (GCS)** ì™€ ê°™ì€ í´ë¼ìš°ë“œ ìŠ¤í† ë¦¬ì§€ë¥¼ ì—°ë™í•˜ë©´,
 íŒŒì¼ì„ **ì•ˆì „í•˜ê²Œ ì—…ë¡œë“œ/ë‹¤ìš´ë¡œë“œ/ì‚­ì œ/ë¦¬ìŠ¤íŠ¸í™”** í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
 ì´ëŸ¬í•œ ì—°ë™ì€ ë¡œì»¬ ì €ì¥ì†Œë³´ë‹¤ í™•ì¥ì„±ê³¼ ì ‘ê·¼ì„±ì´ ë›°ì–´ë‚˜ **ì‹¤ë¬´ì—ì„œ ë§¤ìš° ë„ë¦¬ ì‚¬ìš©ë©ë‹ˆë‹¤.**

ì•„ë˜ëŠ” **S3ì™€ GCS ì—°ë™ì„ ê°ê° ë”°ë¡œ ì •ë¦¬**í•œ ì‹¤ì „ ê°€ì´ë“œì…ë‹ˆë‹¤.

------

### âœ… 1. Amazon S3 ì—°ë™

#### ğŸ“Œ ì˜ì¡´ì„± ì¶”ê°€ (Gradle)

```
implementation 'software.amazon.awssdk:s3'
```

> AWS SDK v2 ì‚¬ìš© (v1ë³´ë‹¤ ê²½ëŸ‰, ë¹„ë™ê¸° ì§€ì› ìš°ìˆ˜)

------

#### ğŸ“Œ application.yml ì„¤ì •

```
cloud:
  aws:
    s3:
      bucket: my-bucket-name
    credentials:
      access-key: YOUR_ACCESS_KEY
      secret-key: YOUR_SECRET_KEY
    region:
      static: ap-northeast-2
```

------

#### ğŸ“Œ S3Client Bean ë“±ë¡

```
@Configuration
public class S3Config {

    @Value("${cloud.aws.region.static}")
    private String region;

    @Value("${cloud.aws.credentials.access-key}")
    private String accessKey;

    @Value("${cloud.aws.credentials.secret-key}")
    private String secretKey;

    @Bean
    public S3Client s3Client() {
        AwsBasicCredentials credentials = AwsBasicCredentials.create(accessKey, secretKey);

        return S3Client.builder()
            .credentialsProvider(StaticCredentialsProvider.create(credentials))
            .region(Region.of(region))
            .build();
    }
}
```

------

#### ğŸ“Œ ì—…ë¡œë“œ ì˜ˆì œ

```
public void uploadFile(String key, MultipartFile file) throws IOException {
    PutObjectRequest request = PutObjectRequest.builder()
        .bucket("my-bucket-name")
        .key(key)
        .contentType(file.getContentType())
        .build();

    s3Client.putObject(request, RequestBody.fromInputStream(file.getInputStream(), file.getSize()));
}
```

------

#### ğŸ“Œ ë‹¤ìš´ë¡œë“œ ì˜ˆì œ

```
public byte[] downloadFile(String key) {
    GetObjectRequest request = GetObjectRequest.builder()
        .bucket("my-bucket-name")
        .key(key)
        .build();

    ResponseBytes<GetObjectResponse> objectBytes = s3Client.getObjectAsBytes(request);
    return objectBytes.asByteArray();
}
```

------

#### ğŸ“Œ ì‚­ì œ ì˜ˆì œ

```
public void deleteFile(String key) {
    DeleteObjectRequest request = DeleteObjectRequest.builder()
        .bucket("my-bucket-name")
        .key(key)
        .build();
    s3Client.deleteObject(request);
}
```

------

### âœ… 2. Google Cloud Storage (GCS) ì—°ë™

#### ğŸ“Œ ì˜ì¡´ì„± ì¶”ê°€

```
implementation 'com.google.cloud:google-cloud-storage:2.33.0'
```

------

#### ğŸ“Œ ì„œë¹„ìŠ¤ ê³„ì • í‚¤ ì„¤ì •

1. GCP ì½˜ì†” â†’ IAM & ê´€ë¦¬ì â†’ ì„œë¹„ìŠ¤ ê³„ì • ìƒì„±
2. í‚¤ë¥¼ JSONìœ¼ë¡œ ë‹¤ìš´ë¡œë“œ
3. `GOOGLE_APPLICATION_CREDENTIALS` í™˜ê²½ë³€ìˆ˜ë¡œ ê²½ë¡œ ì§€ì • ë˜ëŠ” ì§ì ‘ ë¡œë”©

------

#### ğŸ“Œ application.yml ì˜ˆì‹œ

```
gcs:
  bucket: my-gcs-bucket
  credentials: /path/to/key.json
```

------

#### ğŸ“Œ GCSClient ë“±ë¡

```
@Configuration
public class GCSConfig {

    @Value("${gcs.credentials}")
    private String credentialsPath;

    @Bean
    public Storage gcsStorage() throws IOException {
        GoogleCredentials credentials = GoogleCredentials.fromStream(new FileInputStream(credentialsPath));
        return StorageOptions.newBuilder().setCredentials(credentials).build().getService();
    }
}
```

------

#### ğŸ“Œ íŒŒì¼ ì—…ë¡œë“œ ì˜ˆì œ

```
public void uploadToGCS(String filename, MultipartFile file) throws IOException {
    BlobId blobId = BlobId.of("my-gcs-bucket", filename);
    BlobInfo blobInfo = BlobInfo.newBuilder(blobId).setContentType(file.getContentType()).build();

    gcsStorage.create(blobInfo, file.getBytes());
}
```

------

#### ğŸ“Œ ë‹¤ìš´ë¡œë“œ ì˜ˆì œ

```
public byte[] downloadFromGCS(String filename) {
    Blob blob = gcsStorage.get(BlobId.of("my-gcs-bucket", filename));
    return blob.getContent();
}
```

------

#### ğŸ“Œ ì‚­ì œ ì˜ˆì œ

```
public void deleteFromGCS(String filename) {
    gcsStorage.delete(BlobId.of("my-gcs-bucket", filename));
}
```

------

### âœ… 3. S3 vs GCS ë¹„êµ

| í•­ëª©          | S3                              | GCS                  |
| ------------- | ------------------------------- | -------------------- |
| API ëª…        | `S3Client` (SDK v2)             | `Storage`            |
| ì¸ì¦          | Access Key / Secret Key         | ì„œë¹„ìŠ¤ ê³„ì • JSON     |
| URI í˜•ì‹      | `s3://bucket/key`               | `gs://bucket/key`    |
| ê¶Œí•œ ê´€ë¦¬     | IAM + Bucket Policy             | IAM + ACL            |
| Spring ì—°ë™ì„± | S3 â†’ spring-cloud-aws ì§€ì› ìˆìŒ | GCSëŠ” ì§ì ‘ ì—°ë™ í•„ìš” |

------

### âœ… 4. ì‹¤ë¬´ íŒ ìš”ì•½

| ëª©ì                | ì „ëµ                                                         |
| ------------------ | ------------------------------------------------------------ |
| ëŒ€ìš©ëŸ‰ íŒŒì¼ ì²˜ë¦¬   | ìŠ¤íŠ¸ë¦¬ë°ìœ¼ë¡œ ì „ì†¡ (`InputStream`, `fromInputStream()`)       |
| ì—…ë¡œë“œ ê²½ë¡œ ê´€ë¦¬   | ë²„í‚·/í´ë” êµ¬ì¡° â†’ `bucket/folder/filename.ext`                |
| ì„ì‹œ ê³µê°œ URL ë°œê¸‰ | S3: `PresignedUrl`, GCS: `SignedUrl`                         |
| íŒŒì¼ëª… ì¶©ëŒ ë°©ì§€   | UUID, timestamp ë“±ìœ¼ë¡œ ì‹ë³„ì ìƒì„±                           |
| í…ŒìŠ¤íŠ¸             | `LocalStack (S3)`, `Fake GCS server`, `TestContainers` í™œìš© ê°€ëŠ¥ |

------

### âœ… ê²°ë¡  ìš”ì•½

| í•­ëª©           | ì„¤ëª…                                                    |
| -------------- | ------------------------------------------------------- |
| íŒŒì¼ ì €ì¥ ë°©ì‹ | í´ë¼ìš°ë“œ ìŠ¤í† ë¦¬ì§€ë¥¼ ì™¸ë¶€ íŒŒì¼ ì‹œìŠ¤í…œì²˜ëŸ¼ ì‚¬ìš©           |
| S3 ì—°ë™        | `S3Client`, `PutObjectRequest`, `GetObjectRequest` ì¤‘ì‹¬ |
| GCS ì—°ë™       | `Storage`, `BlobId`, `BlobInfo` ì¤‘ì‹¬                    |
| ì‹¤ë¬´ ê¶Œì¥      | ì´ë¯¸ì§€/ì˜ìƒ/ëŒ€ìš©ëŸ‰ ë¡œê·¸ ì €ì¥ì†Œ ë“±ìœ¼ë¡œ ì í•©              |
| ë³´ì•ˆ           | ë²„í‚· ê¶Œí•œ ë¶„ë¦¬, ACL ì œí•œ, ì—…ë¡œë“œ í™•ì¥ì ê²€ì‚¬ í•„ìˆ˜       |