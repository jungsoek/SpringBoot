# 20. ìŠ¤í”„ë§ í´ë¼ìš°ë“œ (Spring Cloud)

## ë§ˆì´í¬ë¡œì„œë¹„ìŠ¤ ì•„í‚¤í…ì²˜ ê°œìš”

### 1ï¸âƒ£ ë§ˆì´í¬ë¡œì„œë¹„ìŠ¤ ì•„í‚¤í…ì²˜ë€?

#### ì •ì˜

- í•˜ë‚˜ì˜ **ëŒ€ê·œëª¨ ì• í”Œë¦¬ì¼€ì´ì…˜**ì„ ì‘ê³  ë…ë¦½ì ìœ¼ë¡œ ë°°í¬ ê°€ëŠ¥í•œ ì„œë¹„ìŠ¤ë“¤ì˜ ëª¨ìŒìœ¼ë¡œ êµ¬ì„±í•˜ëŠ” ì•„í‚¤í…ì²˜ ìŠ¤íƒ€ì¼
- ê° ì„œë¹„ìŠ¤ëŠ” **ììœ¨ì **ìœ¼ë¡œ ê°œë°œ, ë°°í¬, í™•ì¥ ê°€ëŠ¥
- ì„œë¹„ìŠ¤ë“¤ì€ ì¼ë°˜ì ìœ¼ë¡œ **REST API / ë©”ì‹œì§•** ê¸°ë°˜ìœ¼ë¡œ í†µì‹ 

------

### 2ï¸âƒ£ MSA vs ëª¨ë†€ë¦¬ì‹(Monolithic) ì•„í‚¤í…ì²˜

| êµ¬ë¶„        | ëª¨ë†€ë¦¬ì‹ (Monolithic)  | ë§ˆì´í¬ë¡œì„œë¹„ìŠ¤ (Microservice)       |
| ----------- | ---------------------- | ----------------------------------- |
| ì„œë¹„ìŠ¤ êµ¬ì„± | ë‹¨ì¼ ì• í”Œë¦¬ì¼€ì´ì…˜      | ì—¬ëŸ¬ ê°œì˜ ë…ë¦½ì ì¸ ì„œë¹„ìŠ¤           |
| ë°°í¬ ë‹¨ìœ„   | í•˜ë‚˜                   | ì„œë¹„ìŠ¤ë³„ ê°œë³„ ë°°í¬                  |
| í™•ì¥ì„±      | ì „ì²´ ì• í”Œë¦¬ì¼€ì´ì…˜ í™•ì¥ | ì„œë¹„ìŠ¤ ë‹¨ìœ„ ê°œë³„ í™•ì¥               |
| ì¥ì•  ì „íŒŒ   | ì „ì²´ ì„œë¹„ìŠ¤ì— ì˜í–¥     | íŠ¹ì • ì„œë¹„ìŠ¤ë§Œ ì˜í–¥                  |
| ê¸°ìˆ  ìŠ¤íƒ   | í†µì¼ëœ ê¸°ìˆ  ìŠ¤íƒ ì‚¬ìš©  | ì„œë¹„ìŠ¤ë³„ ìµœì ì˜ ê¸°ìˆ  ìŠ¤íƒ ì‚¬ìš© ê°€ëŠ¥ |
| ê°œë°œíŒ€ ì¡°ì§ | í•˜ë‚˜ì˜ íŒ€ ì¤‘ì‹¬ ê°œë°œ    | ì„œë¹„ìŠ¤ë³„ ë…ë¦½ íŒ€ ìš´ì˜ ê°€ëŠ¥          |

------

### 3ï¸âƒ£ ì£¼ìš” íŠ¹ì§•

#### 1. ë…ë¦½ ë°°í¬ ê°€ëŠ¥ì„±

- ì„œë¹„ìŠ¤ëŠ” ë…ë¦½ì ìœ¼ë¡œ ë°°í¬ë¨ (CI/CD íŒŒì´í”„ë¼ì¸ êµ¬ì„± ìš©ì´)

#### 2. ì„œë¹„ìŠ¤ ê²½ê³„ ëª…í™•í™”

- ê° ì„œë¹„ìŠ¤ëŠ” **ëª…í™•í•œ ê²½ê³„(Context Boundary)** ë¥¼ ê°€ì§ â†’ ë„ë©”ì¸ ì£¼ë„ ì„¤ê³„(DDD)ì™€ ì˜ ê²°í•©ë¨

#### 3. ììœ¨ì„±

- ê° ì„œë¹„ìŠ¤ëŠ” ë…ë¦½ëœ **DB / ê¸°ìˆ  ìŠ¤íƒ / ê°œë°œíŒ€**ì„ ê°€ì§ˆ ìˆ˜ ìˆìŒ

#### 4. ê³ ê°€ìš©ì„± & í™•ì¥ì„±

- ì„œë¹„ìŠ¤ë³„ **ìŠ¤ì¼€ì¼ ì—… / ìŠ¤ì¼€ì¼ ì•„ì›ƒ** ê°€ëŠ¥

#### 5. ì¥ì•  ê²©ë¦¬

- í•˜ë‚˜ì˜ ì„œë¹„ìŠ¤ ì¥ì• ê°€ ì „ì²´ ì‹œìŠ¤í…œìœ¼ë¡œ ì „íŒŒë˜ì§€ ì•Šë„ë¡ ì„¤ê³„ ê°€ëŠ¥

------

### 4ï¸âƒ£ MSA ê¸°ë³¸ êµ¬ì„±ìš”ì†Œ

| êµ¬ì„± ìš”ì†Œ                             | ì„¤ëª…                                                        |
| ------------------------------------- | ----------------------------------------------------------- |
| API Gateway                           | í´ë¼ì´ì–¸íŠ¸ ìš”ì²­ì„ ìˆ˜ì§‘í•˜ê³  ë¼ìš°íŒ…                           |
| ì„œë¹„ìŠ¤ ë””ìŠ¤ì»¤ë²„ë¦¬ (Service Discovery) | ì„œë¹„ìŠ¤ ì¸ìŠ¤í„´ìŠ¤ ë™ì  ë“±ë¡ ë° íƒìƒ‰                           |
| Configuration Server                  | ì„œë¹„ìŠ¤ êµ¬ì„± ì •ë³´ ì¤‘ì•™ ê´€ë¦¬                                  |
| ë¶„ì‚° íŠ¸ëœì­ì…˜ ê´€ë¦¬                    | ì„œë¹„ìŠ¤ ê°„ ë°ì´í„° ì •í•©ì„± í™•ë³´                                |
| ì„œë¹„ìŠ¤ê°„ í†µì‹                          | REST, gRPC, ë©”ì‹œì§€ í(Kafka, RabbitMQ) ì‚¬ìš©                 |
| ì¤‘ì•™ ë¡œê¹… / ëª¨ë‹ˆí„°ë§                  | ë¶„ì‚° í™˜ê²½ì—ì„œ ë¡œê·¸, ë©”íŠ¸ë¦­ ìˆ˜ì§‘ ë° ëª¨ë‹ˆí„°ë§                 |
| ë³´ì•ˆ                                  | OAuth2, JWT ê¸°ë°˜ ì¸ì¦/ì¸ê°€ êµ¬í˜„                             |
| í…ŒìŠ¤íŠ¸ ì „ëµ                           | ì„œë¹„ìŠ¤ ë‹¨ìœ„ í…ŒìŠ¤íŠ¸, ê³„ì•½ ê¸°ë°˜ í…ŒìŠ¤íŠ¸(Contract Testing) ì ìš© |

------

### 5ï¸âƒ£ ìŠ¤í”„ë§ ê¸°ë°˜ MSA êµ¬ì„± ì˜ˆì‹œ

| ì—­í•                         | ê¸°ìˆ  ìŠ¤íƒ ì˜ˆì‹œ                              |
| --------------------------- | ------------------------------------------- |
| API Gateway                 | Spring Cloud Gateway / Zuul                 |
| Service Discovery           | Eureka / Consul                             |
| Config Server               | Spring Cloud Config                         |
| Inter-Service Communication | REST (Feign), ë©”ì‹œì§• (Kafka)                |
| Circuit Breaker             | Resilience4j                                |
| Distributed Tracing         | Spring Cloud Sleuth + Zipkin/Jaeger         |
| Centralized Logging         | ELK Stack (Elasticsearch, Logstash, Kibana) |
| Security                    | Spring Security + OAuth2 + JWT              |

------

### 6ï¸âƒ£ MSA ë„ì…ì˜ ì¥ì ê³¼ ë‹¨ì 

#### ì¥ì 

- ìœ ì—°í•œ í™•ì¥ì„±
- ì¥ì•  ê²©ë¦¬ ê°€ëŠ¥
- ë¹ ë¥¸ ë…ë¦½ ë°°í¬ ê°€ëŠ¥
- ë‹¤ì–‘í•œ ê¸°ìˆ  ìŠ¤íƒ í™œìš© ê°€ëŠ¥
- ì¡°ì§ êµ¬ì¡°ì™€ ì˜ ë§¤í•‘ (íŒ€ ë‹¨ìœ„ ì„œë¹„ìŠ¤ ì†Œìœ )

#### ë‹¨ì 

- ì‹œìŠ¤í…œ ë³µì¡ì„± ì¦ê°€
- ì„œë¹„ìŠ¤ ê°„ í†µì‹  ë° ë°ì´í„° ì •í•©ì„± ê´€ë¦¬ í•„ìš”
- ìš´ì˜/ëª¨ë‹ˆí„°ë§/ë°°í¬ í™˜ê²½ ê³ ë„í™” í•„ìš”
- ê°œë°œ/í…ŒìŠ¤íŠ¸ ë‚œì´ë„ ìƒìŠ¹
- ì´ˆê¸° ì„¤ê³„ ë¹„ìš© ì¦ê°€

------

### 7ï¸âƒ£ ì „í˜•ì ì¸ MSA ì˜ˆì‹œ ì•„í‚¤í…ì²˜

```
+------------+
|   Client   |
+------------+
       |
       v
+----------------+                      +-------------------+
|  API Gateway   |--------------------->|  Auth Service      |
+----------------+                      +-------------------+
       |                                +-------------------+
       |------------------------------->|  User Service      |
       |                                +-------------------+
       |------------------------------->|  Order Service     |
       |                                +-------------------+
       |------------------------------->|  Payment Service   |
       |                                +-------------------+
       |------------------------------->|  Notification Svc  |
                                        +-------------------+

Supporting Components:

+-----------------------+
| Configuration Server  |
+-----------------------+

+---------------------------+
| Eureka (Service Registry) |
+---------------------------+

+-----------------------+
| Kafka (Event Bus)     |
+-----------------------+

+-----------------------+
| Redis (Caching)       |
+-----------------------+

+-----------------------+
| Centralized Logging   |
| (ELK Stack or similar)|
+-----------------------+

+-----------------------+
| Zipkin (Tracing)      |
+-----------------------+

```

------

### 8ï¸âƒ£ MSA ë„ì… ì‹œ ê³ ë ¤ ì‚¬í•­

 âœ… ì¡°ì§/íŒ€ êµ¬ì„±ë¶€í„° MSA ì¹œí™”ì ìœ¼ë¡œ ìš´ì˜ í•„ìš”
 âœ… ë°°í¬ ìë™í™” í•„ìˆ˜ (CI/CD Pipeline)
 âœ… ë¶„ì‚° í™˜ê²½ì—ì„œ ì¥ì•  íƒì§€ / ë³µêµ¬ ì²´ê³„ êµ¬ì¶• í•„ìš”
 âœ… ë°ì´í„° ë¶„ì‚°/ì¼ê´€ì„± ì²˜ë¦¬ ì „ëµ ì„¤ê³„
 âœ… ì„œë¹„ìŠ¤ê°„ í†µì‹  ë°©ì‹ (ë™ê¸° vs ë¹„ë™ê¸°) ì„¤ê³„

------

### 9ï¸âƒ£ ì ìš© ì‹œê¸° ê°€ì´ë“œ

| ìƒí™©                                  | ì¶”ì²œ ì•„í‚¤í…ì²˜ |
| ------------------------------------- | ------------- |
| ì‘ì€ ìŠ¤íƒ€íŠ¸ì—…, ì´ˆê¸° MVP               | ëª¨ë†€ë¦¬ì‹ ìš°ì„  |
| ì¤‘ê²¬ ì´ìƒ ì¡°ì§, ë‹¤ìˆ˜ ê°œë°œíŒ€ ë³‘ë ¬ ìš´ì˜ | MSA ì ê·¹ ê³ ë ¤ |
| ë†’ì€ ì„œë¹„ìŠ¤ ì•ˆì •ì„±ê³¼ í™•ì¥ì„± ìš”êµ¬      | MSA ìš°ì„  ê³ ë ¤ |
| ì„œë¹„ìŠ¤ê°€ ëª…í™•í•œ ê²½ê³„ë¡œ ë‚˜ë‰˜ëŠ” ê²½ìš°    | MSA ì í•©      |

------

### 1ï¸âƒ£0ï¸âƒ£ ê²°ë¡ 

MSAëŠ” **ê¸°ìˆ ì  ì¥ì **ë¿ë§Œ ì•„ë‹ˆë¼
 **ì¡°ì§ì  ë¯¼ì²©ì„±**ì„ ë†’ì´ê³  **ì„œë¹„ìŠ¤ í’ˆì§ˆê³¼ í™•ì¥ì„±**ì„ í™•ë³´í•˜ëŠ” ê°•ë ¥í•œ ì„¤ê³„ íŒ¨í„´ì´ë‹¤.

ë‹¨, **ìš´ì˜ ë³µì¡ì„±**ê³¼ **ê¸°ìˆ ì  ë‚œì´ë„**ê°€ ë†’ì•„ì§€ë¯€ë¡œ
 **ì¶©ë¶„í•œ ì¤€ë¹„ì™€ ê²½í—˜ ì¶•ì  í›„ ë‹¨ê³„ì  ì „í™˜**í•˜ëŠ” ì ‘ê·¼ì´ ë°”ëŒì§í•˜ë‹¤.

## Eureka (Service Discovery)

### 1ï¸âƒ£ Service Discoveryë€?

#### ê¸°ë³¸ ê°œë…

- ë§ˆì´í¬ë¡œì„œë¹„ìŠ¤ í™˜ê²½ì—ì„œëŠ” **ì„œë¹„ìŠ¤ ì¸ìŠ¤í„´ìŠ¤ê°€ ë™ì ìœ¼ë¡œ ëŠ˜ê³  ì¤„ê³ ** í•¨
- ì„œë¹„ìŠ¤ ì¸ìŠ¤í„´ìŠ¤ê°€ ì–´ëŠ ì„œë²„ì— ì–´ë–¤ í¬íŠ¸ì—ì„œ ë™ì‘í•˜ëŠ”ì§€ **ê³ ì •ì ìœ¼ë¡œ ì•Œ ìˆ˜ ì—†ìŒ**
- ê·¸ë˜ì„œ **ì„œë¹„ìŠ¤ ë ˆì§€ìŠ¤íŠ¸ë¦¬(Registry)** ë¼ëŠ” ì¤‘ì•™ ëª©ë¡ì— ì„œë¹„ìŠ¤ë“¤ì´ **ìê¸° ìì‹ ì„ ë“±ë¡í•˜ê³ **, ë‹¤ë¥¸ ì„œë¹„ìŠ¤ëŠ” ê±°ê¸°ì„œ **ìœ„ì¹˜ ì •ë³´ë¥¼ ì¡°íšŒ**í•¨ â†’ Service Discovery

#### ì£¼ìš” ì—­í• 

- **ì„œë¹„ìŠ¤ ë“±ë¡ (Service Registration)** â†’ ì„œë¹„ìŠ¤ê°€ ë¶€íŒ… ì‹œ Registry ì— ìì‹  ë“±ë¡
- **ì„œë¹„ìŠ¤ ì¡°íšŒ (Service Lookup)** â†’ í´ë¼ì´ì–¸íŠ¸ê°€ í•´ë‹¹ ì„œë¹„ìŠ¤ì˜ ìœ„ì¹˜(í˜¸ìŠ¤íŠ¸/í¬íŠ¸)ë¥¼ Registry ì— ì§ˆì˜
- **ìƒíƒœ ì²´í¬ (Heartbeat)** â†’ ì„œë¹„ìŠ¤ê°€ ì£¼ê¸°ì ìœ¼ë¡œ ì‚´ì•„ìˆìŒì„ ì•Œë¦¼
- **ë ˆì§€ìŠ¤íŠ¸ë¦¬ ê°±ì‹ ** â†’ ë” ì´ìƒ ì‚´ì•„ìˆì§€ ì•Šì€ ì„œë¹„ìŠ¤ëŠ” ì œê±°ë¨

------

### 2ï¸âƒ£ Eurekaë€?

- ë„·í”Œë¦­ìŠ¤(Netflix)ê°€ ê°œë°œí•œ **Service Discovery Server**
- Spring Cloud ì—ì„œ **Spring Cloud Netflix Eureka** ë¡œ í†µí•© ì œê³µ
- REST ê¸°ë°˜ìœ¼ë¡œ ë™ì‘
- ë§¤ìš° ê°€ë²¼ìš°ë©° **Spring Boot + Eureka**ëŠ” ì†ì‰½ê²Œ ì—°ë™ ê°€ëŠ¥

------

### 3ï¸âƒ£ êµ¬ì„±ìš”ì†Œ

| êµ¬ì„± ìš”ì†Œ        | ì—­í•                                                          |
| ---------------- | ------------------------------------------------------------ |
| Eureka Server    | Service Registry ì—­í•  (ì¤‘ì•™ ì„œë²„)                            |
| Eureka Client    | ì„œë¹„ìŠ¤ ì• í”Œë¦¬ì¼€ì´ì…˜ì´ ë“±ë¡ ë° ì¡°íšŒ ìš”ì²­ (ì£¼ë¡œ ë§ˆì´í¬ë¡œì„œë¹„ìŠ¤) |
| Eureka Dashboard | ì„œë¹„ìŠ¤ ìƒíƒœ í™•ì¸ UI ì œê³µ (ì›¹ UI)                             |

------

### 4ï¸âƒ£ ê¸°ë³¸ ë™ì‘ íë¦„

```
+-------------+        +----------------+         +----------------+
| OrderService| -----> | Eureka Server  | <-----  | PaymentService |
|  (Client)   |        |   Registry     |         |  (Client)      |
|             | <----- |                | ----->  |                |
|  REST call  |        |    REST API    |         | REST call      |
+-------------+        +----------------+         +----------------+
```

1ï¸âƒ£ ì„œë¹„ìŠ¤ ì• í”Œë¦¬ì¼€ì´ì…˜ (OrderService, PaymentService) â†’ Eureka Serverì— ë“±ë¡

2ï¸âƒ£ ì„œë¹„ìŠ¤ë“¤ì€ ì£¼ê¸°ì ìœ¼ë¡œ Heartbeat ì „ì†¡ (lease ê°±ì‹ )

3ï¸âƒ£ ì„œë¹„ìŠ¤ë“¤ì€ Eureka Serverì— **ë‹¤ë¥¸ ì„œë¹„ìŠ¤ ìœ„ì¹˜ë¥¼ ì¡°íšŒ**í•´ì„œ ì§ì ‘ REST í˜¸ì¶œ

------

### 5ï¸âƒ£ Eureka êµ¬ì„± ë°©ë²• (Spring Boot ê¸°ë°˜ ì˜ˆì œ)

#### 5.1 Eureka Server ì„¤ì •

#### 1ï¸âƒ£ ì˜ì¡´ì„± ì¶”ê°€

```
<!-- build.gradle ì˜ˆì‹œ -->
implementation 'org.springframework.cloud:spring-cloud-starter-netflix-eureka-server'
```

#### 2ï¸âƒ£ ì„œë²„ ì• í”Œë¦¬ì¼€ì´ì…˜ ì„¤ì •

```
@SpringBootApplication
@EnableEurekaServer
public class EurekaServerApplication {
    public static void main(String[] args) {
        SpringApplication.run(EurekaServerApplication.class, args);
    }
}
```

#### 3ï¸âƒ£ application.yml ì„¤ì •

```
server:
  port: 8761

eureka:
  client:
    register-with-eureka: false
    fetch-registry: false
```

#### 4ï¸âƒ£ ê²°ê³¼

- http://localhost:8761 ìœ¼ë¡œ Eureka Dashboard í™•ì¸ ê°€ëŠ¥
- ë“±ë¡ëœ ì„œë¹„ìŠ¤ ëª©ë¡ ì¡°íšŒ ê°€ëŠ¥

------

#### 5.2 Eureka Client ì„¤ì •

#### 1ï¸âƒ£ ì˜ì¡´ì„± ì¶”ê°€

```
<!-- build.gradle ì˜ˆì‹œ -->
implementation 'org.springframework.cloud:spring-cloud-starter-netflix-eureka-client'
```

#### 2ï¸âƒ£ application.yml ì„¤ì •

```
spring:
  application:
    name: order-service

eureka:
  client:
    service-url:
      defaultZone: http://localhost:8761/eureka
```

#### 3ï¸âƒ£ ê²°ê³¼

- OrderService ê°€ Eureka Server ì— ë“±ë¡ë¨
- ë‹¤ë¥¸ ì„œë¹„ìŠ¤ì—ì„œ order-service ë¥¼ Eureka í†µí•´ ì¡°íšŒ ê°€ëŠ¥

------

### 6ï¸âƒ£ Eureka Heartbeat ë° Registry ê´€ë¦¬

- **Heartbeat ì£¼ê¸°**: ê¸°ë³¸ 30ì´ˆ
- **Registry ê°±ì‹  ì£¼ê¸°**: ê¸°ë³¸ 30ì´ˆ
- **Lease ë§Œë£Œ ì‹œê°„**: ê¸°ë³¸ 90ì´ˆ
  - ì„œë¹„ìŠ¤ê°€ ë‹¤ìš´ë˜ì–´ Heartbeat ê°€ ëŠê¸°ë©´ 90ì´ˆ í›„ ë ˆì§€ìŠ¤íŠ¸ë¦¬ì—ì„œ ì œê±°ë¨

------

### 7ï¸âƒ£ Eurekaì˜ ì¥ì 

 âœ… ê°„ë‹¨í•˜ê³  ê°€ë²¼ìš´ êµ¬ì„±
 âœ… Spring Cloud ì™€ ìì—°ìŠ¤ëŸ½ê²Œ í†µí•©
 âœ… REST ê¸°ë°˜ìœ¼ë¡œ ì‘ë™ â†’ HTTP API ì¹œìˆ™
 âœ… ì„œë¹„ìŠ¤ ìƒíƒœ ëª¨ë‹ˆí„°ë§ Dashboard ì œê³µ

------

### 8ï¸âƒ£ Eurekaì˜ ë‹¨ì  ë° í•œê³„

 âŒ Netflix ê°€ **2021ë…„ ì´í›„ë¡œ ë©”ì¸í…Œì¸ ì¤‘ë‹¨**
 âŒ ë™ì  í™•ì¥ì„± ì¸¡ë©´ì—ì„œ Kubernetes ì„œë¹„ìŠ¤ ë””ìŠ¤ì»¤ë²„ë¦¬ë³´ë‹¤ ìœ ì—°ì„± ë–¨ì–´ì§
 âŒ Strong Consistency ë³´ì¥ ì•ˆë¨ (Eventually Consistent) â†’ ë³µì œ ì¤‘ê°„ì— ë ˆì§€ìŠ¤íŠ¸ë¦¬ ì°¨ì´ ê°€ëŠ¥ì„± ì¡´ì¬
 âŒ Spring Cloud Netflix ì „ë°˜ì ìœ¼ë¡œ **ê¸°ëŠ¥ ì¶•ì†Œ ë‹¨ê³„** (â†’ ëŒ€ì•ˆ: Consul, Nacos, Kubernetes ì„œë¹„ìŠ¤ ë””ìŠ¤ì»¤ë²„ë¦¬ ì‚¬ìš© ì¦ê°€ ì¤‘)

------

### 9ï¸âƒ£ Eureka ìš´ì˜ ì‹œ ê³ ë ¤ì‚¬í•­

 âœ… **Eureka Server HA êµ¬ì„± í•„ìš”** â†’ ìµœì†Œ 2ëŒ€ êµ¬ì„± (Cluster)
 âœ… **Eureka Client retry ì„¤ì •** ì˜ êµ¬ì„± (ë„¤íŠ¸ì›Œí¬ ì¥ì•  ëŒ€ë¹„)
 âœ… **ì„œë¹„ìŠ¤ íƒìƒ‰ API í˜¸ì¶œ ì‹œ Cache í™œìš© ê°€ëŠ¥**
 âœ… **ì„œë¹„ìŠ¤ ëª…ì„¸(Contract) ê´€ë¦¬ í•„ìš”** â†’ API ë³€ê²½ì— ì£¼ì˜

------

### 1ï¸âƒ£0ï¸âƒ£ ëŒ€ì•ˆ ê¸°ìˆ 

| ê¸°ìˆ                | íŠ¹ì§•                                                       |
| ------------------ | ---------------------------------------------------------- |
| Consul (HashiCorp) | Service Discovery + Key-Value Store + Health Check ê¸°ëŠ¥    |
| Nacos (Alibaba)    | ì„œë¹„ìŠ¤ ë“±ë¡/ì¡°íšŒ + êµ¬ì„± ê´€ë¦¬                               |
| Kubernetes Service | Kubernetes í™˜ê²½ì—ì„œ ê¸°ë³¸ ì œê³µ (DNS ê¸°ë°˜ ì„œë¹„ìŠ¤ ë””ìŠ¤ì»¤ë²„ë¦¬) |
| Zookeeper          | Strong consistency ê¸°ë°˜ Service Registry                   |

â†’ í˜„ì¬ëŠ” **Kubernetes + Istio/Linkerd + Kubernetes Service/Endpoint ê¸°ë°˜ Service Discovery** ì‚¬ìš©ì´ ì£¼ë¥˜

------

### 1ï¸âƒ£1ï¸âƒ£ ê²°ë¡ 

- **Eureka**ëŠ” MSA í™˜ê²½ì—ì„œ ê°€ì¥ ì‰½ê²Œ **Service Discovery**ë¥¼ êµ¬ì¶•í•  ìˆ˜ ìˆëŠ” í›Œë¥­í•œ ë„êµ¬ì˜€ìŒ
- **Spring Boot + Eureka** ì¡°í•©ì€ ë¹ ë¥¸ í•™ìŠµê³¼ êµ¬ì¶•ì— ì í•©
- ìš´ì˜ í™˜ê²½ì—ì„œëŠ” **HA êµ¬ì„±**, **í´ëŸ¬ìŠ¤í„° ì„¤ì •** í•„ìˆ˜
- Kubernetes í™˜ê²½ì—ì„œëŠ” **Kubernetes Service ê¸°ë°˜ Discovery**ë¥¼ ìš°ì„  ê³ ë ¤í•˜ëŠ” ê²ƒì´ ìµœê·¼ íŠ¸ë Œë“œ

## Config Server / Gateway / Zuul

### 1ï¸âƒ£ Config Server

#### ì—­í• 

- **ì¤‘ì•™ ì§‘ì¤‘í˜• êµ¬ì„± ê´€ë¦¬ ì„œë²„**
- ê° ì„œë¹„ìŠ¤ì˜ `application.yml` ë˜ëŠ” `application.properties` ë¥¼ ì¤‘ì•™ì—ì„œ ê´€ë¦¬
- ì„œë¹„ìŠ¤ê°€ ì‹¤í–‰ë  ë•Œ Config Server ì—ì„œ ì„¤ì •ì„ **ìë™ìœ¼ë¡œ ì½ì–´ì˜´**
- **í”„ë¡œíŒŒì¼(profile)** ë³„ë¡œ êµ¬ì„± ê´€ë¦¬ ê°€ëŠ¥ â†’ `dev`, `test`, `prod` í™˜ê²½ ë¶„ë¦¬

#### Spring Cloud Config Server êµ¬ì„±

| ê¸°ëŠ¥           | ì„¤ëª…                                                         |
| -------------- | ------------------------------------------------------------ |
| ì¤‘ì•™ ì„¤ì • ê´€ë¦¬ | Git / SVN / File System ê¸°ë°˜ ì„¤ì • ì €ì¥ì†Œ ì§€ì›                |
| ë™ì  ê°±ì‹       | Spring Cloud Bus + Kafka/RabbitMQ ë¥¼ ì´ìš©í•œ ì„¤ì • ë™ì  ë°˜ì˜ ì§€ì› |
| Profile ì§€ì›   | `application-dev.yml`, `application-prod.yml` ë“± í™˜ê²½ë³„ êµ¬ì„± ì§€ì› |
| ë³´ì•ˆ ê´€ë¦¬      | êµ¬ì„± ì •ë³´ì— ë³´ì•ˆ ì •ë³´ í¬í•¨ ê°€ëŠ¥ (ì•”í˜¸í™” ì§€ì›)                |

#### ë™ì‘ íë¦„

```
+-----------------+         +-------------------------+
|   Application   |  --->   | Spring Cloud Config Server |
+-----------------+         +-------------------------+
                                |
                                v
                       Git / File / SVN Repository
```

#### ê°„ë‹¨í•œ ì„¤ì • ì˜ˆì‹œ

```
spring:
  cloud:
    config:
      server:
        git:
          uri: https://github.com/my-org/config-repo
          clone-on-start: true
```

- í´ë¼ì´ì–¸íŠ¸ ì„œë¹„ìŠ¤ì—ì„œëŠ”:

```
spring:
  config:
    import: "configserver:"
```

------

### 2ï¸âƒ£ API Gateway

#### ì—­í• 

- í´ë¼ì´ì–¸íŠ¸ ìš”ì²­ì„ ë‚´ë¶€ ì„œë¹„ìŠ¤ë¡œ **ë¼ìš°íŒ…**
- ì„œë¹„ìŠ¤ì˜ ìœ„ì¹˜ë¥¼ í´ë¼ì´ì–¸íŠ¸ê°€ ì•Œ í•„ìš” ì—†ìŒ â†’ Gatewayê°€ ëŒ€ì‹  í†µì‹ 
- ê³µí†µ ê¸°ëŠ¥ì„ Gatewayì— ìœ„ì„:
  - ì¸ì¦/ì¸ê°€
  - ë¡œê¹…
  - íŠ¸ë˜í”½ ì œì–´ (Rate Limiting)
  - CORS ì²˜ë¦¬
  - Monitoring / Metrics ìˆ˜ì§‘
  - ìš”ì²­/ì‘ë‹µ ë³€í™˜

#### Spring Cloud Gateway

- Spring Cloud ì—ì„œ **Zuulì˜ í›„ì† ê¸°ìˆ **
- **Netty ê¸°ë°˜** â†’ ì„±ëŠ¥ ìš°ìˆ˜
- **ë¹„ë™ê¸° / Reactive ì§€ì›**

#### ì£¼ìš” ê¸°ëŠ¥

| ê¸°ëŠ¥            | ì„¤ëª…                                    |
| --------------- | --------------------------------------- |
| Path Routing    | URI ê²½ë¡œ ê¸°ë°˜ìœ¼ë¡œ ì„œë¹„ìŠ¤ ë¼ìš°íŒ…         |
| Load Balancing  | Spring Cloud LoadBalancer / Eureka ì—°ë™ |
| Filter ì ìš©     | Pre / Post / Global Filter ì§€ì›         |
| Rate Limiting   | API í˜¸ì¶œ ì œí•œ ê¸°ëŠ¥                      |
| Circuit Breaker | Resilience4j / Hystrix ì—°ê³„ ê°€ëŠ¥        |
| Security        | OAuth2 / JWT ê¸°ë°˜ ë³´ì•ˆ í•„í„° ì ìš© ê°€ëŠ¥   |

#### ê¸°ë³¸ íë¦„

```
+---------+      +----------------+      +------------------+
| Client  | ---> | API Gateway    | ---> | Internal Services|
+---------+      +----------------+      +------------------+
```

#### ì„¤ì • ì˜ˆì‹œ

```
spring:
  cloud:
    gateway:
      routes:
        - id: user-service
          uri: lb://user-service
          predicates:
            - Path=/users/**
```

- `lb://` â†’ Eureka ì™€ ì—°ë™ëœ ì„œë¹„ìŠ¤ëª… ì‚¬ìš©

------

### 3ï¸âƒ£ Zuul

#### Zuulì´ë€?

- ë„·í”Œë¦­ìŠ¤ì—ì„œ ê°œë°œí•œ **API Gateway/Edge Service**
- ì£¼ë¡œ **Zuul 1** (Servlet ê¸°ë°˜) ì‚¬ìš©ë¨ â†’ ë™ê¸° ê¸°ë°˜
- í˜„ì¬ëŠ” **Zuul 2**ê°€ ê°œë°œë˜ì—ˆì§€ë§Œ Spring Cloud ëŠ” Gateway ë¡œ ì „í™˜ ì¤‘

#### Zuul 1 vs Spring Cloud Gateway ë¹„êµ

| í•­ëª©     | Zuul 1                            | Spring Cloud Gateway                |
| -------- | --------------------------------- | ----------------------------------- |
| ì•„í‚¤í…ì²˜ | Servlet ê¸°ë°˜                      | Netty ê¸°ë°˜ (ë¹„ë™ê¸°)                 |
| ì„±ëŠ¥     | ë¹„êµì  ë‚®ìŒ (ë¸”ë¡œí‚¹ I/O)          | ë§¤ìš° ìš°ìˆ˜ (Non-blocking)            |
| ì§€ì›     | ë„·í”Œë¦­ìŠ¤ Zuul 1ëŠ” ë©”ì¸í…Œì¸ ì¤‘ë‹¨   | Springì—ì„œ Gateway ì ê·¹ ì§€ì›        |
| í•„í„°     | Pre / Post / Route / Error Filter | Global / Pre / Post / Custom Filter |
| í˜¸í™˜ì„±   | Spring Boot 1.x / 2.x             | Spring Boot 2.x / 3.x ì´í›„ ì¶”ì²œ     |

#### Zuul ì‚¬ìš© ì‹œ ì¥ì 

- êµ¬ì¶•ì´ ë§¤ìš° ì‰¬ì›€ (Spring Cloud Netflix Zuul)
- Zuul ìì²´ì— í•„í„° ì²´ì¸ ê°œë… ì œê³µ

#### Zuul ê°„ë‹¨í•œ ì„¤ì • ì˜ˆì‹œ

```
spring:
  application:
    name: gateway-service

zuul:
  routes:
    user-service:
      path: /users/**
      serviceId: user-service
```

- `serviceId` ë¥¼ í†µí•´ Eureka ì— ë“±ë¡ëœ ì„œë¹„ìŠ¤ë¡œ ë¼ìš°íŒ…

------

### 4ï¸âƒ£ í†µí•© ì•„í‚¤í…ì²˜ ê·¸ë¦¼

```
+------------+          +----------------+           +---------------------+
|   Client   |  ----->  | API Gateway    |  ----->   | Auth Service         |
+------------+          | (Zuul or SCG)  |  ----->   | User Service         |
                        +----------------+           | Order Service        |
                        |  Config Server |  ----->   | Payment Service      |
                        +----------------+           | Notification Service |
                                                     +---------------------+

+----------------------------+
| Eureka (Service Registry)  |
+----------------------------+

+----------------------------+
| Kafka / RabbitMQ (optional)|
+----------------------------+

+----------------------------+
| Centralized Logging (ELK)  |
+----------------------------+

+----------------------------+
| Zipkin / Jaeger (Tracing)  |
+----------------------------+
```

------

### 5ï¸âƒ£ ê²°ë¡ 

| êµ¬ì„± ìš”ì†Œ                 | ì—­í•                                                  |
| ------------------------- | ---------------------------------------------------- |
| Config Server             | êµ¬ì„± ê´€ë¦¬ ì¤‘ì•™í™” (Git ê¸°ë°˜ ì„¤ì • ê´€ë¦¬)                |
| API Gateway (SCG or Zuul) | API ë¼ìš°íŒ…, ê³µí†µ ê¸°ëŠ¥ ì²˜ë¦¬ (Auth, Logging ë“±)        |
| Zuul                      | Servlet ê¸°ë°˜ì˜ API Gateway (ë ˆê±°ì‹œì— ì í•©)           |
| Spring Cloud Gateway      | ì°¨ì„¸ëŒ€ Gateway, ë¹„ë™ê¸° ì„±ëŠ¥ ìš°ìˆ˜, ì‹ ê·œ ì„œë¹„ìŠ¤ì— ê¶Œì¥ |

ğŸ‘‰ **í˜„ì¬ ê¶Œì¥ ë°©í–¥**:

- ìƒˆë¡œìš´ ì‹œìŠ¤í…œ êµ¬ì¶• ì‹œì—ëŠ” **Spring Cloud Gateway** ìš°ì„  ì‚¬ìš©
- Zuul ì€ **ë ˆê±°ì‹œ ì‹œìŠ¤í…œ ìœ ì§€ ë³´ìˆ˜**ì—ì„œë§Œ ì„ íƒ

ğŸ‘‰ Config Server ëŠ” **MSA í™˜ê²½ì—ì„œ ê±°ì˜ í•„ìˆ˜ ì¸í”„ë¼ êµ¬ì„± ìš”ì†Œ**ë¡œ ì‚¬ìš©

## API Gateway ì¸ì¦ í†µí•©

### 1ï¸âƒ£ ì™œ API Gatewayì—ì„œ ì¸ì¦ì„ ì²˜ë¦¬í• ê¹Œ?

#### ì „í†µì  êµ¬ì¡° ë¬¸ì œì 

- ì„œë¹„ìŠ¤ë§ˆë‹¤ ì¸ì¦ ê¸°ëŠ¥ì„ ì¤‘ë³µ êµ¬í˜„í•´ì•¼ í•¨
- ë™ì¼í•œ ì¸ì¦/ì¸ê°€ ë¡œì§ì´ ê° ì„œë¹„ìŠ¤ì— ì¤‘ë³µë¨
- ë³€ê²½ ì‹œ ê° ì„œë¹„ìŠ¤ ëª¨ë‘ ìˆ˜ì • í•„ìš”

#### Gateway ì¸ì¦ ì²˜ë¦¬ ì¥ì 

- í´ë¼ì´ì–¸íŠ¸ ìš”ì²­ì´ API Gatewayë¥¼ ë°˜ë“œì‹œ ê±°ì¹˜ë¯€ë¡œ **ê³µí†µ ì¸ì¦ ì ìš© ê°€ëŠ¥**
- ì¸ì¦ ì„±ê³µ ì—¬ë¶€ì— ë”°ë¼ ë‚´ë¶€ ì„œë¹„ìŠ¤ ì ‘ê·¼ ì—¬ë¶€ ê²°ì •
- ì„œë¹„ìŠ¤ëŠ” **ìˆœìˆ˜ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì— ì§‘ì¤‘** ê°€ëŠ¥ â†’ ì¸ì¦ ë¶€ë‹´ ì œê±°
- JWT ê¸°ë°˜ ì‚¬ìš© ì‹œ **Stateless ì¸ì¦ êµ¬ì¡° êµ¬í˜„ ìš©ì´**

------

### 2ï¸âƒ£ API Gateway ì¸ì¦ í†µí•© êµ¬ì„±

```
+------------+    HTTP + TOKEN    +----------------+    INTERNAL CALL    +----------------+
|   Client   | --------------->  |   API Gateway   | -----------------> | Internal Service|
+------------+                   +----------------+                     +----------------+

                                   |
                                   v
                        +---------------------+
                        | Auth Service (Token) |
                        +---------------------+
```

#### íë¦„ ì„¤ëª…

 1ï¸âƒ£ Client â†’ API Gateway ì— ìš”ì²­ ì‹œ **Access Token (ex: JWT)** í¬í•¨
 2ï¸âƒ£ API Gateway ëŠ” í† í° ê²€ì¦ ìˆ˜í–‰ (ìì²´ ê²€ì¦ or Auth Service í˜¸ì¶œ)
 3ï¸âƒ£ ê²€ì¦ ì„±ê³µ ì‹œ Internal Service ë¡œ ìš”ì²­ ì „ë‹¬
 4ï¸âƒ£ Internal Service ì—ì„œëŠ” ë³„ë„ì˜ ì¸ì¦ ì²˜ë¦¬ ìƒëµ ê°€ëŠ¥ (ë‹¨, ì¸ê°€ ê²€ì¦ì€ í•„ìš”í•  ìˆ˜ ìˆìŒ)

------

### 3ï¸âƒ£ ì¸ì¦ í†µí•© ì‹œ ê¸°ìˆ ì  êµ¬ì„± ìš”ì†Œ

| ìš”ì†Œ            | ì£¼ìš” ê¸°ìˆ  ì˜ˆì‹œ                                        |
| --------------- | ----------------------------------------------------- |
| API Gateway     | Spring Cloud Gateway (SCG), Zuul, Kong, Nginx         |
| ì¸ì¦ í”„ë¡œí† ì½œ   | OAuth2, OpenID Connect, JWT ê¸°ë°˜                      |
| í† í° ìœ í˜•       | JWT (Access Token), Refresh Token                     |
| Auth Provider   | OAuth2 Provider (Keycloak, Auth0, Cognito, ìì²´ êµ¬í˜„) |
| Token ê²€ì¦ ë°©ë²• | Gatewayì—ì„œ ê²€ì¦ or Auth Serviceì— ê²€ì¦ ìœ„ì„          |

------

### 4ï¸âƒ£ ì¸ì¦ ì²˜ë¦¬ ë°©ë²• íŒ¨í„´

#### ë°©ë²• 1: API Gatewayì—ì„œ ì§ì ‘ JWT ê²€ì¦

- Gateway ì— **Public Key (RSA/EC)** ì„¤ì •
- Gateway í•„í„°ì—ì„œ JWT Signature ê²€ì¦
- ê²€ì¦ í›„ ìœ íš¨í•œ ìš”ì²­ë§Œ Internal Service ì— ì „ë‹¬
- ë§¤ìš° ë¹ ë¥´ê³  í™•ì¥ì„± ë†’ìŒ

#### ë°©ë²• 2: API Gatewayê°€ Auth Serviceì— ê²€ì¦ ìš”ì²­

- Gatewayê°€ Auth Service API ë¥¼ í˜¸ì¶œí•´ Token ìœ íš¨ì„± ê²€ì¦
- ì¥ì : ì¤‘ì•™í™”ëœ ê²€ì¦ ë¡œì§ ì‚¬ìš©
- ë‹¨ì : Gateway <-> Auth Service í˜¸ì¶œ ì‹œ ì˜¤ë²„í—¤ë“œ ë°œìƒ

#### ë°©ë²• 3: Hybrid íŒ¨í„´

- GatewayëŠ” **Signature ê²€ì¦** + ì¼ë¶€ Claim í™•ì¸ â†’ ë¹ ë¥¸ í•„í„°ë§
- í•„ìš”í•œ ê²½ìš° Auth Service ë¡œ ì¶”ê°€ ê²€ì¦ ìš”ì²­ (ex: Token Blacklist ì—¬ë¶€ í™•ì¸ ë“±)

------

### 5ï¸âƒ£ Spring Cloud Gateway + ì¸ì¦ í†µí•© ì˜ˆì‹œ

#### í•„í„° êµ¬ì„± íë¦„

```
@Component
public class AuthenticationFilter implements GlobalFilter, Ordered {

    @Override
    public Mono<Void> filter(ServerWebExchange exchange, GatewayFilterChain chain) {

        ServerHttpRequest request = exchange.getRequest();

        // 1. í† í° ì¶”ì¶œ
        String token = extractToken(request);

        // 2. í† í° ê²€ì¦
        if (isValid(token)) {
            // 3. ì¸ì¦ ì •ë³´ Context ì— ì£¼ì… (í•„ìš” ì‹œ)
            return chain.filter(exchange);
        } else {
            exchange.getResponse().setStatusCode(HttpStatus.UNAUTHORIZED);
            return exchange.getResponse().setComplete();
        }
    }

    // êµ¬í˜„ ì˜ˆì‹œ
    private String extractToken(ServerHttpRequest request) {
        return request.getHeaders().getFirst(HttpHeaders.AUTHORIZATION)
                .replace("Bearer ", "");
    }

    private boolean isValid(String token) {
        // JWT signature ê²€ì¦ or Auth Service í˜¸ì¶œ
        return JwtUtils.verify(token); // ì˜ˆì‹œ
    }

    @Override
    public int getOrder() {
        return -1; // ë†’ì€ ìš°ì„ ìˆœìœ„
    }
}
```

------

### 6ï¸âƒ£ ì‹¤ì „ êµ¬ì„± ì‹œ ê³ ë ¤ì‚¬í•­

#### í•„ìˆ˜ ê³ ë ¤ ìš”ì†Œ

 âœ… **Token Expiration ê´€ë¦¬**
 âœ… **Refresh Token ì „ëµ í•„ìš”** (ì£¼ê¸°ì  ì¬ë°œê¸‰)
 âœ… **Token Revocation ê´€ë¦¬** (Logout / Token Blacklist ë“±)
 âœ… **Public Key êµì²´ (Key Rotation)** ê´€ë¦¬ í•„ìš”
 âœ… **Authorization ì •ë³´ ì „ë‹¬ ë°©ì‹** (ex: role/authority Claim ì „ë‹¬ ì—¬ë¶€)
 âœ… **Internal Service ì— ì „ë‹¬ ì‹œ ìµœì†Œí•œì˜ ì •ë³´ë§Œ í¬í•¨ ê¶Œì¥**

------

### 7ï¸âƒ£ ì¸ê°€(Authorization) ì²˜ë¦¬ íŒ¨í„´

| ìœ„ì¹˜             | ì²˜ë¦¬ ë°©ë²•                                                    |
| ---------------- | ------------------------------------------------------------ |
| API Gateway      | ìµœì†Œ Role ê¸°ë°˜ ì¸ê°€ (ex: ADMINë§Œ íŠ¹ì • ì„œë¹„ìŠ¤ ì ‘ê·¼ í—ˆìš©)      |
| Internal Service | ìƒì„¸ ë¹„ì¦ˆë‹ˆìŠ¤ ì¸ê°€ (ex: íŠ¹ì • ì‚¬ìš©ìë§Œ ìì‹ ì˜ ë¦¬ì†ŒìŠ¤ ì ‘ê·¼ í—ˆìš©) |

#### Best Practice

- **ì¸ì¦ì€ Gatewayì—ì„œ ë‹´ë‹¹**
- **ì¸ê°€ì˜ ì„¸ë¶€ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì€ Service ë‚´ë¶€ì—ì„œ ì¶”ê°€ í™•ì¸**

------

### 8ï¸âƒ£ API Gateway ì¸ì¦ í†µí•© ì „ì²´ íë¦„ ì˜ˆì‹œ (JWT ê¸°ë°˜)

```
+------------+    +----------------+    +-------------------------+    +------------------+
|   Client   | -> | API Gateway    | -> | Internal Service(s)     | -> |  Database        |
| (JWT Token)|    | (JWT ê²€ì¦ í•„í„°) |    | (ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ + ì¶”ê°€ ì¸ê°€) |    |                  |
+------------+    +----------------+    +-------------------------+    +------------------+
                            |
                            v
                    +---------------------+
                    | Auth Service (Login,|
                    | Token ë°œê¸‰, Refresh) |
                    +---------------------+
```

------

### 9ï¸âƒ£ ëŒ€í‘œ êµ¬ì„± ì˜ˆì‹œ

| êµ¬ì„± ìš”ì†Œ             | ì¶”ì²œ ê¸°ìˆ                                                     |
| --------------------- | ------------------------------------------------------------ |
| API Gateway           | Spring Cloud Gateway (ìµœì‹  ì‹œìŠ¤í…œ)                           |
| ì¸ì¦ í”„ë¡œí† ì½œ         | OAuth2 + JWT                                                 |
| Token Provider        | Keycloak / Auth0 / Cognito / ìì²´ êµ¬ì¶• Auth Service          |
| Token ê²€ì¦ ë°©ë²•       | SCG í•„í„°ì—ì„œ ì§ì ‘ JWT ê²€ì¦ + í•„ìš”ì‹œ Auth Service í˜¸ì¶œ        |
| Token ì „ë‹¬            | Authorization: Bearer {AccessToken} í—¤ë” ì‚¬ìš©                |
| Refresh Token ì²˜ë¦¬    | Auth Service ì „ë‹´ ì²˜ë¦¬                                       |
| ë‚´ë¶€ ì„œë¹„ìŠ¤ Role ì „íŒŒ | JWT Claim í†µí•´ ì „ë‹¬ or Request Header ì—ì„œ í•„ìš”í•œ Claim ì¶”ì¶œ í›„ ì „ë‹¬ |

------

### 1ï¸âƒ£0ï¸âƒ£ ê²°ë¡ 

**API Gateway ì¸ì¦ í†µí•© ì„¤ê³„ ì‹œ í•µì‹¬ ì›ì¹™:**

 âœ… ì¸ì¦ì€ API Gateway ë‹¨ì—ì„œ í†µí•© ì²˜ë¦¬ â†’ ë‚´ë¶€ ì„œë¹„ìŠ¤ ì¸ì¦ ë¶€ë‹´ ì œê±°
 âœ… ì¸ê°€ëŠ” ì„œë¹„ìŠ¤ë³„ë¡œ ì ì ˆíˆ ë¶„ë¦¬ ì„¤ê³„ (Gateway ë‹¨ coarse-grained, Service ë‹¨ fine-grained)
 âœ… JWT ê¸°ë°˜ ì¸ì¦ìœ¼ë¡œ **Stateless êµ¬ì¡°** ì„¤ê³„ ê¶Œì¥
 âœ… Token ê´€ë¦¬ ì „ëµ (Expiration, Revocation, Rotation) ëª…í™•í•˜ê²Œ ìˆ˜ë¦½ í•„ìš”
 âœ… Gateway ì„±ëŠ¥ ê³ ë ¤ ì‹œ **Signature ê¸°ë°˜ Local ê²€ì¦ + í•„ìš” ì‹œ Auth Service í˜¸ì¶œ Hybrid êµ¬ì„± ì¶”ì²œ**

## Spring Cloud Bus, Sleuth, Zipkin

### 1ï¸âƒ£ Spring Cloud Bus

#### ê°œë…

- MSA í™˜ê²½ì—ì„œ **êµ¬ì„± ë³€ê²½ì´ë‚˜ ì´ë²¤íŠ¸ ë©”ì‹œì§€**ë¥¼ **ì„œë¹„ìŠ¤ ì „ì²´ì— ë¸Œë¡œë“œìºìŠ¤íŠ¸**í•˜ëŠ” ì—­í• 
- **Kafka / RabbitMQ** ê°™ì€ ë©”ì‹œì§€ ë¸Œë¡œì»¤ë¥¼ í†µí•´ ì„œë¹„ìŠ¤ ê°„ ë©”ì‹œì§€ ì „íŒŒ

#### ì£¼ ìš©ë„

| ìš©ë„                  | ì„¤ëª…                                                        |
| --------------------- | ----------------------------------------------------------- |
| Config ë³€ê²½ ë°˜ì˜      | Config Server ë³€ê²½ ì‚¬í•­ì„ ì „ì²´ ì„œë¹„ìŠ¤ì— ì‹¤ì‹œê°„ìœ¼ë¡œ ë°˜ì˜     |
| ì„œë¹„ìŠ¤ ê°„ ì´ë²¤íŠ¸ ì „íŒŒ | ìƒíƒœ ë³€ê²½, ìºì‹œ ë¬´íš¨í™”, ì‚¬ìš©ì ì´ë²¤íŠ¸ ë“± ì„œë¹„ìŠ¤ ê°„ ì „íŒŒ     |
| í™•ì¥ì„±                | ì„œë¹„ìŠ¤ ìˆ˜ê°€ ë§ì•„ë„ Bus ê¸°ë°˜ìœ¼ë¡œ íš¨ìœ¨ì ìœ¼ë¡œ ë©”ì‹œì§€ ì „íŒŒ ê°€ëŠ¥ |

#### íë¦„ ì˜ˆì‹œ (Config ë³€ê²½ ì‹œ)

```
Developer pushes config change â†’ Config Server Git Repo
      â†“
Spring Cloud Config Server ê°ì§€
      â†“
Spring Cloud Bus ë©”ì‹œì§€ ë°œí–‰ (Kafka / RabbitMQ)
      â†“
ê° ì„œë¹„ìŠ¤ ìˆ˜ì‹  â†’ /actuator/bus-refresh í˜¸ì¶œ â†’ config reload
```

#### ì£¼ìš” êµ¬ì„±

- Spring Cloud Config Server + Spring Cloud Bus + Kafka/RabbitMQ
- ì„œë¹„ìŠ¤ëŠ” `@RefreshScope` ì‚¬ìš© â†’ ë™ì  ê°±ì‹  ê°€ëŠ¥

#### ê°„ë‹¨í•œ ì˜ì¡´ì„± ì˜ˆì‹œ

```
implementation 'org.springframework.cloud:spring-cloud-starter-bus-amqp'   // RabbitMQ ê¸°ë°˜
implementation 'org.springframework.cloud:spring-cloud-starter-bus-kafka'  // Kafka ê¸°ë°˜
```

------

### 2ï¸âƒ£ Spring Cloud Sleuth

#### ê°œë…

- ë¶„ì‚° ì‹œìŠ¤í…œ(Distributed System)ì—ì„œ **ì„œë¹„ìŠ¤ ê°„ í˜¸ì¶œ ì¶”ì (Tracing)** ê¸°ëŠ¥ ì œê³µ
- ê° ì„œë¹„ìŠ¤ì˜ ë¡œê·¸ì— **Trace Id / Span Id** ë¥¼ ìë™ ì‚½ì…
- ì „ì²´ ì„œë¹„ìŠ¤ í˜¸ì¶œ ê²½ë¡œë¥¼ ì¶”ì í•  ìˆ˜ ìˆìŒ

#### ì£¼ ìš©ë„

| ìš©ë„                     | ì„¤ëª…                          |
| ------------------------ | ----------------------------- |
| ì„œë¹„ìŠ¤ ê°„ í˜¸ì¶œ ê²½ë¡œ ì¶”ì  | HTTP/gRPC í˜¸ì¶œ íë¦„ ì‹œê°í™”    |
| ë¬¸ì œ ë””ë²„ê¹…              | ì–´ë””ì—ì„œ ì§€ì—° ë°œìƒí•˜ëŠ”ì§€ íŒŒì•… |
| ì„±ëŠ¥ ë¶„ì„                | ì„œë¹„ìŠ¤ë³„ ì‘ë‹µ ì‹œê°„ ë¶„ì„       |

#### í•µì‹¬ ê°œë…

| ê°œë…           | ì„¤ëª…                                           |
| -------------- | ---------------------------------------------- |
| Trace Id       | í•˜ë‚˜ì˜ ì „ì²´ ìš”ì²­ íë¦„ ì‹ë³„ì (end-to-end)      |
| Span Id        | ê°œë³„ ì‘ì—…(Span) ì‹ë³„ì (HTTP í˜¸ì¶œ, DB ì¿¼ë¦¬ ë“±) |
| Parent Span Id | ìƒìœ„ Span ì‹ë³„ì (í˜¸ì¶œ ê´€ê³„ êµ¬ì„±)              |

#### íë¦„ ì˜ˆì‹œ

```
Client Request (Trace Id: X) â†’ API Gateway â†’ Order Service â†’ Payment Service â†’ Inventory Service

â†’ ê° ë‹¨ê³„ì˜ ë¡œê·¸ì— ë™ì¼í•œ Trace Id ê°€ ì°í˜
â†’ Span Id ëŠ” ê° ë‹¨ê³„ë§ˆë‹¤ ë‹¤ë¦„
```

#### ìë™ ì—°ë™

- Sleuth ë¥¼ ì‚¬ìš©í•˜ë©´ **ë¡œê·¸ MDC (Mapped Diagnostic Context)** ì— TraceId, SpanId ê°€ ìë™ ì‚½ì…ë¨
- ex:

```
2025-06-12 10:15:30 [X-TraceId abc12345] [SpanId 789xyz] GET /orders/1
```

#### ì˜ì¡´ì„± ì˜ˆì‹œ

```
implementation 'org.springframework.cloud:spring-cloud-starter-sleuth'
```

------

### 3ï¸âƒ£ Zipkin

#### ê°œë…

- **ë¶„ì‚° ì¶”ì  ë°ì´í„°ë¥¼ ìˆ˜ì§‘/ì €ì¥/ì‹œê°í™”** í•˜ëŠ” ì˜¤í”ˆì†ŒìŠ¤ í”Œë«í¼
- Sleuth ì™€ í•¨ê»˜ ì‚¬ìš© â†’ Sleuth ê°€ Zipkin ì— ë°ì´í„°ë¥¼ ì „ì†¡

#### ì£¼ìš” ê¸°ëŠ¥

| ê¸°ëŠ¥                | ì„¤ëª…                                |
| ------------------- | ----------------------------------- |
| Trace ì‹œê°í™”        | ì„œë¹„ìŠ¤ í˜¸ì¶œ íë¦„ íŠ¸ë¦¬ í˜•íƒœë¡œ ì‹œê°í™” |
| í˜¸ì¶œ ì§€ì—° êµ¬ê°„ ë¶„ì„ | ì„œë¹„ìŠ¤ë³„ ì‘ë‹µ ì‹œê°„ ë¶„ì„             |
| ë³‘ëª© íƒì§€           | ëŠë¦° ì„œë¹„ìŠ¤ ë˜ëŠ” í˜¸ì¶œ êµ¬ê°„ íƒìƒ‰     |
| ë¬¸ì œ ì§„ë‹¨           | ì¥ì•  ì‹œ í˜¸ì¶œ íë¦„ í™•ì¸              |

#### êµ¬ì„± íë¦„

```
Service A â†’ Sleuth â†’ Zipkin Collector
Service B â†’ Sleuth â†’ Zipkin Collector
...
Zipkin UI â†’ http://localhost:9411 â†’ Trace ì¡°íšŒ ê°€ëŠ¥
```

#### êµ¬ì„± ìš”ì†Œ

| êµ¬ì„± ìš”ì†Œ                                    | ì—­í•                       |
| -------------------------------------------- | ------------------------- |
| Zipkin Collector                             | Trace ë°ì´í„° ìˆ˜ì§‘         |
| Storage (ex: MySQL, Elasticsearch, InMemory) | Trace ë°ì´í„° ì €ì¥         |
| Zipkin UI                                    | Trace ì‹œê°í™” ì œê³µ (ì›¹ UI) |

#### Sleuth + Zipkin ì—°ë™ ì˜ˆì‹œ

```
implementation 'org.springframework.cloud:spring-cloud-starter-zipkin'
```

application.yml:

```
spring:
  zipkin:
    base-url: http://localhost:9411
  sleuth:
    sampler:
      probability: 1.0   # 100% ìˆ˜ì§‘ (ìš´ì˜í™˜ê²½ì—ì„œëŠ” ë‚®ê²Œ ì„¤ì • ì¶”ì²œ)
```

â†’ Zipkin ì„œë²„ëŠ” Docker ë¡œë„ ì‰½ê²Œ ì‹¤í–‰ ê°€ëŠ¥:

```
docker run -d -p 9411:9411 openzipkin/zipkin
```

â†’ ì›¹ UI: http://localhost:9411

------

### 4ï¸âƒ£ ì„¸ ê°€ì§€ í†µí•© íë¦„ (ì „ì²´ ì•„í‚¤í…ì²˜)

```
+------------+       +----------------+       +----------------+
|   Client   | --->  | API Gateway     | --->  | Service A      |
+------------+       +----------------+       +----------------+
                          |                          |
                          |                          |
                          v                          v
                      Spring Cloud Sleuth         Spring Cloud Sleuth
                      + Trace Id / Span Id        + Trace Id / Span Id
                      + Logs                      + Logs
                          |                          |
                          +------------> Zipkin <----+

Config Change Flow:
Developer --> Git Repo --> Spring Cloud Config Server --> Spring Cloud Bus (Kafka/RabbitMQ) --> All Services

â†’ Config ë³€ê²½ì‹œ ì„œë¹„ìŠ¤ ìë™ ê°±ì‹ 
â†’ ì„œë¹„ìŠ¤ í˜¸ì¶œ íë¦„ì€ Sleuth + Zipkin ìœ¼ë¡œ ì¶”ì 
â†’ Logs ì—ëŠ” TraceId/SpanId ìë™ í¬í•¨
```

------

### 5ï¸âƒ£ ê²°ë¡ 

| êµ¬ì„± ìš”ì†Œ           | ì—­í•                                    | ì£¼ íš¨ê³¼              |
| ------------------- | -------------------------------------- | -------------------- |
| Spring Cloud Bus    | ì„œë¹„ìŠ¤ ê°„ ì´ë²¤íŠ¸/Config ë³€ê²½ ì „íŒŒ      | ìš´ì˜ íš¨ìœ¨ì„±          |
| Spring Cloud Sleuth | Trace Id/Span Id ê¸°ë°˜ ì„œë¹„ìŠ¤ í˜¸ì¶œ ì¶”ì  | ì¥ì•  ë¶„ì„, ë³‘ëª© íƒì§€ |
| Zipkin              | Trace ë°ì´í„° ìˆ˜ì§‘/ì‹œê°í™”               | í˜¸ì¶œ íë¦„ ê°€ì‹œí™”     |

------

### ì‹¤ì „ Best Practice

 âœ… Config ë³€ê²½ ìë™ ë°˜ì˜ â†’ **Config Server + Bus í•„ìˆ˜**
 âœ… ì„œë¹„ìŠ¤ í˜¸ì¶œ íë¦„ ì¶”ì  â†’ **Sleuth + Zipkin ì—°ê³„ í•„ìˆ˜**
 âœ… Zipkin ì—ì„œ **100% Sampling ì€ ê°œë°œí™˜ê²½ì—ì„œë§Œ ì‚¬ìš©**
 âœ… ìš´ì˜í™˜ê²½ì—ì„œëŠ” Sampling ë¹„ìœ¨ì„ ì¡°ì • (ex: 0.1 ~ 0.01)