# 15. ì™¸ë¶€ API ì—°ë™

## RestTemplate vs WebClient

Spring ì• í”Œë¦¬ì¼€ì´ì…˜ì—ì„œ ì™¸ë¶€ REST API í˜¸ì¶œì„ ì²˜ë¦¬í•  ë•ŒëŠ” ì£¼ë¡œ **RestTemplate** ë˜ëŠ” **WebClient**ë¥¼ ì‚¬ìš©í•œë‹¤.
 ì´ ë‘ ë¼ì´ë¸ŒëŸ¬ë¦¬ëŠ” ëª¨ë‘ **HTTP í´ë¼ì´ì–¸íŠ¸**ë¡œì„œ ë™ì‘í•˜ì§€ë§Œ, **ì•„í‚¤í…ì²˜**ì™€ **ê¸°ëŠ¥ì  íŠ¹ì„±**ì—ì„œ ì°¨ì´ê°€ ìˆë‹¤.

Spring 5 ì´í›„ë¶€í„°ëŠ” **WebClientê°€ RestTemplateì˜ í›„ì† ê¸°ìˆ **ë¡œ ê¶Œì¥ëœë‹¤.

------

### 1ï¸âƒ£ ê¸°ìˆ  ê°œìš”

| í•­ëª©      | RestTemplate                                 | WebClient                                        |
| --------- | -------------------------------------------- | ------------------------------------------------ |
| ë„ì… ì‹œê¸° | Spring 3.x                                   | Spring 5.x (WebFlux í¬í•¨)                        |
| íŒ¨ëŸ¬ë‹¤ì„  | ë™ê¸°(synchronous)                            | ë¹„ë™ê¸°(asynchronous), ë™ê¸° ëª¨ë‘ ì§€ì›             |
| ê¸°ë°˜ API  | Java HttpURLConnection, Apache HttpClient ë“± | Reactor Netty(ê¸°ë³¸), ë‹¤ë¥¸ HttpClientë¡œ êµì²´ ê°€ëŠ¥ |
| ì§€ì› ë°©ì‹ | ëª…ë ¹í˜•(Imperative)                           | ë°˜ì‘í˜•(Reactive), ëª…ë ¹í˜• ëª¨ë‘ ì§€ì›               |
| ì§€ì› ìƒíƒœ | deprecated ì˜ˆì • (í–¥í›„ ìœ ì§€ë³´ìˆ˜ë§Œ ì§„í–‰)       | Springì˜ ê³µì‹ ê¶Œì¥ í´ë¼ì´ì–¸íŠ¸                    |

------

### 2ï¸âƒ£ RestTemplate ì‚¬ìš©ë²• ğŸ› ï¸

#### ì˜ì¡´ì„± ì¶”ê°€ (Spring Boot Starter Web í¬í•¨ ì‹œ ê¸°ë³¸ ì œê³µ)

```
@Bean
public RestTemplate restTemplate(RestTemplateBuilder builder) {
    return builder.build();
}
```

#### ì˜ˆì‹œ ì‚¬ìš©

```
RestTemplate restTemplate = new RestTemplate();

String result = restTemplate.getForObject("https://api.example.com/data", String.class);

ResponseEntity<MyDto> response = restTemplate.postForEntity("https://api.example.com/data", requestBody, MyDto.class);
```

#### íŠ¹ì§•

 âœ… ì‚¬ìš©ë²•ì´ ë‹¨ìˆœí•˜ë©° ìµìˆ™í•œ ë™ê¸°ì  API íŒ¨í„´.
 âœ… Retrofitê³¼ ìœ ì‚¬í•œ ê°ê°ìœ¼ë¡œ ë¹ ë¥´ê²Œ REST í˜¸ì¶œ êµ¬í˜„ ê°€ëŠ¥.
 âŒ **ë¹„ë™ê¸° ì²˜ë¦¬ ë¶ˆê°€** â†’ ëŒ€ëŸ‰ í˜¸ì¶œ ì‹œ ë¸”ë¡œí‚¹ ë°œìƒ ê°€ëŠ¥ì„±.
 âŒ Spring 5 ì´í›„ì—ëŠ” ì ì§„ì  ìœ ì§€ë³´ìˆ˜ë§Œ ì˜ˆì •.

------

### 3ï¸âƒ£ WebClient ì‚¬ìš©ë²• ğŸš€

WebClientëŠ” Spring 5ì—ì„œ ë„ì…ëœ **ë¹„ë™ê¸° / ë…¼ë¸”ë¡œí‚¹ HTTP í´ë¼ì´ì–¸íŠ¸**ì´ë‹¤.
 ê¸°ë³¸ì ìœ¼ë¡œ **Reactor ê¸°ë°˜ Mono/Flux API**ë¥¼ ì‚¬ìš©í•˜ì§€ë§Œ, ë™ê¸° í˜¸ì¶œë„ ì§€ì›í•œë‹¤.

#### ì˜ì¡´ì„± ì¶”ê°€

```
<dependency>
    <groupId>org.springframework.boot</groupId>
    <artifactId>spring-boot-starter-webflux</artifactId>
</dependency>
```

#### Bean ë“±ë¡

```
@Bean
public WebClient webClient(WebClient.Builder builder) {
    return builder.baseUrl("https://api.example.com").build();
}
```

#### ì˜ˆì‹œ ì‚¬ìš©

##### ë¹„ë™ê¸° í˜¸ì¶œ (Reactive)

```
Mono<String> result = webClient.get()
    .uri("/data")
    .retrieve()
    .bodyToMono(String.class);

result.subscribe(response -> System.out.println("ì‘ë‹µ: " + response));
```

##### ë™ê¸° í˜¸ì¶œ

```
String result = webClient.get()
    .uri("/data")
    .retrieve()
    .bodyToMono(String.class)
    .block();
```

#### íŠ¹ì§•

 âœ… ë¹„ë™ê¸° / ë…¼ë¸”ë¡œí‚¹ ì§€ì› (ëŒ€ëŸ‰ íŠ¸ë˜í”½ ì²˜ë¦¬ì— ì í•©).
 âœ… ë™ê¸° í˜¸ì¶œë„ ê°€ëŠ¥ (`block()` ì‚¬ìš© ì‹œ).
 âœ… **Streaming**, **SSE(Server-Sent Events)**, **WebSocket** ì—°ê³„ë„ ì§€ì›.
 âœ… **Backpressure** ì§€ì› (Reactive Streams ê¸°ë°˜).
 âœ… **Connection Pool**ê³¼ Timeout ì„¤ì • ìœ ì—°.
 âœ… í˜„ëŒ€ì  API ì„¤ê³„.
 âŒ API ì„¤ê³„ê°€ RestTemplate ëŒ€ë¹„ ë‹¤ì†Œ ë³µì¡í•¨ (ì´ˆê¸° í•™ìŠµ í•„ìš”).

------

### 4ï¸âƒ£ ì£¼ìš” ë¹„êµí‘œ ğŸ—‚ï¸

| í•­ëª©            | RestTemplate                     | WebClient                           |
| --------------- | -------------------------------- | ----------------------------------- |
| ë™ê¸°/ë¹„ë™ê¸°     | ë™ê¸°                             | ë¹„ë™ê¸°(ê¸°ë³¸), ë™ê¸°ë„ ì§€ì›           |
| ì„±ëŠ¥            | ë™ê¸° ë¸”ë¡œí‚¹ â†’ ëŒ€ê·œëª¨ ìš”ì²­ì— ë¶ˆë¦¬ | ë…¼ë¸”ë¡œí‚¹ â†’ ê³ ì„±ëŠ¥                   |
| í”„ë¡œê·¸ë˜ë° ëª¨ë¸ | Imperative                       | Reactive / Imperative í˜¼ìš© ê°€ëŠ¥     |
| Streaming ì§€ì›  | ë¯¸ì§€ì›                           | ì§€ì› (Flux ê¸°ë°˜)                    |
| SSE ì§€ì›        | ë¯¸ì§€ì›                           | ì§€ì›                                |
| ìœ ì§€ë³´ìˆ˜ ìƒíƒœ   | Deprecated ì˜ˆì •                  | Spring ê³µì‹ ê¶Œì¥ ë°©í–¥               |
| í•™ìŠµ ê³¡ì„        | ë‚®ìŒ                             | ë‹¤ì†Œ ë†’ìŒ (Reactive íŒ¨í„´ ì´í•´ í•„ìš”) |

------

### 5ï¸âƒ£ ì‚¬ìš© ê¶Œì¥ ê°€ì´ë“œ ğŸ¯

| ìƒí™©                                      | ê¶Œì¥ í´ë¼ì´ì–¸íŠ¸             |
| ----------------------------------------- | --------------------------- |
| ê¸°ì¡´ ë ˆê±°ì‹œ ì‹œìŠ¤í…œ ìœ ì§€ë³´ìˆ˜               | RestTemplate ì‚¬ìš© ì§€ì† ê°€ëŠ¥ |
| ìƒˆë¡œìš´ í”„ë¡œì íŠ¸                           | WebClient ê¶Œì¥              |
| Reactive ê¸°ë°˜ ì• í”Œë¦¬ì¼€ì´ì…˜ (WebFlux ì‚¬ìš©) | WebClient í•„ìˆ˜              |
| ê³ ì„±ëŠ¥ API Gateway / Proxy êµ¬ì„±           | WebClient ê¶Œì¥              |
| ë‹¨ìˆœ REST í˜¸ì¶œ (ì ì€ ë¹ˆë„)                | RestTemplate ì‚¬ìš© ê°€ëŠ¥      |

------

### 6ï¸âƒ£ ë§ˆì´ê·¸ë ˆì´ì…˜ ì „ëµ ğŸš€

- RestTemplate ê¸°ë°˜ ê¸°ì¡´ APIëŠ” ìœ ì§€í•˜ë˜, ì‹ ê·œ APIëŠ” WebClientë¡œ ì„¤ê³„ ê¶Œì¥.
- Gradual Migration â†’ RestTemplate â†’ WebClientë¡œ ì ì§„ì  ì „í™˜.
- ëŒ€ê·œëª¨ ë³‘ë ¬ í˜¸ì¶œ, Streamingì´ í•„ìš”í•œ ì„œë¹„ìŠ¤ëŠ” WebClient ìš°ì„  ì ìš©.

------

### ê²°ë¡  ğŸ—‚ï¸

 âœ… RestTemplate â†’ ë‹¨ìˆœ ë™ê¸° í˜¸ì¶œ ì‹œ ê°„í¸í•˜ì§€ë§Œ, ë¯¸ë˜ ì§€í–¥ì  ì‚¬ìš©ì€ WebClient ê¶Œì¥.
 âœ… WebClient â†’ ê³ ì„±ëŠ¥, Reactive ì§€ì›, ëŒ€ê·œëª¨ íŠ¸ë˜í”½ ì²˜ë¦¬ì— ìœ ë¦¬.
 âœ… WebFlux ê¸°ë°˜ ì‹œìŠ¤í…œì—ì„œëŠ” WebClient í•„ìˆ˜ ì‚¬ìš©.
 âœ… í•™ìŠµ ê³¡ì„ ì€ ë‹¤ì†Œ ì¡´ì¬í•˜ë‚˜, í˜„ëŒ€ì ì¸ ì• í”Œë¦¬ì¼€ì´ì…˜ ì„¤ê³„ì—ëŠ” WebClientê°€ í‘œì¤€.

## OpenFeign ì‚¬ìš©ë²•

**OpenFeign**ì€ ì„ ì–¸ì (Declarative)ìœ¼ë¡œ HTTP API í´ë¼ì´ì–¸íŠ¸ë¥¼ ìƒì„±í•  ìˆ˜ ìˆëŠ” ë¼ì´ë¸ŒëŸ¬ë¦¬ì´ë‹¤.
 Spring Cloudì—ì„œëŠ” `spring-cloud-starter-openfeign`ë¥¼ í†µí•´ ì‰½ê²Œ í†µí•©í•  ìˆ˜ ìˆìœ¼ë©°, ì¸í„°í˜ì´ìŠ¤ ê¸°ë°˜ìœ¼ë¡œ ì™¸ë¶€ REST API í˜¸ì¶œì„ ë§¤ìš° ê°„ê²°í•˜ê²Œ êµ¬í˜„í•  ìˆ˜ ìˆë‹¤.

##### OpenFeignì€ ë‹¤ìŒê³¼ ê°™ì€ ì¥ì ì´ ìˆë‹¤:

- **ì¸í„°í˜ì´ìŠ¤ ê¸°ë°˜**ìœ¼ë¡œ API í˜¸ì¶œ ì •ì˜
- Boilerplate ì½”ë“œ ì œê±° â†’ ì½”ë“œ ê°„ê²°ì„± â†‘
- ë‹¤ì–‘í•œ í”ŒëŸ¬ê·¸ì¸ ì§€ì› (Load Balancer, Retry, Logging, Metrics ë“±)
- í†µí•©ì ì¸ ì—ëŸ¬ ì²˜ë¦¬ ë° ì»¤ìŠ¤í„°ë§ˆì´ì§• ìš©ì´
- Spring MVC ì–´ë…¸í…Œì´ì…˜ê³¼ ìì—°ìŠ¤ëŸ½ê²Œ ì—°ê³„

------

### 1ï¸âƒ£ ê¸°ë³¸ êµ¬ì„±

#### ì˜ì¡´ì„± ì¶”ê°€

```
<dependency>
    <groupId>org.springframework.cloud</groupId>
    <artifactId>spring-cloud-starter-openfeign</artifactId>
</dependency>
```

> âš ï¸ Feignì€ Spring Boot 3.0+ ì—ì„œ **Spring Cloud BOM** ê´€ë¦¬ í•„ìš”.
>  **spring-cloud-dependencies** BOMì„ ë°˜ë“œì‹œ importí•  ê²ƒ:

```
<dependencyManagement>
    <dependencies>
        <dependency>
            <groupId>org.springframework.cloud</groupId>
            <artifactId>spring-cloud-dependencies</artifactId>
            <version>Hoxton.SR12</version> <!-- ë²„ì „ í™•ì¸ í•„ìš” -->
            <type>pom</type>
            <scope>import</scope>
        </dependency>
    </dependencies>
</dependencyManagement>
```

------

### 2ï¸âƒ£ @EnableFeignClients

Feign Client ê¸°ëŠ¥ í™œì„±í™”ë¥¼ ìœ„í•´ `@EnableFeignClients` ì„ ì–¸ í•„ìš”.

```
@SpringBootApplication
@EnableFeignClients
public class MyApplication {
    public static void main(String[] args) {
        SpringApplication.run(MyApplication.class, args);
    }
}
```

------

### 3ï¸âƒ£ FeignClient ì¸í„°í˜ì´ìŠ¤ ì •ì˜ ğŸš€

ê°€ì¥ í•µì‹¬ì ì¸ ë¶€ë¶„ â†’ **ì¸í„°í˜ì´ìŠ¤ ê¸°ë°˜ìœ¼ë¡œ ì™¸ë¶€ API í˜¸ì¶œ ì„ ì–¸**.

```
@FeignClient(name = "exampleClient", url = "https://api.example.com")
public interface ExampleClient {

    @GetMapping("/data")
    String getData();

    @PostMapping("/data")
    ResponseEntity<MyDto> createData(@RequestBody MyDto dto);

    @GetMapping("/user/{id}")
    UserDto getUserById(@PathVariable("id") Long id);
}
```

#### ì£¼ìš” êµ¬ì„± ìš”ì†Œ

| ìš”ì†Œ                             | ì„¤ëª…                                                  |
| -------------------------------- | ----------------------------------------------------- |
| `@FeignClient`                   | Feign Client ì •ì˜, nameì€ Bean nameìœ¼ë¡œë„ ì‚¬ìš© ê°€ëŠ¥   |
| `url`                            | í˜¸ì¶œí•  ëŒ€ìƒ ì„œë²„ URL (LoadBalancer ì‚¬ìš© ì‹œ ìƒëµ ê°€ëŠ¥) |
| `@GetMapping`, `@PostMapping` ë“± | Spring MVC ìŠ¤íƒ€ì¼ì˜ ì„ ì–¸ì  ë§¤í•‘ ê°€ëŠ¥                  |
| ë©”ì„œë“œ ì¸ì                      | `@RequestBody`, `@PathVariable`, `@RequestParam` ì§€ì› |

------

### 4ï¸âƒ£ FeignClient ì‚¬ìš© ì˜ˆì‹œ

```
@Service
@RequiredArgsConstructor
public class MyService {

    private final ExampleClient exampleClient;

    public void process() {
        String data = exampleClient.getData();
        System.out.println("ìˆ˜ì‹  ë°ì´í„°: " + data);

        UserDto user = exampleClient.getUserById(42L);
        System.out.println("User: " + user);
    }
}
```

- **DI ì£¼ì…**ìœ¼ë¡œ ì¸í„°í˜ì´ìŠ¤ ì‚¬ìš© â†’ ë‚´ë¶€ì ìœ¼ë¡œ Proxyê°€ ì£¼ì…ë¨.
- ì½”ë“œì— ì§ì ‘ RestTemplate/WebClient ì‘ì„±í•  í•„ìš” ì—†ìŒ âœ¨.

------

### 5ï¸âƒ£ êµ¬ì„± íë¦„ ğŸ—‚ï¸

```
Application Startup â†’ @EnableFeignClients â†’ Feign Proxy Bean ìƒì„±
   â†“
Service Layer â†’ FeignClient ì¸í„°í˜ì´ìŠ¤ ì‚¬ìš©
   â†“
Feign Proxy â†’ HTTP í˜¸ì¶œ ìˆ˜í–‰ (RestTemplate or HttpClient ë‚´ë¶€ ì‚¬ìš© ê°€ëŠ¥)
   â†“
ì‘ë‹µ ë³€í™˜ í›„ ê²°ê³¼ ë¦¬í„´
```

------

### 6ï¸âƒ£ ê³ ê¸‰ ê¸°ëŠ¥

#### Logging ì„¤ì •

```
logging:
  level:
    com.example.client: DEBUG
    feign: DEBUG
```

Feign Clientë³„ ë¡œê·¸ ë ˆë²¨ ì„¤ì • ê°€ëŠ¥ â†’ HTTP ìš”ì²­/ì‘ë‹µ ë¡œê¹… í™•ì¸ ê°€ëŠ¥.

#### Timeout ì„¤ì •

```
feign:
  client:
    config:
      default:
        connectTimeout: 5000
        readTimeout: 10000
```

- ê¸°ë³¸ ì„¤ì •ì€ ëª¨ë“  FeignClientì— ì ìš©.
- íŠ¹ì • Client ëª…ìœ¼ë¡œ `config.{client-name}` ì„¤ì • ê°€ëŠ¥.

#### Retry ì„¤ì •

```
feign:
  client:
    config:
      default:
        retryer:
          period: 100
          maxPeriod: 1000
          maxAttempts: 3
```

- **ë‚´ì¥ Retryer ì‚¬ìš© ê°€ëŠ¥** â†’ ì¬ì‹œë„ ì „ëµ ì ìš©.

#### ErrorDecoder ì»¤ìŠ¤í„°ë§ˆì´ì§•

```
@Component
public class CustomErrorDecoder implements ErrorDecoder {

    private final ErrorDecoder defaultDecoder = new Default();

    @Override
    public Exception decode(String methodKey, Response response) {
        if (response.status() == 404) {
            return new NotFoundException("404 ì—ëŸ¬ ë°œìƒ");
        }
        return defaultDecoder.decode(methodKey, response);
    }
}
```

- ê¸€ë¡œë²Œ ErrorDecoder ë“±ë¡ ì‹œ ëª¨ë“  FeignClientì— ì ìš©ë¨.

------

### 7ï¸âƒ£ RestTemplate / WebClient / OpenFeign ë¹„êµ

| í•­ëª©              | RestTemplate | WebClient                          | OpenFeign                                |
| ----------------- | ------------ | ---------------------------------- | ---------------------------------------- |
| ì‚¬ìš© íŒ¨í„´         | ëª…ë ¹í˜•       | Reactive/ëª…ë ¹í˜•                    | ì„ ì–¸í˜•(ì¸í„°í˜ì´ìŠ¤ ê¸°ë°˜)                  |
| ë¹„ë™ê¸° ì§€ì›       | X            | O                                  | O(ë‚´ë¶€ì ìœ¼ë¡œ ê°€ëŠ¥í•˜ë‚˜ ê¸°ë³¸ì€ ë™ê¸°)       |
| ë¶€ê°€ ê¸°ëŠ¥         | ê±°ì˜ ì—†ìŒ    | ë§¤ìš° í’ë¶€                          | LoadBalancer, Retry, Metrics ë‚´ì¥        |
| ì½”ë“œ ê°„ê²°ì„±       | ì¤‘ê°„         | ë³µì¡ (Mono/Flux í•„ìš” ì‹œ)           | ë§¤ìš° ê°„ê²°                                |
| ì½”ë“œ ìœ ì§€ë³´ìˆ˜     | ë³´í†µ         | ë‹¤ì†Œ ì–´ë µë‹¤ (ReactiveëŠ” í•™ìŠµ í•„ìš”) | ë§¤ìš° ì‰½ë‹¤ (interface ê¸°ë°˜ ìœ ì§€ê´€ë¦¬ ìš©ì´) |
| Spring Cloud í†µí•© | ë³´í†µ         | ë³´í†µ                               | ë§¤ìš° ìš°ìˆ˜ (Spring Cloud í•µì‹¬ ê¸°ëŠ¥)       |

------

### ê²°ë¡  ğŸ—‚ï¸

 âœ… OpenFeignì€ ì„ ì–¸ì  HTTP í´ë¼ì´ì–¸íŠ¸ êµ¬ì„±ì— ìµœì í™”ë˜ì–´ ìˆìœ¼ë©°, Spring Cloud ê¸°ë°˜ì˜ ë§ˆì´í¬ë¡œì„œë¹„ìŠ¤ ì•„í‚¤í…ì²˜ì—ì„œ ë„ë¦¬ ì‚¬ìš©ëœë‹¤.
 âœ… @FeignClient ì¸í„°í˜ì´ìŠ¤ ê¸°ë°˜ìœ¼ë¡œ ì½”ë“œ ê°„ê²°ì„±ì„ í¬ê²Œ ë†’ì¸ë‹¤.
 âœ… ë‹¤ì–‘í•œ ë¶€ê°€ê¸°ëŠ¥(LoadBalancer, Retry, Metrics, Logging ë“±) ë‚´ì¥ â†’ ìš´ì˜ í™˜ê²½ì—ì„œ ìœ ë¦¬.
 âœ… RestTemplate/WebClientë³´ë‹¤ ê°œë°œ í¸ì˜ì„±ì´ ë†’ìœ¼ë‚˜, ê³ ì„±ëŠ¥ ë¹„ë™ê¸° ì²˜ë¦¬ í•„ìš” ì‹œ WebClientë„ ì—¬ì „íˆ ìœ íš¨í•˜ë‹¤.

## OAuth2 í´ë¼ì´ì–¸íŠ¸ ì—°ë™

ë§ì€ ì™¸ë¶€ API ì„œë¹„ìŠ¤ëŠ” **OAuth2 ê¸°ë°˜ ì¸ì¦**ì„ ìš”êµ¬í•œë‹¤.
 Spring Bootì—ì„œ OpenFeign ì‚¬ìš© ì‹œ, OAuth2 ì¸ì¦ í† í°(Access Token)ì„ ìë™ìœ¼ë¡œ ë°œê¸‰ë°›ì•„ Feign ìš”ì²­ì— í¬í•¨í•  ìˆ˜ ìˆë‹¤.

Spring Securityì™€ Spring Cloud OAuth2 Client ê¸°ëŠ¥ì„ ì´ìš©í•˜ë©´ **ìë™í™”ëœ í† í° ê´€ë¦¬**ì™€ **Feign Client ì—°ê³„**ë¥¼ ê°„í¸í•˜ê²Œ êµ¬ì„±í•  ìˆ˜ ìˆë‹¤.

------

### 1ï¸âƒ£ ê¸°ë³¸ êµ¬ì„± íë¦„

```
Application Startup â†’ OAuth2 ClientRegistration êµ¬ì„±
   â†“
OAuth2AuthorizedClientManagerê°€ Access Token ë°œê¸‰
   â†“
Feign RequestInterceptorê°€ Access Tokenì„ Authorization Headerì— ìë™ ì¶”ê°€
   â†“
Feign Client â†’ ì™¸ë¶€ API í˜¸ì¶œ ì‹œ OAuth2 ì¸ì¦ ì ìš©
```

ğŸ‘‰ í•µì‹¬ í¬ì¸íŠ¸ â†’ **Feignì— RequestInterceptor ë“±ë¡** + **OAuth2AuthorizedClientManager ì—°ê³„**.

------

### 2ï¸âƒ£ ì˜ì¡´ì„± ì¶”ê°€

```
<dependency>
    <groupId>org.springframework.boot</groupId>
    <artifactId>spring-boot-starter-oauth2-client</artifactId>
</dependency>

<dependency>
    <groupId>org.springframework.cloud</groupId>
    <artifactId>spring-cloud-starter-openfeign</artifactId>
</dependency>
```

------

### 3ï¸âƒ£ application.yml ì„¤ì •

OAuth2 ClientRegistration ì„¤ì • â†’ Client Credentials Flow ì˜ˆì‹œ.

```
spring:
  security:
    oauth2:
      client:
        registration:
          example-client:
            client-id: your-client-id
            client-secret: your-client-secret
            authorization-grant-type: client_credentials
            token-uri: https://auth.example.com/oauth/token
        provider:
          example-provider:
            token-uri: https://auth.example.com/oauth/token
```

#### ì£¼ìš” í¬ì¸íŠ¸

| í•­ëª©                                   | ì„¤ëª…                         |
| -------------------------------------- | ---------------------------- |
| registration.client-id / client-secret | OAuth2 Client Credentials    |
| authorization-grant-type               | Client Credentials Flow ì‚¬ìš© |
| token-uri                              | Token ë°œê¸‰ Endpoint          |

------

### 4ï¸âƒ£ OAuth2AuthorizedClientManager Bean êµ¬ì„±

```
@Configuration
public class OAuth2ClientConfig {

    @Bean
    public OAuth2AuthorizedClientManager authorizedClientManager(
            ClientRegistrationRepository clientRegistrationRepository,
            OAuth2AuthorizedClientService authorizedClientService) {

        OAuth2AuthorizedClientProvider authorizedClientProvider =
                OAuth2AuthorizedClientProviderBuilder.builder()
                    .clientCredentials()
                    .build();

        DefaultOAuth2AuthorizedClientManager authorizedClientManager =
                new DefaultOAuth2AuthorizedClientManager(clientRegistrationRepository, authorizedClientService);

        authorizedClientManager.setAuthorizedClientProvider(authorizedClientProvider);

        return authorizedClientManager;
    }
}
```

âœ… í•µì‹¬ â†’ **clientCredentials()** ì „ëµì„ ëª…ì‹œ â†’ Feign ìš”ì²­ ì‹œ OAuth2 í† í° ë°œê¸‰ ì§€ì›.

------

### 5ï¸âƒ£ Feign RequestInterceptor êµ¬ì„± ğŸš€

OpenFeign ìš”ì²­ ì‹œ Access Tokenì„ ìë™ìœ¼ë¡œ Authorization Headerì— ì¶”ê°€.

```
@Configuration
public class FeignClientOAuth2InterceptorConfig {

    private final OAuth2AuthorizedClientManager authorizedClientManager;

    public FeignClientOAuth2InterceptorConfig(OAuth2AuthorizedClientManager authorizedClientManager) {
        this.authorizedClientManager = authorizedClientManager;
    }

    @Bean
    public RequestInterceptor oauth2FeignRequestInterceptor() {
        return requestTemplate -> {
            OAuth2AuthorizeRequest authorizeRequest = OAuth2AuthorizeRequest.withClientRegistrationId("example-client")
                .principal("feign-client")
                .build();

            OAuth2AuthorizedClient authorizedClient = authorizedClientManager.authorize(authorizeRequest);

            if (authorizedClient != null) {
                String tokenValue = authorizedClient.getAccessToken().getTokenValue();
                requestTemplate.header("Authorization", "Bearer " + tokenValue);
            }
        };
    }
}
```

ğŸ‘‰ **RequestInterceptor**ë¥¼ ë“±ë¡í•˜ë©´ â†’ Feign Client ìš”ì²­ ì‹œ ìë™ìœ¼ë¡œ **Bearer Token** ì¶”ê°€ âœ¨.

------

### 6ï¸âƒ£ FeignClient ì„ ì–¸

```
@FeignClient(name = "exampleClient", url = "https://api.example.com")
public interface ExampleClient {

    @GetMapping("/protected-data")
    String getProtectedData();
}
```

#### Serviceì—ì„œ ì‚¬ìš©:

```
@Service
@RequiredArgsConstructor
public class ExampleService {

    private final ExampleClient exampleClient;

    public String callProtectedApi() {
        return exampleClient.getProtectedData();
    }
}
```

------

### 7ï¸âƒ£ ì¢…í•© êµ¬ì„± íë¦„ ğŸ—‚ï¸

```
Application Startup
   â†“
@EnableFeignClients â†’ FeignClient ë“±ë¡
   â†“
OAuth2AuthorizedClientManager êµ¬ì„±
   â†“
RequestInterceptor ë“±ë¡ â†’ Feign ìš”ì²­ ì‹œ Authorization Header ì¶”ê°€
   â†“
Feign Client í˜¸ì¶œ ì‹œ Access Token ìë™ ì ìš©
```

------

### 8ï¸âƒ£ ì£¼ì˜ì‚¬í•­ âš ï¸

- **Client Credentials Flow**ëŠ” ì¼ë°˜ì ìœ¼ë¡œ **ë¨¸ì‹ -íˆ¬-ë¨¸ì‹  í˜¸ì¶œ(M2M)** ì— ì í•©.
- OAuth2AuthorizedClientManagerëŠ” Access Tokenì˜ **ìºì‹±**ê³¼ **ìë™ ì¬ë°œê¸‰**ì„ ì§€ì›.
- ë‹¤ë¥¸ Flow(Authorization Code ë“±)ëŠ” í•„ìš” ì‹œ í•´ë‹¹ Provider ì¶”ê°€ êµ¬ì„± í•„ìš”.
- Token ë°œê¸‰ ë¹ˆë„ì™€ ìœ íš¨ ê¸°ê°„ ê´€ë¦¬ ì£¼ì˜ â†’ Rate Limit ëŒ€ì‘ í•„ìš”.

------

### ê²°ë¡  ğŸ—‚ï¸

 âœ… OpenFeign + OAuth2 Client ì—°ë™ ì‹œ **RequestInterceptor êµ¬ì„±**ìœ¼ë¡œ OAuth2 Token ìë™ ì²˜ë¦¬ ê°€ëŠ¥.
 âœ… OAuth2AuthorizedClientManager êµ¬ì„± â†’ Token ë°œê¸‰/ì¬ë°œê¸‰ ê´€ë¦¬ ìë™í™”.
 âœ… Client Credentials Flow ì™¸ ë‹¤ë¥¸ Flow(Authorization Code, Password, Refresh Token ë“±)ë„ ì§€ì› ê°€ëŠ¥.
 âœ… MSA í™˜ê²½ ë˜ëŠ” ì™¸ë¶€ API ì—°ë™ ì‹œ **ì¤‘ì•™ ì§‘ì¤‘ì  Token ê´€ë¦¬ êµ¬ì¡° ì„¤ê³„ ê°€ëŠ¥** â†’ ìš´ì˜ íš¨ìœ¨ì„± í–¥ìƒ.

## íƒ€ì„ì•„ì›ƒ, ì¬ì‹œë„, ì„œí‚· ë¸Œë ˆì´ì»¤

ë§ˆì´í¬ë¡œì„œë¹„ìŠ¤ ì•„í‚¤í…ì²˜ ë˜ëŠ” ì™¸ë¶€ API ì—°ë™ ì‹œ **ë„¤íŠ¸ì›Œí¬ ì§€ì—°/ì‹¤íŒ¨**ëŠ” ë¶ˆê°€í”¼í•˜ê²Œ ë°œìƒí•œë‹¤.
 OpenFeign í´ë¼ì´ì–¸íŠ¸ì— ë‹¤ìŒê³¼ ê°™ì€ **íšŒë³µ íƒ„ë ¥ì„± ê¸°ëŠ¥**ì„ êµ¬ì„±í•˜ë©´ ìš´ì˜ í™˜ê²½ì—ì„œ ì„œë¹„ìŠ¤ì˜ ì•ˆì •ì„±ì„ ë†’ì¼ ìˆ˜ ìˆë‹¤:

- íƒ€ì„ì•„ì›ƒ(Timeouts) â†’ **ì‘ë‹µ ì§€ì—°ì— ëŒ€í•œ ë¹ ë¥¸ íšŒë³µ**
- ì¬ì‹œë„(Retry) â†’ **ì¼ì‹œì  ì¥ì• ì— ëŒ€í•œ ìë™ ì¬ì‹œë„**
- ì„œí‚· ë¸Œë ˆì´ì»¤(Circuit Breaker) â†’ **ì¥ê¸°ì  ì¥ì•  ì‹œ ë¹ ë¥¸ ì°¨ë‹¨ ë° ë³µêµ¬ ì „ëµ**

------

### 1ï¸âƒ£ íƒ€ì„ì•„ì›ƒ ì„¤ì • ğŸ•’

#### ê¸°ë³¸ ì›ë¦¬

- **ì—°ê²° íƒ€ì„ì•„ì›ƒ**: ì„œë²„ ì—°ê²° ì‹œë„ ìµœëŒ€ ëŒ€ê¸° ì‹œê°„
- **ì½ê¸° íƒ€ì„ì•„ì›ƒ**: ì‘ë‹µ ì½ê¸° ìµœëŒ€ ëŒ€ê¸° ì‹œê°„

#### ì„¤ì • ë°©ë²•

```
feign:
  client:
    config:
      default:   # ë˜ëŠ” íŠ¹ì • client ì´ë¦„ ì‚¬ìš© ê°€ëŠ¥
        connectTimeout: 5000     # ms
        readTimeout: 10000       # ms
```

#### ë™ì‘ íë¦„

```
ìš”ì²­ â†’ ì„œë²„ ì‘ë‹µ ì§€ì—° ì‹œ íƒ€ì„ì•„ì›ƒ ë°œìƒ
â†’ TimeoutException throw
â†’ ê¸€ë¡œë²Œ ì˜ˆì™¸ í•¸ë“¤ë§ ê°€ëŠ¥
```

#### ì£¼ì˜ì‚¬í•­ âš ï¸

- íƒ€ì„ì•„ì›ƒì€ **Fail Fast** ì›ì¹™ì„ ì§€í‚¤ëŠ” ë° ë§¤ìš° ì¤‘ìš”í•˜ë‹¤.
- ê³¼ë„í•˜ê²Œ ê¸´ íƒ€ì„ì•„ì›ƒ ì„¤ì •ì€ **Thread ìì› ê³ ê°ˆ ìœ„í—˜** ë°œìƒ ê°€ëŠ¥.

------

### 2ï¸âƒ£ ì¬ì‹œë„(Retry) ì„¤ì • ğŸ”„

#### ê¸°ë³¸ ì „ëµ

Feignì—ëŠ” ê¸°ë³¸ Retryerê°€ ë‚´ì¥ë˜ì–´ ìˆìœ¼ë©°, Spring Cloudì—ì„œëŠ” `feign.client.config.retryer` ì„¤ì •ìœ¼ë¡œ ì œì–´ ê°€ëŠ¥í•˜ë‹¤.

#### ê¸°ë³¸ ì„¤ì •

```
feign:
  client:
    config:
      default:
        retryer:
          period: 100          # ì²« ì¬ì‹œë„ê¹Œì§€ delay(ms)
          maxPeriod: 1000      # ìµœëŒ€ delay(ms)
          maxAttempts: 3       # ìµœëŒ€ ì‹œë„ íšŸìˆ˜
```

#### Retryer ì»¤ìŠ¤í„°ë§ˆì´ì§• (Java Config)

```
@Bean
public Retryer feignRetryer() {
    return new Retryer.Default(100, 1000, 3);
}
```

#### ë™ì‘ íë¦„

```
1ì°¨ ìš”ì²­ â†’ ì‹¤íŒ¨ ì‹œ delay â†’ ì¬ì‹œë„ â†’ ìµœëŒ€ íšŸìˆ˜ ì´ˆê³¼ ì‹œ Exception throw
```

#### ì£¼ì˜ì‚¬í•­ âš ï¸

- ë¹„ë©±ë“±ì„±(POST ë“±) ìš”ì²­ì—ëŠ” ì¬ì‹œë„ ì ìš© ì£¼ì˜ â†’ ë°ì´í„° ì¤‘ë³µ ì²˜ë¦¬ í•„ìš”.
- Idempotent ìš”ì²­(GET, PUT ë“±)ì— Retry ê¶Œì¥.

------

### 3ï¸âƒ£ ì„œí‚· ë¸Œë ˆì´ì»¤(Circuit Breaker) êµ¬ì„± âš¡

#### ê°œìš”

ì„œí‚· ë¸Œë ˆì´ì»¤ëŠ” **ë°˜ë³µë˜ëŠ” ì‹¤íŒ¨**ê°€ ë°œìƒí•  ê²½ìš° ìë™ìœ¼ë¡œ í˜¸ì¶œ ì°¨ë‹¨ í›„
 ì¼ì • ê¸°ê°„ í›„ ë‹¤ì‹œ ì¬ì‹œë„í•˜ëŠ” íšŒë³µ ì „ëµì´ë‹¤.

Spring Cloudì—ì„œëŠ” ì£¼ë¡œ **Resilience4j** ë˜ëŠ” **Hystrix(Deprecated)** ë¥¼ ì´ìš©í•œë‹¤.
 í˜„ì¬ëŠ” Resilience4jê°€ ê³µì‹ ê¶Œì¥ë¨.

#### ì˜ì¡´ì„± ì¶”ê°€

```
<dependency>
    <groupId>io.github.resilience4j</groupId>
    <artifactId>resilience4j-spring-boot3</artifactId>
</dependency>

<dependency>
    <groupId>io.github.resilience4j</groupId>
    <artifactId>resilience4j-spring-cloud2</artifactId>
</dependency>
```

#### ì„¤ì • ë°©ë²• (application.yml)

```
resilience4j:
  circuitbreaker:
    instances:
      exampleClientCircuitBreaker:
        registerHealthIndicator: true
        slidingWindowSize: 10
        failureRateThreshold: 50    # ì‹¤íŒ¨ìœ¨(%) â†’ 50% ì´ìƒ ì‹œ Open ìƒíƒœ ì „í™˜
        waitDurationInOpenState: 10000   # Open ìƒíƒœ ìœ ì§€(ms)
        permittedNumberOfCallsInHalfOpenState: 3
        slidingWindowType: COUNT_BASED
```

#### Feign Clientì™€ ì—°ê³„ ë°©ë²•

1ï¸âƒ£ Feign Client í˜¸ì¶œ Service Layerì— **@CircuitBreaker** ì ìš©

```
@Service
@RequiredArgsConstructor
public class ExampleService {

    private final ExampleClient exampleClient;

    @CircuitBreaker(name = "exampleClientCircuitBreaker", fallbackMethod = "fallbackExample")
    public String callExampleApi() {
        return exampleClient.getProtectedData();
    }

    public String fallbackExample(Throwable t) {
        return "Fallback Response";
    }
}
```

ğŸ‘‰ CircuitBreaker ì ìš© ì‹œ **Open ìƒíƒœ**ì—ì„œëŠ” fallback ë©”ì„œë“œê°€ ì¦‰ì‹œ í˜¸ì¶œë¨ â†’ ë¹ ë¥¸ ì¥ì•  ëŒ€ì‘ ğŸš€.

------

### 4ï¸âƒ£ ì „ì²´ êµ¬ì„± íë¦„ ğŸ—‚ï¸

```
Feign Client ìš”ì²­ â†’ íƒ€ì„ì•„ì›ƒ ì„¤ì • â†’ ì¼ì • ì‹œê°„ ë‚´ ì‘ë‹µ ì—†ìœ¼ë©´ Timeout ë°œìƒ
    â†“
Retryer ì ìš© ì‹œ â†’ ìë™ ì¬ì‹œë„(ì„¤ì • íšŸìˆ˜ë§Œí¼)
    â†“
CircuitBreaker ì ìš© ì‹œ â†’ ì‹¤íŒ¨ìœ¨ ëˆ„ì  ë¶„ì„ â†’ Open ìƒíƒœ ì‹œ ìš”ì²­ ì°¨ë‹¨ ë° fallback ì²˜ë¦¬
```

------

### 5ï¸âƒ£ ì •ë¦¬ ë¹„êµí‘œ ğŸ—‚ï¸

| ê¸°ëŠ¥            | ëª©ì                            | ì ìš© ìœ„ì¹˜                     | íš¨ê³¼                   |
| --------------- | ------------------------------ | ----------------------------- | ---------------------- |
| Timeout         | ëŠë¦° ì‘ë‹µì— ë¹ ë¥´ê²Œ ì‹¤íŒ¨        | Feign config                  | Thread ë‚­ë¹„ ë°©ì§€       |
| Retry           | ì¼ì‹œì  ì¥ì•  ìë™ ì¬ì‹œë„        | Retryer or Resilience4j Retry | ì¥ì•  ìë™ ë³µêµ¬ ì‹œë„    |
| Circuit Breaker | ë°˜ë³µ ì‹¤íŒ¨ ì°¨ë‹¨ + fallback ì²˜ë¦¬ | Resilience4j CircuitBreaker   | ì¥ì•  ê²©ë¦¬, ì„œë¹„ìŠ¤ ë³´í˜¸ |

------

### ê²°ë¡  ğŸ—‚ï¸

 âœ… Feign ClientëŠ” **Timeout + Retry + Circuit Breaker** ì¡°í•©ì„ í†µí•´ **ê³ ê°€ìš©ì„±** í™•ë³´ ê°€ëŠ¥.
 âœ… Resilience4jëŠ” Feign Client ë¿ ì•„ë‹ˆë¼ ëª¨ë“  ì„œë¹„ìŠ¤ í˜¸ì¶œ íŒ¨í„´ì— ìœ ì—°í•˜ê²Œ ì ìš© ê°€ëŠ¥.
 âœ… Circuit BreakerëŠ” fallback ë©”ì„œë“œ ì œê³µì„ í†µí•´ **ì„œë¹„ìŠ¤ degrade** ì‹œ ì•ˆì •ì„± ë³´ì¥.
 âœ… ì ì ˆí•œ Timeout ë° Retry êµ¬ì„±ì€ **ì‹œìŠ¤í…œ ì „ì²´ ì„±ëŠ¥ ë³´í˜¸**ì— í•µì‹¬ ì—­í• .

## Retry, Resilience4j

**Resilience4j**ëŠ” ëª¨ë˜í•œ Java ë§ˆì´í¬ë¡œì„œë¹„ìŠ¤ ì•„í‚¤í…ì²˜ì—ì„œ **íšŒë³µ íƒ„ë ¥ì„±(Resilience)** ì„ ê°•í™”í•˜ê¸° ìœ„í•œ ë¼ì´ë¸ŒëŸ¬ë¦¬ë‹¤.
 ë‹¤ìŒê³¼ ê°™ì€ ê¸°ëŠ¥ì„ ëª¨ë“ˆí™”ëœ êµ¬ì¡°ë¡œ ì œê³µí•œë‹¤:

- CircuitBreaker â†’ ì¥ì•  ë°œìƒ ì‹œ ìë™ ì°¨ë‹¨
- Retry â†’ ì¼ì‹œì  ì¥ì• ì— ëŒ€í•œ **ìë™ ì¬ì‹œë„**
- RateLimiter â†’ ìš”ì²­ ì†ë„ ì œí•œ
- Bulkhead â†’ ë³‘ë ¬ ì²˜ë¦¬ëŸ‰ ì œí•œ (ê²©ë¦¬)
- TimeLimiter â†’ ì‹œê°„ ì´ˆê³¼ ê´€ë¦¬

ì´ë²ˆ ì ˆì—ì„œëŠ” **Retry ê¸°ëŠ¥ ì¤‘ì‹¬**ìœ¼ë¡œ êµ¬ì„± ë°©ë²•ê³¼ í™œìš© ì „ëµì„ ì„¤ëª…í•œë‹¤.

------

### 1ï¸âƒ£ Retry ê°œìš”

#### Retry ì‚¬ìš© ëª©ì 

- ë„¤íŠ¸ì›Œí¬ ì§€ì—°, ì¼ì‹œì  ì„œë¹„ìŠ¤ ë¶ˆê°€ ë“± **ì¼ì‹œì  ì¥ì• ** ë°œìƒ ì‹œ ìë™ìœ¼ë¡œ ì¬ì‹œë„í•˜ì—¬ ì„±ê³µ í™•ë¥ ì„ ë†’ì¸ë‹¤.
- ì¥ì•  ëŒ€ì‘ í”„ë¡œì„¸ìŠ¤ë¥¼ ìë™í™”í•˜ì—¬ **ì„œë¹„ìŠ¤ ì•ˆì •ì„±**ì„ í–¥ìƒì‹œí‚¨ë‹¤.

#### ì ìš© ëŒ€ìƒ

- ì™¸ë¶€ API í˜¸ì¶œ (OpenFeign, RestTemplate, WebClient ë“±)
- DB ë˜ëŠ” Messaging ì‹œìŠ¤í…œ
- ìì²´ ì„œë¹„ìŠ¤ ë‚´ë¶€ ìš”ì²­

------

### 2ï¸âƒ£ ê¸°ë³¸ êµ¬ì„± íë¦„

```
Service í˜¸ì¶œ ì‹œ â†’ ì‹¤íŒ¨ ê°ì§€ â†’ Retry ê¸°ëŠ¥ìœ¼ë¡œ ìë™ ì¬ì‹œë„
    â†“
ì„±ê³µ â†’ ì •ìƒ ê²°ê³¼ ë°˜í™˜
    â†“
ìµœëŒ€ ì¬ì‹œë„ ì´ˆê³¼ ì‹œ â†’ ì˜ˆì™¸ ë°œìƒ or fallback ì²˜ë¦¬
```

------

### 3ï¸âƒ£ ì˜ì¡´ì„± ì¶”ê°€

```
<dependency>
    <groupId>io.github.resilience4j</groupId>
    <artifactId>resilience4j-spring-boot3</artifactId>
</dependency>

<dependency>
    <groupId>io.github.resilience4j</groupId>
    <artifactId>resilience4j-retry</artifactId>
</dependency>
```

------

### 4ï¸âƒ£ application.yml ì„¤ì •

```
resilience4j:
  retry:
    instances:
      exampleRetry:
        max-attempts: 3          # ìµœëŒ€ ì‹œë„ íšŸìˆ˜
        wait-duration: 2s        # ì¬ì‹œë„ ê°„ ê°„ê²©
        retry-exceptions:
          - java.io.IOException
          - feign.FeignException$ServerError
        ignore-exceptions:
          - com.example.exception.CustomBadRequestException
```

#### ì£¼ìš” ì†ì„± ì„¤ëª…

| ì†ì„±              | ì„¤ëª…                             |
| ----------------- | -------------------------------- |
| max-attempts      | ìµœëŒ€ ì¬ì‹œë„ íšŸìˆ˜ (ê¸°ë³¸ 3)        |
| wait-duration     | ì¬ì‹œë„ ê°„ ëŒ€ê¸° ì‹œê°„ (ê¸°ë³¸ 500ms) |
| retry-exceptions  | ì¬ì‹œë„ ëŒ€ìƒ ì˜ˆì™¸ ëª©ë¡            |
| ignore-exceptions | ì¬ì‹œë„ ì œì™¸ ì˜ˆì™¸ ëª©ë¡            |

------

### 5ï¸âƒ£ @Retry ì–´ë…¸í…Œì´ì…˜ ì‚¬ìš© ğŸš€

#### ê°„ë‹¨í•œ ì˜ˆì œ

```
@Service
@RequiredArgsConstructor
public class ExampleService {

    private final ExampleClient exampleClient;

    @Retry(name = "exampleRetry", fallbackMethod = "fallbackExample")
    public String callExampleApi() {
        return exampleClient.getProtectedData();
    }

    public String fallbackExample(Throwable t) {
        return "Fallback Response";
    }
}
```

#### ë™ì‘ íë¦„

```
callExampleApi() í˜¸ì¶œ
    â†“
ì‹¤íŒ¨ ë°œìƒ ì‹œ â†’ exampleRetry êµ¬ì„± ì ìš© â†’ ì¬ì‹œë„
    â†“
ìµœëŒ€ ì‹œë„ ì´ˆê³¼ ì‹œ fallbackExample() í˜¸ì¶œ
```

#### ì£¼ì˜ ì‚¬í•­

- **fallbackMethod**ì˜ ì‹œê·¸ë‹ˆì²˜ëŠ” ì› ë©”ì„œë“œì™€ ë™ì¼í•˜ê±°ë‚˜ `Throwable` ì¶”ê°€ ì¸ì í—ˆìš©.
- fallback ë©”ì„œë“œê°€ ì—†ìœ¼ë©´ **ìµœì¢… ì˜ˆì™¸ ë°œìƒ**.

------

### 6ï¸âƒ£ Retry & OpenFeign í†µí•©

Feign Client í˜¸ì¶œì—ë„ ì‰½ê²Œ ì ìš© ê°€ëŠ¥:

```
@Service
@RequiredArgsConstructor
public class ExampleService {

    private final ExampleClient exampleClient;

    @Retry(name = "exampleRetry", fallbackMethod = "fallbackExample")
    public String callExampleApi() {
        return exampleClient.getProtectedData();
    }

    public String fallbackExample(Throwable t) {
        return "Fallback Response";
    }
}
```

 ğŸ‘‰ FeignException, IOException ë“±ì„ ëŒ€ìƒìœ¼ë¡œ Retry ì ìš© ê°€ëŠ¥.
 ğŸ‘‰ **Resilience4j RetryëŠ” Feign ë‚´ë¶€ Retryerë³´ë‹¤ ë” ê°•ë ¥í•œ ê¸°ëŠ¥ ì œê³µ** (Fallback ë“± ì§€ì›).

------

### 7ï¸âƒ£ Retry + CircuitBreaker ê²°í•© âš¡

Resilience4jëŠ” **Retry + CircuitBreaker**ë¥¼ ì‰½ê²Œ ê²°í•© êµ¬ì„± ê°€ëŠ¥.

```
resilience4j:
  retry:
    instances:
      exampleRetry:
        max-attempts: 3
        wait-duration: 2s

  circuitbreaker:
    instances:
      exampleCircuitBreaker:
        slidingWindowSize: 10
        failureRateThreshold: 50
        waitDurationInOpenState: 10s
```

```
@Retry(name = "exampleRetry", fallbackMethod = "fallbackExample")
@CircuitBreaker(name = "exampleCircuitBreaker", fallbackMethod = "fallbackExample")
public String callExampleApi() {
    return exampleClient.getProtectedData();
}
```

- Retry â†’ ì¼ì‹œì  ì¥ì•  ì‹œ ë¹ ë¥¸ íšŒë³µ ì‹œë„
- CircuitBreaker â†’ ì§€ì†ì  ì¥ì•  ë°œìƒ ì‹œ ì°¨ë‹¨ í›„ fallback ì²˜ë¦¬

ğŸ‘‰ ì´ ì¡°í•©ì´ ê°€ì¥ ë§ì´ ì‚¬ìš©ë˜ëŠ” íŒ¨í„´ ğŸš€.

------

### 8ï¸âƒ£ Retry Event ê¸°ë°˜ ëª¨ë‹ˆí„°ë§

Resilience4jëŠ” Retry Event ë°œí–‰ì„ í†µí•´ **Metrics / ëª¨ë‹ˆí„°ë§**ë„ ì§€ì›.

```
@Bean
public RetryEventConsumer<RetryOnRetryEvent> retryOnRetryEventConsumer() {
    return event -> System.out.println("Retry Event ë°œìƒ: " + event.toString());
}
```

ë˜ëŠ” Micrometer Metrics ì—°ê³„ ì‹œ â†’ Prometheus + Grafana ê¸°ë°˜ ëª¨ë‹ˆí„°ë§ ê°€ëŠ¥ ğŸ“ˆ.

------

### 9ï¸âƒ£ ì£¼ìš” í™œìš© íŒ ğŸ

 âœ… Retry ëŒ€ìƒ ì˜ˆì™¸ëŠ” **ëª…í™•íˆ ì •ì˜**í•  ê²ƒ â†’ ëª¨ë“  ì˜ˆì™¸ ì¬ì‹œë„ëŠ” ê¸ˆë¬¼.
 âœ… Retry + CircuitBreaker ê²°í•© ì‹œ **íš¨ê³¼ì  ì¥ì•  ëŒ€ì‘** ê°€ëŠ¥.
 âœ… Retry ì‹œ ì¬ì‹œë„ ê°„ ê°„ê²©(Backoff)ì„ **ì ì ˆíˆ ì¡°ì •**í•˜ì—¬ ê³¼ë„í•œ ìš”ì²­ ë°©ì§€.
 âœ… fallbackMethod êµ¬í˜„ ì‹œ **ì„œë¹„ìŠ¤ degrade ì²˜ë¦¬ ì „ëµ** ì‚¬ì „ ì„¤ê³„ í•„ìš”.

------

### ê²°ë¡  ğŸ—‚ï¸

 âœ… Resilience4j RetryëŠ” **ë„¤íŠ¸ì›Œí¬/ì‹œìŠ¤í…œ ì¥ì•  ëŒ€ì‘ ìë™í™”** ê¸°ëŠ¥ ì œê³µ.
 âœ… ë‹¨ì¼ êµ¬ì„±ìœ¼ë¡œ ë‹¤ì–‘í•œ ì„œë¹„ìŠ¤ í˜¸ì¶œì— ì ìš© ê°€ëŠ¥.
 âœ… @Retry ì–´ë…¸í…Œì´ì…˜ ì‚¬ìš© â†’ ê¸°ì¡´ ì½”ë“œì— ì‰½ê²Œ ì ìš© ê°€ëŠ¥.
 âœ… Retry + CircuitBreaker ì¡°í•© â†’ MSA ì„œë¹„ìŠ¤ íšŒë³µ íƒ„ë ¥ì„± í–¥ìƒ.
 âœ… Prometheus ë“±ê³¼ ì—°ê³„ ì‹œ **ì‹¤ì‹œê°„ ëª¨ë‹ˆí„°ë§** ê°€ëŠ¥.