# 19. ìŠ¤í”„ë§ ë°°ì¹˜(Spring Batch)

## Spring Batch êµ¬ì¡°

**Spring Batch** ëŠ” **ëŒ€ìš©ëŸ‰ ë°°ì¹˜ ì²˜ë¦¬**ë¥¼ ì§€ì›í•˜ëŠ” Spring ê¸°ë°˜ì˜ í”„ë ˆì„ì›Œí¬ë‹¤.
 **ë°ì´í„° ì¼ê´„ ì²˜ë¦¬, ETL(Extract, Transform, Load), ì •ì‚°/ì§‘ê³„/ë³´ê³ ì„œ ìƒì„±** ë“±ì— ë„ë¦¬ ì‚¬ìš©ëœë‹¤.

Spring BatchëŠ” ë‹¤ìŒê³¼ ê°™ì€ í•µì‹¬ íŠ¹ì§•ì„ ê°€ì§„ë‹¤:

 âœ… ëŒ€ìš©ëŸ‰ ë°ì´í„° ì²˜ë¦¬ ê°€ëŠ¥
 âœ… íŠ¸ëœì­ì…˜ ê´€ë¦¬, ì¬ì‹œì‘(Resume), Skip/Retry ê¸°ëŠ¥ ë‚´ì¥
 âœ… Job/Step êµ¬ì„±ì„ í†µí•œ ìœ ì—°í•œ íŒŒì´í”„ë¼ì¸ êµ¬ì„±
 âœ… ëª¨ë‹ˆí„°ë§ ë° ê´€ë¦¬ ê¸°ëŠ¥ ì œê³µ

------

### 1ï¸âƒ£ ê¸°ë³¸ êµ¬ì„± íë¦„

```
JobLauncher â†’ Job â†’ Step(s) â†’ Chunk ê¸°ë°˜ ì²˜ë¦¬ or Tasklet ê¸°ë°˜ ì²˜ë¦¬
```

ğŸ‘‰ **Job** ë‹¨ìœ„ë¡œ ì „ì²´ ë°°ì¹˜ ì‹¤í–‰ â†’ ê° **Step** ì´ ê°œë³„ ì‘ì—… ë‹¨ìœ„ ë‹´ë‹¹ â†’ Step ë‚´ë¶€ì—ì„œ Chunk/Tasklet ë°©ì‹ìœ¼ë¡œ ì²˜ë¦¬ ğŸš€.

------

### 2ï¸âƒ£ ì£¼ìš” êµ¬ì„± ìš”ì†Œ

| êµ¬ì„± ìš”ì†Œ     | ì„¤ëª…                                               |
| ------------- | -------------------------------------------------- |
| Job           | ë°°ì¹˜ ì‘ì—… ì „ì²´ ë‹¨ìœ„                                |
| Step          | Job ë‚´ì˜ ì‘ì—… ë‹¨ìœ„ (1ê°œ ì´ìƒ ì¡´ì¬ ê°€ëŠ¥)            |
| JobLauncher   | Job ì‹¤í–‰ì„ íŠ¸ë¦¬ê±°í•˜ëŠ” ì»´í¬ë„ŒíŠ¸                     |
| JobRepository | Job ì‹¤í–‰/Step ì‹¤í–‰ ìƒíƒœ, ë©”íƒ€ë°ì´í„° ì €ì¥ (DB ê¸°ë°˜) |
| JobExplorer   | ì‹¤í–‰ ì¤‘ì¸ Job/Step ìƒíƒœ ì¡°íšŒ API ì œê³µ              |
| JobInstance   | ë™ì¼ JobParameter ë¡œ ì‹¤í–‰ëœ Job ì˜ ë…¼ë¦¬ì  ì¸ìŠ¤í„´ìŠ¤ |
| JobExecution  | JobInstanceì˜ 1íšŒ ì‹¤í–‰ ê¸°ë¡                        |
| StepExecution | Stepì˜ 1íšŒ ì‹¤í–‰ ê¸°ë¡                               |

------

### 3ï¸âƒ£ Step êµ¬ì„± ë°©ì‹

#### 1ï¸âƒ£ Chunk ê¸°ë°˜ ì²˜ë¦¬ (ê°€ì¥ ì¼ë°˜ì )

```
Step â†’ ItemReader â†’ ItemProcessor â†’ ItemWriter
```

**N ê°œ ë‹¨ìœ„(Chunk Size)ë¡œ ì½ê³  â†’ ì²˜ë¦¬í•˜ê³  â†’ ì“°ê¸° íŠ¸ëœì­ì…˜ ì»¤ë°‹**.

- ItemReader: ë°ì´í„° ì†ŒìŠ¤ì—ì„œ **ë°ì´í„° ì½ê¸°**
- ItemProcessor: ì½ì€ ë°ì´í„°ì— ëŒ€í•œ **ë³€í™˜/ê°€ê³µ ì²˜ë¦¬**
- ItemWriter: ì²˜ë¦¬ëœ ë°ì´í„°ë¥¼ **ì €ì¥/ì“°ê¸°**

#### 2ï¸âƒ£ Tasklet ê¸°ë°˜ ì²˜ë¦¬

- ë‹¨ì¼ Tasklet â†’ 1 Step ì—ì„œ **ë‹¨ìˆœ ë°˜ë³µ ì—†ëŠ” ì‘ì—… ìˆ˜í–‰**.

ì˜ˆ:

```
íŒŒì¼ ì••ì¶• / ì •ë¦¬ / ìƒíƒœ ì—…ë°ì´íŠ¸ ë“±
```

```
@Bean
public Step exampleStep() {
    return stepBuilderFactory.get("exampleStep")
        .tasklet((contribution, chunkContext) -> {
            // Tasklet logic here
            return RepeatStatus.FINISHED;
        })
        .build();
}
```

------

### 4ï¸âƒ£ ì‹¤í–‰ íë¦„

```
Application â†’ JobLauncher.run(Job, JobParameters)
    â†“
JobInstance ìƒì„± or ì¡°íšŒ
    â†“
JobExecution ìƒì„± (1íšŒ ì‹¤í–‰ ë‹¨ìœ„)
    â†“
ê° Step ìˆœì°¨ ì‹¤í–‰ (StepExecution ìƒì„±)
    â†“
Chunk ê¸°ë°˜ or Tasklet ê¸°ë°˜ ì²˜ë¦¬ ì‹¤í–‰
    â†“
ëª¨ë“  Step ì •ìƒ ì¢…ë£Œ ì‹œ â†’ JobExecution ì™„ë£Œ
    â†“
JobRepository ì— ì‹¤í–‰ ê²°ê³¼ ê¸°ë¡
```

------

### 5ï¸âƒ£ ì£¼ìš” Bean êµ¬ì„± ì˜ˆì‹œ

```
@Configuration
@EnableBatchProcessing
public class BatchConfig {

    @Autowired
    private JobBuilderFactory jobBuilderFactory;

    @Autowired
    private StepBuilderFactory stepBuilderFactory;

    @Bean
    public Job exampleJob() {
        return jobBuilderFactory.get("exampleJob")
            .start(exampleStep())
            .build();
    }

    @Bean
    public Step exampleStep() {
        return stepBuilderFactory.get("exampleStep")
            .<String, String>chunk(10)
            .reader(itemReader())
            .processor(itemProcessor())
            .writer(itemWriter())
            .build();
    }

    @Bean
    public ItemReader<String> itemReader() {
        return new ListItemReader<>(Arrays.asList("a", "b", "c"));
    }

    @Bean
    public ItemProcessor<String, String> itemProcessor() {
        return item -> item.toUpperCase();
    }

    @Bean
    public ItemWriter<String> itemWriter() {
        return items -> items.forEach(System.out::println);
    }
}
```

ğŸ‘‰ **Chunk(10)** ìœ¼ë¡œ 10ê°œ ë‹¨ìœ„ë¡œ íŠ¸ëœì­ì…˜ Commit ğŸš€.

------

### 6ï¸âƒ£ ë©”íƒ€ë°ì´í„° ê´€ë¦¬

Spring BatchëŠ” ê¸°ë³¸ì ìœ¼ë¡œ **JobRepository** ë¥¼ í†µí•´ ë©”íƒ€ë°ì´í„° ê´€ë¦¬:

- BATCH_JOB_INSTANCE
- BATCH_JOB_EXECUTION
- BATCH_JOB_EXECUTION_PARAMS
- BATCH_STEP_EXECUTION
- BATCH_STEP_EXECUTION_CONTEXT

ğŸ‘‰ ë°°ì¹˜ ì‘ì—… ì¬ì‹œì‘ ì‹œ **ë©”íƒ€ë°ì´í„° ê¸°ë°˜ìœ¼ë¡œ ì–´ë””ê¹Œì§€ ì²˜ë¦¬í–ˆëŠ”ì§€** ìë™ ê´€ë¦¬ ê°€ëŠ¥.

------

### 7ï¸âƒ£ êµ¬ì„± ìš”ì†Œ ì‹œê°í™”

```
+----------------+
|  JobLauncher   |
+----------------+
        |
        v
+----------------+        +--------------------+
|     Job        |----->  |   JobRepository     |
+----------------+        +--------------------+
        |
        v
+----------------+
|      Step      |
+----------------+
        |
        v
+--------+  +---------------+  +----------+
| Reader |â†’ | Processor(opt)|â†’|  Writer   |
+--------+  +---------------+  +----------+
```

------

### 8ï¸âƒ£ Best Practice

| ì˜ì—­          | ì „ëµ                                                    |
| ------------- | ------------------------------------------------------- |
| Job ì„¤ê³„      | 1 Job = 1 Business Unit ê¸°ì¤€ìœ¼ë¡œ êµ¬ì„± ê¶Œì¥              |
| Step ì„¤ê³„     | Chunk ê¸°ë°˜ â†’ ë°ì´í„° ì²˜ë¦¬ íŠ¸ëœì­ì…˜ ë‹¨ìœ„ ìµœì í™”           |
| ì¬ì‹œì‘ ì„¤ê³„   | Restart ê°€ëŠ¥í•˜ë„ë¡ Idempotent ì„¤ê³„ í•„ìˆ˜                 |
| Logging       | StepExecutionContext í™œìš© â†’ ì²˜ë¦¬ ì¤‘ ìƒíƒœ ì •ë³´ ì €ì¥ ê°€ëŠ¥ |
| Job Parameter | í•„ìˆ˜ ì…ë ¥ê°’ (ë‚ ì§œ ë“±)ì€ JobParameter ë¡œ ëª…ì‹œ ê´€ë¦¬ ê¶Œì¥  |
| Schedule ì—°ê³„ | Quartz, @Scheduled, ì™¸ë¶€ CI/CD Jobê³¼ ì—°ê³„ ê°€ëŠ¥          |

------

### 9ï¸âƒ£ ê²°ë¡ 

 âœ… Spring Batch ëŠ” ëŒ€ê·œëª¨ ë°ì´í„° ë°°ì¹˜ ì²˜ë¦¬ì— ìµœì í™”ëœ í”„ë ˆì„ì›Œí¬ë‹¤.
 âœ… Job â†’ Step â†’ Chunk/Tasklet â†’ **í‘œì¤€í™”ëœ êµ¬ì¡°**ë¡œ ì„¤ê³„ ê°€ëŠ¥.
 âœ… íŠ¸ëœì­ì…˜ ê´€ë¦¬, Skip/Retry, ì¬ì‹œì‘(Resume) ê¸°ëŠ¥ì„ ê¸°ë³¸ ì§€ì›.
 âœ… ë‹¤ì–‘í•œ DataSource (DB, File, API ë“±) ì—°ê³„ ê°€ëŠ¥.
 âœ… **ì •ì‚° ì²˜ë¦¬ / ETL / ë³´ê³ ì„œ ìƒì„± / í†µê³„ ì²˜ë¦¬** ë“±ì—ì„œ ê´‘ë²”ìœ„í•˜ê²Œ ì‚¬ìš©.

## Job, Step, Reader, Processor, Writer

Spring Batchì—ì„œ ë°°ì¹˜ ì²˜ë¦¬ì˜ í•µì‹¬ì€:

 âœ… ì „ì²´ ì‘ì—… ë‹¨ìœ„: **Job**
 âœ… ì‘ì—… ë‹¨ìœ„ ë‚´ ë‹¨ê³„: **Step**
 âœ… ë°ì´í„° íë¦„ êµ¬ì„± ìš”ì†Œ: **ItemReader â†’ ItemProcessor â†’ ItemWriter**

ì´ êµ¬ì¡°ëŠ” **ëŒ€ìš©ëŸ‰ ë°ì´í„° ì²˜ë¦¬, ETL, ì •ì‚° ì‘ì—…, ë³´ê³ ì„œ ìƒì„±** ë“±ì— ìµœì í™”ëœ íŒ¨í„´ì´ë‹¤.

------

### 1ï¸âƒ£ Job

#### ì •ì˜

- **ë°°ì¹˜ ì²˜ë¦¬ì˜ ì „ì²´ ë‹¨ìœ„**
- ì—¬ëŸ¬ ê°œì˜ **Step** ìœ¼ë¡œ êµ¬ì„±ë¨
- ì‹¤í–‰ ìƒíƒœ, íŒŒë¼ë¯¸í„°, ì¬ì‹œì‘ ê°€ëŠ¥ ì—¬ë¶€ ë“±ì„ ê´€ë¦¬

#### ì£¼ìš” íŠ¹ì§•

- `JobInstance`: ë™ì¼í•œ `JobName` + `JobParameters` ë¡œ ì‹¤í–‰ëœ ë…¼ë¦¬ì  ì¸ìŠ¤í„´ìŠ¤
- `JobExecution`: JobInstance ì˜ ì‹¤ì œ ì‹¤í–‰(1íšŒ ì‹¤í–‰ ê¸°ë¡)

#### êµ¬ì„± ì˜ˆì‹œ

```
@Bean
public Job exampleJob() {
    return jobBuilderFactory.get("exampleJob")
        .start(step1())
        .next(step2())
        .build();
}
```

 ğŸ‘‰ `start()` â†’ ì²« Step
 ğŸ‘‰ `next()` â†’ ë‹¤ìŒ Step ìˆœì°¨ ì—°ê²° ê°€ëŠ¥

#### ì‹¤í–‰ íë¦„

```
JobLauncher.run(Job, JobParameters)
    â†“
JobInstance ìƒì„±
    â†“
JobExecution ìƒì„±
    â†“
Step 1 ì‹¤í–‰ â†’ ì™„ë£Œ í›„ Step 2 ì‹¤í–‰ â†’ ...
    â†“
ì „ì²´ JobExecution ìƒíƒœ ê¸°ë¡
```

------

### 2ï¸âƒ£ Step

#### ì •ì˜

- **Job ë‚´ë¶€ì˜ ë‹¨ì¼ ì‹¤í–‰ ë‹¨ìœ„**
- í•˜ë‚˜ì˜ Step ì€ 1ê°œì˜ ì‘ì—… ë…¼ë¦¬ì  íë¦„ ë‹´ë‹¹
- ë‹¤ìŒ ë‘ ê°€ì§€ ë°©ì‹ìœ¼ë¡œ êµ¬í˜„ ê°€ëŠ¥:

| ë°©ì‹         | ì„¤ëª…                                                        |
| ------------ | ----------------------------------------------------------- |
| Tasklet ê¸°ë°˜ | ë‹¨ìˆœ ë°˜ë³µ ì—†ëŠ” ë‹¨ì¼ ì‘ì—… (íŒŒì¼ ì••ì¶•, í†µê³„ ì—…ë°ì´íŠ¸ ë“±)      |
| Chunk ê¸°ë°˜   | ëŒ€ëŸ‰ ë°ì´í„° ì²˜ë¦¬ ì‹œ ì‚¬ìš© (Reader â†’ Processor â†’ Writer íë¦„) |

#### Chunk ê¸°ë°˜ Step ì˜ˆì‹œ

```
@Bean
public Step exampleStep() {
    return stepBuilderFactory.get("exampleStep")
        .<String, String>chunk(100)   // Chunk Size = 100
        .reader(itemReader())
        .processor(itemProcessor())
        .writer(itemWriter())
        .build();
}
```

ğŸ‘‰ Chunk ê¸°ë°˜ ì²˜ë¦¬ â†’ **100ê±´ ë‹¨ìœ„ë¡œ íŠ¸ëœì­ì…˜ Commit**.

------

### 3ï¸âƒ£ ItemReader

#### ì •ì˜

- **ë°ì´í„°ë¥¼ ì½ì–´ì˜¤ëŠ” ì»´í¬ë„ŒíŠ¸**
- Spring Batch ê°€ ì²˜ë¦¬í•  **Input ë°ì´í„°ë¥¼ ìˆœì°¨ì ìœ¼ë¡œ ì œê³µ**í•¨

#### ì¢…ë¥˜

| êµ¬í˜„ì²´               | ì‚¬ìš© ëŒ€ìƒ                      |
| -------------------- | ------------------------------ |
| JdbcCursorItemReader | DB Cursor ê¸°ë°˜ Read            |
| JdbcPagingItemReader | DB Paging ê¸°ë°˜ Read            |
| FlatFileItemReader   | CSV, TXT ë“± íŒŒì¼ Read          |
| StaxEventItemReader  | XML Read                       |
| JpaPagingItemReader  | JPA ê¸°ë°˜ Read                  |
| Custom êµ¬í˜„          | API, Kafka ë“± ì™¸ë¶€ ì‹œìŠ¤í…œ Read |

#### ì˜ˆì‹œ

```
@Bean
public ItemReader<String> itemReader() {
    return new ListItemReader<>(Arrays.asList("A", "B", "C", "D"));
}
```

ğŸ‘‰ Reader ëŠ” **null ë¦¬í„´ ì‹œ Step ì¢…ë£Œ**.

------

### 4ï¸âƒ£ ItemProcessor

#### ì •ì˜

- **ì½ì–´ì˜¨ ë°ì´í„°ë¥¼ ë³€í™˜/ê°€ê³µ/í•„í„°ë§** í•˜ëŠ” ì»´í¬ë„ŒíŠ¸
- ì…ë ¥ê°’ â†’ ì¶œë ¥ê°’(í˜¹ì€ null ë°˜í™˜ìœ¼ë¡œ Skip) ë³€í™˜ ìˆ˜í–‰
- Chunk ë‚´ì—ì„œ **ê° Item ë‹¨ìœ„ë¡œ í˜¸ì¶œë¨**.

#### ì˜ˆì‹œ

```
@Bean
public ItemProcessor<String, String> itemProcessor() {
    return item -> item.toLowerCase();
}
```

#### í™œìš© ì˜ˆì‹œ

- ë°ì´í„° í¬ë§· ë³€í™˜
- íŠ¹ì • ì¡°ê±´ì— ë”°ë¥¸ í•„í„°ë§ (â†’ null ë°˜í™˜ ì‹œ í•´ë‹¹ Item ì€ Writer ì— ì „ë‹¬ë˜ì§€ ì•ŠìŒ)
- ì™¸ë¶€ API ì—°ë™ â†’ ë³´ê°• ì •ë³´ ì¶”ê°€
- Data Enrichment

ğŸ‘‰ Processor ëŠ” **ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ ì ìš© í•µì‹¬ í¬ì¸íŠ¸**.

------

### 5ï¸âƒ£ ItemWriter

#### ì •ì˜

- Processor ë¥¼ ê±°ì¹œ ë°ì´í„°ë¥¼ ìµœì¢… ì €ì¥/ì“°ê¸° ì²˜ë¦¬
- **Chunk ë‹¨ìœ„ë¡œ í˜¸ì¶œ**ë¨ â†’ ì˜ˆ: Chunk Size = 100 â†’ 100ê°œ Item ë¬¶ìŒìœ¼ë¡œ Writer í˜¸ì¶œ
- ë°ì´í„° ì €ì¥ ëŒ€ìƒ:

| ëŒ€ìƒ          | êµ¬í˜„ì²´ ì˜ˆì‹œ                        |
| ------------- | ---------------------------------- |
| DB            | JdbcBatchItemWriter, JpaItemWriter |
| File          | FlatFileItemWriter                 |
| Message Queue | Custom êµ¬í˜„ í•„ìš”                   |
| API í˜¸ì¶œ      | Custom êµ¬í˜„ í•„ìš”                   |

#### ì˜ˆì‹œ

```
@Bean
public ItemWriter<String> itemWriter() {
    return items -> items.forEach(System.out::println);
}
```

ğŸ‘‰ ì‹¤ì œ ì„œë¹„ìŠ¤ì—ì„œëŠ” DB Insert/Update, íŒŒì¼ ê¸°ë¡, API ì „ì†¡ ë“±ì— ì‚¬ìš©.

------

### 6ï¸âƒ£ Chunk ê¸°ë°˜ ì²˜ë¦¬ íë¦„

```
Step ì‹œì‘
    â†“
Reader â†’ Item 1 â†’ Processor â†’ Result 1 â†’ (ë°°ì¹˜ ëª©ë¡ì— ë‹´ìŒ)
Reader â†’ Item 2 â†’ Processor â†’ Result 2 â†’ (ë°°ì¹˜ ëª©ë¡ì— ë‹´ìŒ)
...
Item N â†’ Processor â†’ Result N â†’ (ë°°ì¹˜ ëª©ë¡ì— ë‹´ìŒ)
    â†“
ChunkSize ë„ë‹¬ â†’ Writer í˜¸ì¶œ â†’ Result 1~N ë¬¶ìŒ ì €ì¥
    â†“
Chunk ë°˜ë³µ
    â†“
Reader â†’ null ë°˜í™˜ ì‹œ Step ì¢…ë£Œ
```

ğŸ‘‰ Chunk ì²˜ë¦¬ ë•ë¶„ì— **ëŒ€ëŸ‰ ë°ì´í„° ì²˜ë¦¬ ì‹œ íŠ¸ëœì­ì…˜ ê´€ë¦¬ ìµœì í™”** ê°€ëŠ¥ ğŸš€.

------

### 7ï¸âƒ£ êµ¬ì„± íë¦„ ì •ë¦¬

```
JobLauncher
    â†“
Job
    â†“
Step (Chunk ê¸°ë°˜)
    â†“
[ ItemReader â†’ ItemProcessor â†’ ItemWriter ]
```

ê° êµ¬ì„± ìš”ì†ŒëŠ” **Bean ìœ¼ë¡œ ì„ ì–¸í•˜ê³  ì¬ì‚¬ìš© ê°€ëŠ¥** â†’ ìœ ì—°í•œ Pipeline êµ¬ì„± ê°€ëŠ¥.

------

### 8ï¸âƒ£ Best Practice

| êµ¬ì„± ìš”ì†Œ     | ì „ëµ                                                         |
| ------------- | ------------------------------------------------------------ |
| ItemReader    | null ë°˜í™˜ ì‹œ Step ì •ìƒ ì¢…ë£Œ â†’ Reader êµ¬í˜„ ì‹œ ì£¼ì˜            |
| ItemProcessor | í•„í„°ë§, ë³€í™˜ ë¡œì§ êµ¬í˜„ â†’ ìµœëŒ€í•œ ê²½ëŸ‰í™” í•„ìš”                  |
| ItemWriter    | Writer ë‚´ë¶€ì—ì„œ ë°˜ë“œì‹œ **Batch ì²˜ë¦¬** ê¶Œì¥ (ë‹¨ê±´ WriteëŠ” ë¹„íš¨ìœ¨ ë°œìƒ) |
| Chunk Size    | ì²˜ë¦¬ ëŒ€ìƒ ë°ì´í„° íŠ¹ì„±ì— ë§ê²Œ íŠœë‹ í•„ìš” (ì‘ìœ¼ë©´ Commit ë¹ˆë²ˆ, í¬ë©´ Memory ì‚¬ìš©ëŸ‰ ì¦ê°€) |
| íŠ¸ëœì­ì…˜ ê´€ë¦¬ | Chunk ê¸°ë°˜ìœ¼ë¡œ Rollback ê°€ëŠ¥ â†’ Skip/Retry ì „ëµ ì ìš© ê°€ëŠ¥     |

------

### 9ï¸âƒ£ ê²°ë¡ 

 âœ… **Job** â†’ ì „ì²´ ë°°ì¹˜ ë‹¨ìœ„, **Step** â†’ ê°œë³„ ì‘ì—… ë‹¨ìœ„
 âœ… Chunk ê¸°ë°˜ Step â†’ ëŒ€ëŸ‰ ë°ì´í„° ì²˜ë¦¬ì— ìµœì í™”
 âœ… ItemReader â†’ ë°ì´í„° ì›ì²œì—ì„œ ë°ì´í„° ì½ê¸°
 âœ… ItemProcessor â†’ ë°ì´í„° ê°€ê³µ/ë³€í™˜/í•„í„°ë§
 âœ… ItemWriter â†’ ìµœì¢… ë°ì´í„° ì €ì¥/ì“°ê¸° ì²˜ë¦¬
 âœ… êµ¬ì„± ë‹¨ìˆœí•˜ê³  ìœ ì—° â†’ ë‹¤ì–‘í•œ Batch ì²˜ë¦¬ Pipeline ì„¤ê³„ ê°€ëŠ¥.

## Chunk ì²˜ë¦¬ / Tasklet ì²˜ë¦¬

**Spring Batch Step** ì—ëŠ” ë‘ ê°€ì§€ ì£¼ìš” ì²˜ë¦¬ ëª¨ë¸ì´ ìˆë‹¤:

 âœ… **Chunk-Oriented Processing (Chunk ì²˜ë¦¬)**
 âœ… **Tasklet-Oriented Processing (Tasklet ì²˜ë¦¬)**

ê° ëª¨ë¸ì€ ë°°ì¹˜ ì²˜ë¦¬ì˜ **ì„±ê²©, ë°ì´í„° íŠ¹ì„±, íŠ¸ëœì­ì…˜ ê´€ë¦¬ ë°©ì‹**ì— ë”°ë¼ ì í•©í•œ ê²½ìš°ê°€ ë‹¤ë¥´ë‹¤.
 â†’ ì–´ë–¤ ê²½ìš°ì— ì–´ë–¤ ë°©ì‹ì„ ì„ íƒí•´ì•¼ í•˜ëŠ”ì§€ ëª…í™•í•˜ê²Œ ì´í•´í•˜ê³  ì„¤ê³„í•´ì•¼ í•œë‹¤.

------

### 1ï¸âƒ£ Chunk ì²˜ë¦¬ë€?

#### ê¸°ë³¸ ê°œë…

- **ëŒ€ëŸ‰ ë°ì´í„° ì²˜ë¦¬** ì‹œ ì‚¬ìš©í•˜ëŠ” ë°©ì‹
- Reader â†’ Processor â†’ Writer â†’ **Chunk Size ë‹¨ìœ„ë¡œ íŠ¸ëœì­ì…˜ ì»¤ë°‹**
- í•˜ë‚˜ì˜ Chunk ë‚´ì—ì„œ:
  - Reader ê°€ Item ì—¬ëŸ¬ ê°œ ì½ìŒ â†’ Processor ë¡œ ì²˜ë¦¬ â†’ Writer ì— ì¼ê´„ ì €ì¥
- íŠ¸ëœì­ì…˜ì€ **Chunk ë‹¨ìœ„**ë¡œ ë¬¶ì–´ì„œ ê´€ë¦¬ë¨.

#### êµ¬ì¡° íë¦„

```
Step
    â†’ Chunk (ex. size=100)
        â†’ ItemReader â†’ ItemProcessor â†’ ItemWriter
    â†’ Commit
    â†’ Next Chunk ë°˜ë³µ
```

#### ì½”ë“œ ì˜ˆì‹œ

```
@Bean
public Step chunkStep() {
    return stepBuilderFactory.get("chunkStep")
        .<String, String>chunk(100)
        .reader(itemReader())
        .processor(itemProcessor())
        .writer(itemWriter())
        .build();
}
```

ğŸ‘‰ **100ê°œ ë‹¨ìœ„ë¡œ íŠ¸ëœì­ì…˜ Commit**.

#### íŠ¹ì§•

 âœ… íŠ¸ëœì­ì…˜ ê²½ê³„ ëª…í™• (Chunk ë‹¨ìœ„)
 âœ… Skip/Retry ì§€ì›
 âœ… ì¬ì‹œì‘(Resume) ì§€ì› â†’ ì‹¤íŒ¨í•œ Chunk ì´í›„ë¶€í„° ì¬ì‹¤í–‰ ê°€ëŠ¥
 âœ… ëŒ€ìš©ëŸ‰ ë°ì´í„° ì²˜ë¦¬ì— ìµœì í™”
 âœ… Item ê¸°ë°˜ Batch ì²˜ë¦¬ í‘œì¤€ íŒ¨í„´

------

### 2ï¸âƒ£ Tasklet ì²˜ë¦¬ë€?

#### ê¸°ë³¸ ê°œë…

- **ë‹¨ì¼ íƒœìŠ¤í¬(ì‘ì—…)** ë¥¼ ì²˜ë¦¬í•˜ê¸° ìœ„í•œ ë°©ì‹
- Reader/Processor/Writer êµ¬ì„± ì—†ì´ â†’ **Tasklet í•˜ë‚˜ë¡œ ì „ì²´ ë¡œì§ ìˆ˜í–‰**
- ì£¼ë¡œ ë‹¤ìŒê³¼ ê°™ì€ ì‘ì—…ì— ì‚¬ìš©:

```
íŒŒì¼ ì´ë™/ì••ì¶•/ì‚­ì œ  
DB í†µê³„ ê°’ ì—…ë°ì´íŠ¸  
ë‹¨ì¼ API í˜¸ì¶œ ì²˜ë¦¬  
ë””ë ‰í† ë¦¬ ì •ë¦¬  
Trigger ìš©ë„ Step
```

#### êµ¬ì¡° íë¦„

```
Step
    â†’ Tasklet ì‹¤í–‰ â†’ RepeatStatus (FINISHED or CONTINUABLE)
```

#### ì½”ë“œ ì˜ˆì‹œ

```
@Bean
public Step taskletStep() {
    return stepBuilderFactory.get("taskletStep")
        .tasklet((contribution, chunkContext) -> {
            System.out.println("Tasklet ì‘ì—… ìˆ˜í–‰ ì¤‘...");
            return RepeatStatus.FINISHED;
        })
        .build();
}
```

ğŸ‘‰ ê°„ë‹¨í•œ ë¡œì§ì€ ëŒë‹¤ Tasklet ìœ¼ë¡œ ë°”ë¡œ êµ¬í˜„ ê°€ëŠ¥ ğŸš€.

#### íŠ¹ì§•

 âœ… ë‹¨ìˆœ/ë‹¨ì¼ ì‘ì—…ì— ì í•©
 âœ… íŠ¸ëœì­ì…˜ ê²½ê³„ â†’ **Tasklet ì „ì²´ ë‹¨ìœ„ë¡œ ì»¤ë°‹ë¨**
 âœ… Chunk ì²˜ë¦¬ê°€ í•„ìš” ì—†ëŠ” ê²½ìš° ë¹ ë¥´ê²Œ êµ¬í˜„ ê°€ëŠ¥
 âœ… Reader/Processor/Writer í•„ìš” ì—†ìŒ
 âœ… í”„ë¡œê·¸ë˜ë°ì  ìœ ì—°ì„± â†‘

------

### 3ï¸âƒ£ Chunk vs Tasklet ë¹„êµí‘œ

| í•­ëª©          | Chunk ì²˜ë¦¬                                 | Tasklet ì²˜ë¦¬                                 |
| ------------- | ------------------------------------------ | -------------------------------------------- |
| ì£¼ìš” ëª©ì      | ëŒ€ëŸ‰ ë°ì´í„° ì²˜ë¦¬                           | ë‹¨ì¼ ì‘ì—… ì²˜ë¦¬                               |
| íŠ¸ëœì­ì…˜ ë‹¨ìœ„ | Chunk Size ë‹¨ìœ„ Commit                     | Tasklet ì „ì²´ ë‹¨ìœ„ Commit                     |
| êµ¬ì„± ìš”ì†Œ     | ItemReader, ItemProcessor, ItemWriter í•„ìš” | Tasklet (ë‹¨ì¼ ë©”ì„œë“œ) í•„ìš”                   |
| ì²˜ë¦¬ íŒ¨í„´     | ë°˜ë³µì  ì²˜ë¦¬ì— ìµœì í™”                       | ì¼íšŒì„± ì‘ì—…ì— ìµœì í™”                         |
| Skip/Retry    | ì§€ì›                                       | ì§€ì› ì•ˆí•¨ (Tasklet ë‚´ë¶€ì—ì„œ ìˆ˜ë™ êµ¬í˜„ ê°€ëŠ¥)  |
| Restart ì§€ì›  | ì§€ì›                                       | ì§€ì› (ë‹¨, ìƒíƒœ ê´€ë¦¬ ì§ì ‘ êµ¬í˜„ í•„ìš”)          |
| ëŒ€í‘œ ì‚¬ë¡€     | ETL ì²˜ë¦¬, DB â†’ DB ì „ì†¡, íŒŒì¼ â†’ DB ì „ì†¡     | íŒŒì¼ ì••ì¶•, FTP ì „ì†¡, ë””ë ‰í† ë¦¬ ì •ë¦¬, API í˜¸ì¶œ |

------

### 4ï¸âƒ£ ì„¤ê³„ ê¸°ì¤€

| ìƒí™©                                      | ì¶”ì²œ ì²˜ë¦¬ ë°©ì‹  |
| ----------------------------------------- | --------------- |
| ëŒ€ëŸ‰ ë°ì´í„° ì²˜ë¦¬ (10ë§Œ ê±´ ì´ìƒ)           | Chunk ì²˜ë¦¬      |
| íŠ¸ëœì­ì…˜ì„ Chunk Size ë¡œ ì œì–´í•˜ê³  ì‹¶ì„ ë•Œ | Chunk ì²˜ë¦¬      |
| ë‹¨ìˆœ íŒŒì¼ ì´ë™/ì••ì¶•/ì •ë¦¬ ì‘ì—…             | Tasklet ì²˜ë¦¬    |
| ì™¸ë¶€ API ë‹¨ì¼ í˜¸ì¶œ í›„ ìƒíƒœ ì—…ë°ì´íŠ¸       | Tasklet ì²˜ë¦¬    |
| ì£¼ê¸°ì  DB í†µê³„ê°’ ê³„ì‚° â†’ ì €ì¥              | Tasklet ì²˜ë¦¬    |
| ì •ì‚°/ì§‘ê³„ ì²˜ë¦¬ (Row ê¸°ë°˜ìœ¼ë¡œ ì²˜ë¦¬ í•„ìš”)   | Chunk ì²˜ë¦¬      |
| ì‹¤íŒ¨ í›„ Resume(ì¬ì‹œì‘) í•„ìš”               | Chunk ì²˜ë¦¬ ê¶Œì¥ |

------

### 5ï¸âƒ£ Chunk ì²˜ë¦¬ ì£¼ì˜ì‚¬í•­

- Chunk Size ëŠ” **ì„±ëŠ¥ì— ì§ì ‘ì ì¸ ì˜í–¥** â†’ ì ì ˆíˆ íŠœë‹ í•„ìš”
  - ë„ˆë¬´ ì‘ìœ¼ë©´ â†’ íŠ¸ëœì­ì…˜ ë¹ˆë²ˆ â†’ ì„±ëŠ¥ ì €í•˜
  - ë„ˆë¬´ í¬ë©´ â†’ ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ ì¦ê°€
- Skip/Retry ì„¤ì • ì‹œ **ItemWriter ì¬ì²˜ë¦¬ ìœ ì˜**
  - Writer êµ¬í˜„ ì‹œ **Idempotent(ë©±ë“±ì„±)** ë³´ì¥ ì¤‘ìš”
- Reader â†’ null ë¦¬í„´ ì‹œ Step ì •ìƒ ì¢…ë£Œ

------

### 6ï¸âƒ£ Tasklet ì²˜ë¦¬ ì£¼ì˜ì‚¬í•­

- **íŠ¸ëœì­ì…˜ ì œì–´ í•„ìš” ì‹œ ëª…í™•íˆ ì„¤ì •**
  - ì „ì²´ Tasklet ì‘ì—…ì´ íŠ¸ëœì­ì…˜ìœ¼ë¡œ ë¬¶ì„
  - ë‚´ë¶€ ì‘ì—… ì‹œ ë°˜ë“œì‹œ ì¤‘ê°„ ìƒíƒœ ê´€ë¦¬ ê³ ë ¤ í•„ìš”
- StepExecutionContext í™œìš© ì‹œ ìƒíƒœ ì €ì¥ ê°€ëŠ¥
  - Tasklet ì‘ì—… ì¤‘ Resume êµ¬í˜„ ê°€ëŠ¥ (ex. í° íŒŒì¼ ì²˜ë¦¬ Tasklet)
- ë„ˆë¬´ ë³µì¡í•œ Tasklet êµ¬í˜„ì€ ì§€ì–‘
  - ë³µì¡í•œ ë°˜ë³µ ì‘ì—…ì€ Chunk ì²˜ë¦¬ë¡œ ì „í™˜ ê¶Œì¥

------

### 7ï¸âƒ£ ê²°ë¡ 

 âœ… **Chunk ì²˜ë¦¬** ëŠ” ëŒ€ëŸ‰ ë°ì´í„° ì²˜ë¦¬, ETL ë“±ì— í•„ìˆ˜ì ì¸ í‘œì¤€ íŒ¨í„´ì´ë‹¤.
 âœ… **Tasklet ì²˜ë¦¬** ëŠ” ë‹¨ì¼ ì‘ì—…(íŒŒì¼ ì²˜ë¦¬, API í˜¸ì¶œ ë“±)ì— ì í•©í•˜ë‹¤.
 âœ… ë‘˜ì€ ìƒí˜¸ë³´ì™„ì ìœ¼ë¡œ êµ¬ì„± ê°€ëŠ¥ â†’ í•˜ë‚˜ì˜ Job ì— Chunk Step + Tasklet Step ë³‘í–‰ êµ¬ì„± å¤š.
 âœ… ì„¤ê³„ ë‹¨ê³„ì—ì„œ **ë°ì´í„° ì²˜ë¦¬ íŒ¨í„´ê³¼ íŠ¸ëœì­ì…˜ ê²½ê³„**ì— ë§ì¶° ì ì ˆí•œ ë°©ì‹ì„ ì„ íƒí•´ì•¼ í•œë‹¤.

## DB ì—°ë™ ë°°ì¹˜ / íŒŒì¼ ê¸°ë°˜ ë°°ì¹˜

### 1ï¸âƒ£ ìŠ¤í”„ë§ ë°°ì¹˜ ê¸°ë³¸ êµ¬ì¡° ë³µìŠµ

- **Job** â†’ ë°°ì¹˜ ì‘ì—…ì˜ ë‹¨ìœ„
- **Step** â†’ Job ì•ˆì˜ ë‹¨ê³„ì  ì²˜ë¦¬ ë‹¨ìœ„
- **ItemReader** â†’ ë°ì´í„° ì½ê¸° ë‹´ë‹¹
- **ItemProcessor** â†’ ë°ì´í„° ì²˜ë¦¬ ë‹´ë‹¹
- **ItemWriter** â†’ ë°ì´í„° ì“°ê¸° ë‹´ë‹¹
- **JobRepository, JobLauncher** â†’ ë°°ì¹˜ ì‹¤í–‰ê³¼ ìƒíƒœ ê´€ë¦¬
- **ExecutionContext** â†’ Step ê°„ ìƒíƒœ ì €ì¥

------

### 2ï¸âƒ£ DB ì—°ë™ ë°°ì¹˜

#### âœ¨ ëª©ì 

- RDBì—ì„œ ë°ì´í„°ë¥¼ **ëŒ€ëŸ‰ìœ¼ë¡œ ì½ì–´ì™€ì„œ ê°€ê³µ í›„ ì €ì¥** ë˜ëŠ” **ë‹¤ë¥¸ DBë¡œ ì´ë™**
- ì‹¤ì‹œê°„ ì²˜ë¦¬ê°€ ì•„ë‹Œ **ì¼ê´„ ì²˜ë¦¬(ë°°ì¹˜)** í˜•íƒœ

#### âœ¨ êµ¬ì„±

#### 1. ItemReader

| êµ¬í˜„ì²´                      | ì„¤ëª…                         |
| --------------------------- | ---------------------------- |
| `JdbcCursorItemReader`      | ì»¤ì„œ ê¸°ë°˜ Streaming (ëŒ€ìš©ëŸ‰) |
| `JpaPagingItemReader`       | JPA ê¸°ë°˜ í˜ì´ì§• ì²˜ë¦¬         |
| `JdbcPagingItemReader`      | ìˆœìˆ˜ JDBC ê¸°ë°˜ í˜ì´ì§•        |
| `HibernateCursorItemReader` | Hibernate ê¸°ë°˜ ì»¤ì„œ ì²˜ë¦¬     |

#### 2. ItemWriter

| êµ¬í˜„ì²´                      | ì„¤ëª…                          |
| --------------------------- | ----------------------------- |
| `JdbcBatchItemWriter`       | JDBC batch insert/update ì§€ì› |
| `JpaItemWriter`             | JPA ê¸°ë°˜ persist/merge        |
| `HibernateItemWriter`       | Hibernate ê¸°ë°˜ persist/merge  |
| `StoredProcedureItemWriter` | í”„ë¡œì‹œì € í˜¸ì¶œë¡œ ë°ì´í„° ì €ì¥   |

#### âœ¨ ì£¼ìš” ê³ ë ¤ì‚¬í•­

- **íŠ¸ëœì­ì…˜ ë²”ìœ„** ê´€ë¦¬ â†’ Chunk ë‹¨ìœ„
- **ëŒ€ëŸ‰ ì²˜ë¦¬ ì‹œ ë©”ëª¨ë¦¬ ê´€ë¦¬** ì¤‘ìš”
- **DB ë½ ì£¼ì˜** â†’ `JdbcCursorItemReader`ëŠ” ì£¼ì˜ í•„ìš”
- **ë³‘ë ¬ ì²˜ë¦¬ (Partitioning)** ì‚¬ìš© ê°€ëŠ¥

#### âœ¨ ì˜ˆì‹œ ì½”ë“œ (JpaPagingItemReader ê¸°ë°˜)

```
@Bean
public JpaPagingItemReader<Member> memberReader(EntityManagerFactory emf) {
    JpaPagingItemReader<Member> reader = new JpaPagingItemReader<>();
    reader.setEntityManagerFactory(emf);
    reader.setQueryString("SELECT m FROM Member m WHERE m.status = :status");
    
    Map<String, Object> parameters = new HashMap<>();
    parameters.put("status", "ACTIVE");
    reader.setParameterValues(parameters);
    reader.setPageSize(100);
    return reader;
}
```

------

### 3ï¸âƒ£ íŒŒì¼ ê¸°ë°˜ ë°°ì¹˜

#### âœ¨ ëª©ì 

- **CSV, TSV, Fixed-Length, XML, JSON** íŒŒì¼ â†’ DB ì €ì¥ ë˜ëŠ” ë°˜ëŒ€ ë°©í–¥
- **íŒŒì¼ â†’ íŒŒì¼ ë³€í™˜** (ETL)

#### âœ¨ êµ¬ì„±

#### 1. ItemReader

| êµ¬í˜„ì²´                         | ì„¤ëª…                            |
| ------------------------------ | ------------------------------- |
| `FlatFileItemReader`           | CSV, TXT, TSV ë“± flat file ì²˜ë¦¬ |
| `StaxEventItemReader`          | XML íŒŒì¼ ì²˜ë¦¬                   |
| JSON Reader (ì»¤ìŠ¤í…€ êµ¬í˜„ í•„ìš”) | JSON â†’ Jackson ì´ìš© ì§ì ‘ êµ¬í˜„   |

#### 2. ItemWriter

| êµ¬í˜„ì²´                         | ì„¤ëª…                            |
| ------------------------------ | ------------------------------- |
| `FlatFileItemWriter`           | CSV, TXT, TSV ë“± flat file ì“°ê¸° |
| `StaxEventItemWriter`          | XML íŒŒì¼ ì“°ê¸°                   |
| JSON Writer (ì»¤ìŠ¤í…€ êµ¬í˜„ í•„ìš”) | JSON â†’ Jackson ì´ìš© ì§ì ‘ êµ¬í˜„   |

#### âœ¨ ì£¼ìš” ê³ ë ¤ì‚¬í•­

- **íŒŒì¼ ì¸ì½”ë”©** (UTF-8, EUC-KR ë“±)
- **í—¤ë”/í‘¸í„° ë¼ì¸ ì²˜ë¦¬**
- **ì—ëŸ¬ ë°œìƒ ì‹œ ë¡¤ë°± ì „ëµ** ì„¤ì •
- **ëŒ€ìš©ëŸ‰ íŒŒì¼ì¼ ê²½ìš° ChunkSize ì¡°ì • ë° Buffer ì „ëµ**

#### âœ¨ ì˜ˆì‹œ ì½”ë“œ (FlatFileItemReader + FlatFileItemWriter)

#### Reader ì„¤ì • (CSV íŒŒì¼ ì½ê¸°)

```
@Bean
public FlatFileItemReader<Customer> customerReader() {
    FlatFileItemReader<Customer> reader = new FlatFileItemReader<>();
    reader.setResource(new ClassPathResource("customer.csv"));
    reader.setLinesToSkip(1); // Header skip
    reader.setLineMapper(new DefaultLineMapper<Customer>() {{
        setLineTokenizer(new DelimitedLineTokenizer() {{
            setNames("id", "name", "email");
        }});
        setFieldSetMapper(new BeanWrapperFieldSetMapper<Customer>() {{
            setTargetType(Customer.class);
        }});
    }});
    return reader;
}
```

#### Writer ì„¤ì • (CSV íŒŒì¼ ì“°ê¸°)

```
@Bean
public FlatFileItemWriter<Customer> customerWriter() {
    FlatFileItemWriter<Customer> writer = new FlatFileItemWriter<>();
    writer.setResource(new FileSystemResource("output/customers_output.csv"));
    writer.setLineAggregator(new DelimitedLineAggregator<Customer>() {{
        setDelimiter(",");
        setFieldExtractor(new BeanWrapperFieldExtractor<Customer>() {{
            setNames(new String[] { "id", "name", "email" });
        }});
    }});
    return writer;
}
```

------

### 4ï¸âƒ£ ì‹¤ì „ í™œìš© ì‹œ íŒ¨í„´

| íŒ¨í„´ ìœ í˜•                 | ì¶”ì²œ ê¸°ìˆ  ìš”ì†Œ                                 |
| ------------------------- | ---------------------------------------------- |
| **DB â†’ DB**               | `JdbcCursorItemReader` + `JdbcBatchItemWriter` |
| **DB â†’ CSV**              | `JpaPagingItemReader` + `FlatFileItemWriter`   |
| **CSV â†’ DB**              | `FlatFileItemReader` + `JpaItemWriter`         |
| **DB â†’ JSON**             | `JpaPagingItemReader` + Custom JSON Writer     |
| **íŒŒì¼ ë³€í™˜ (CSV â†’ CSV)** | `FlatFileItemReader` + `FlatFileItemWriter`    |

------

### 5ï¸âƒ£ í™•ì¥ ê³ ë ¤ì‚¬í•­

- **ë°°ì¹˜ ì¬ì‹¤í–‰ ì „ëµ**: ì´ë¯¸ ì²˜ë¦¬ëœ ë°ì´í„° skip (idempotent)
- **ì˜¤ë¥˜ ë°œìƒ ì‹œ skip ì •ì±…** ì„¤ì •
- **ëŒ€ëŸ‰ ë°ì´í„°ì¼ ê²½ìš° Partitioning, Parallel Step ì ìš©**
- **ëª¨ë‹ˆí„°ë§**: ExecutionContext + JobRepository í™œìš©

## ìŠ¤ì¼€ì¤„ë§ ì—°ê³„, ì‹¤íŒ¨ ë³µêµ¬

### 1ï¸âƒ£ ìŠ¤ì¼€ì¤„ë§ ì—°ê³„ë€?

#### âœ¨ ëª©ì 

- **ì •í•´ì§„ ì‹œê°„ / ì£¼ê¸°**ì— ë°°ì¹˜ ì‘ì—… ìë™ ì‹¤í–‰
- **ìš´ì˜ ìë™í™”**ë¥¼ ìœ„í•œ í•„ìˆ˜ êµ¬ì„±
- ì˜ˆì‹œ:
  - ë§¤ì¼ ìƒˆë²½ 3ì‹œ ì •ì‚°
  - ë§¤ 5ë¶„ë§ˆë‹¤ ë¡œê·¸ ìˆ˜ì§‘
  - ë§¤ì£¼ ê¸ˆìš”ì¼ ë¦¬í¬íŠ¸ ìƒì„±

#### âœ¨ ì£¼ìš” ë°©ë²•

| ë°©ë²•                                               | íŠ¹ì§•                                             |
| -------------------------------------------------- | ------------------------------------------------ |
| `@Scheduled` (Spring ì œê³µ)                         | ê°„ë‹¨í•œ ì£¼ê¸°ì„± ì‘ì—…ì— ì í•©                        |
| Quartz Scheduler                                   | ê³ ê¸‰ ìŠ¤ì¼€ì¤„ë§ ê¸°ëŠ¥ ì§€ì› (ë¶„ì‚°, íŠ¸ëœì­ì…˜ ë³´ì¥ ë“±) |
| ì™¸ë¶€ ìŠ¤ì¼€ì¤„ë§ (cron + systemd, Kubernetes CronJob) | ì‹œìŠ¤í…œ ë‹¨ì—ì„œ ê´€ë¦¬ (ë³´ë‹¤ ë…ë¦½ì )                 |

------

#### 1ï¸âƒ£.1 `@Scheduled` ì‚¬ìš©ë²•

```
@EnableScheduling
@Configuration
public class BatchScheduler {

    private final JobLauncher jobLauncher;
    private final Job myBatchJob;

    public BatchScheduler(JobLauncher jobLauncher, Job myBatchJob) {
        this.jobLauncher = jobLauncher;
        this.myBatchJob = myBatchJob;
    }

    @Scheduled(cron = "0 0 3 * * ?") // ë§¤ì¼ ìƒˆë²½ 3ì‹œ
    public void runBatchJob() throws Exception {
        JobParameters params = new JobParametersBuilder()
                .addLong("time", System.currentTimeMillis())
                .toJobParameters();
        jobLauncher.run(myBatchJob, params);
    }
}
```

#### ì£¼ì˜ì‚¬í•­

- **JobParameters ë°˜ë“œì‹œ ê³ ìœ **í•´ì•¼ í•¨ â†’ `time` ì¶”ê°€
- ë™ì¼ JobParameters ë¡œ ì‹¤í–‰í•˜ë©´ **ì´ë¯¸ ì™„ë£Œë¨**ìœ¼ë¡œ ê°„ì£¼ â†’ ì¬ì‹¤í–‰ ì•ˆ ë¨

------

#### 1ï¸âƒ£.2 Quartz Scheduler ì—°ê³„

#### ì¥ì 

- **ë¶„ì‚° ìŠ¤ì¼€ì¤„ë§ ê°€ëŠ¥**
- Job ì‹¤í–‰ ì´ë ¥ ê´€ë¦¬
- ë¯¸ì™„ë£Œ ì‹œ ì¬ì‹œë„ ê¸°ëŠ¥ ë‚´ì¥

#### êµ¬ì„± ì˜ˆì‹œ

1. `QuartzJobBean` ìƒì†
2. `JobLauncher` í†µí•´ Spring Batch Job ì‹¤í–‰

```
@Component
public class QuartzBatchJob extends QuartzJobBean {

    @Autowired
    private JobLauncher jobLauncher;

    @Autowired
    private Job myBatchJob;

    @Override
    protected void executeInternal(JobExecutionContext context) throws JobExecutionException {
        try {
            JobParameters params = new JobParametersBuilder()
                    .addLong("time", System.currentTimeMillis())
                    .toJobParameters();
            jobLauncher.run(myBatchJob, params);
        } catch (Exception e) {
            throw new JobExecutionException(e);
        }
    }
}
```

â†’ Quartz Trigger ì™€ JobDetail ì„¤ì • í•„ìš” (ìë°” Config ë˜ëŠ” XML)

------

#### 1ï¸âƒ£.3 ì™¸ë¶€ ìŠ¤ì¼€ì¤„ë§ í™œìš© (systemd / Kubernetes CronJob ë“±)

```
# Linux crontab ì˜ˆì‹œ
0 3 * * * java -jar my-batch.jar
```

- ì¥ì : Application ì´ ë‹¤ìš´ë˜ë”ë¼ë„ OS ìˆ˜ì¤€ì—ì„œ ê´€ë¦¬ ê°€ëŠ¥
- ìš´ì˜ í™˜ê²½ì—ì„œëŠ” ë³´í†µ Quartz or ì™¸ë¶€ ìŠ¤ì¼€ì¤„ë§ + ëª¨ë‹ˆí„°ë§ ì¡°í•© ì‚¬ìš©

------

### 2ï¸âƒ£ ì‹¤íŒ¨ ë³µêµ¬ ì „ëµ

#### âœ¨ ëª©ì 

- ë°°ì¹˜ ì‹¤í–‰ ë„ì¤‘ **ì¥ì•  ë°œìƒ ì‹œ ë³µêµ¬ ê°€ëŠ¥í•˜ê²Œ ì„¤ê³„**
- "ì²˜ìŒë¶€í„° ë‹¤ì‹œ"ê°€ ì•„ë‹Œ **ì¤‘ë‹¨ëœ ì§€ì ë¶€í„° ë³µì› ê°€ëŠ¥**
- ìš´ì˜ ì‹ ë¢°ì„± í™•ë³´

------

#### 2ï¸âƒ£.1 ExecutionContext í™œìš©

- StepExecutionContext ì— ìƒíƒœ ì €ì¥ â†’ ë‹¤ìŒ ì‹¤í–‰ ì‹œ ë³µì› ê°€ëŠ¥

#### êµ¬ì„±

```
reader.open(stepExecution.getExecutionContext());
processor.open(stepExecution.getExecutionContext());
writer.open(stepExecution.getExecutionContext());
```

- FlatFileItemReader, JpaPagingItemReader ë“±ì€ ê¸°ë³¸ì ìœ¼ë¡œ ë‚´ë¶€ì— ë³µêµ¬ ì§€ì› ì˜µì…˜ ìˆìŒ (`saveState = true`)

```
reader.setSaveState(true);
```

â†’ ìë™ìœ¼ë¡œ ExecutionContext ì— **lastReadPosition** ì €ì¥ë¨

------

#### 2ï¸âƒ£.2 Incrementer í™œìš©

- JobParameter ì— `RunIdIncrementer` ì ìš© â†’ ë§¤ ì‹¤í–‰ë§ˆë‹¤ ê³ ìœ  ID ìƒì„±

```
@Bean
public Job myBatchJob(JobBuilderFactory jobBuilderFactory, Step myStep) {
    return jobBuilderFactory.get("myBatchJob")
            .incrementer(new RunIdIncrementer())
            .flow(myStep)
            .end()
            .build();
}
```

- ì´ êµ¬ì¡°ë¥¼ ì‚¬ìš©í•˜ë©´ ë™ì¼ JobParameters ë¡œ ì¬ì‹¤í–‰ ê°€ëŠ¥

------

#### 2ï¸âƒ£.3 Restartable Job ì„¤ê³„

| ìš”ì†Œ               | ì ìš© ë°©ë²•                             |
| ------------------ | ------------------------------------- |
| `saveState = true` | Reader / Writer ì— ì ìš©               |
| Incrementer ì‚¬ìš©   | JobParameter ê´€ë¦¬                     |
| JobRepository ì‚¬ìš© | JobExecution ìƒíƒœ ê¸°ë¡ / ì¡°íšŒ ê°€ëŠ¥    |
| `JobExplorer` ì‚¬ìš© | ê¸°ì¡´ JobExecution í™•ì¸ í›„ ì¬ì‹œì‘ ê°€ëŠ¥ |

#### ìƒíƒœ ê´€ë¦¬ íë¦„

```
STARTED â†’ STOPPED â†’ STARTED â†’ COMPLETED / FAILED
```

- STOPPED/FAILED ìƒíƒœ â†’ ì´í›„ **ì¬ì‹œì‘ ì‹œ ì´ì–´ì„œ ë³µêµ¬ ê°€ëŠ¥**

------

#### 2ï¸âƒ£.4 ì¬ì²˜ë¦¬ ì •ì±… êµ¬ì„±

- `skipPolicy` â†’ ì—ëŸ¬ ë°œìƒ ì‹œ skip
- `retryPolicy` â†’ ì¬ì‹œë„
- `faultTolerant()` â†’ skip/retry ì¡°í•© ê°€ëŠ¥

```
stepBuilderFactory.get("myStep")
    .<InputType, OutputType>chunk(100)
    .reader(reader)
    .processor(processor)
    .writer(writer)
    .faultTolerant()
    .skip(Exception.class)
    .skipLimit(10)
    .retry(Exception.class)
    .retryLimit(3)
    .build();
```

- ì˜ˆì‹œ:
  - ìµœëŒ€ 10ê±´ê¹Œì§€ skip í—ˆìš©
  - ì—ëŸ¬ ë°œìƒ ì‹œ ìµœëŒ€ 3íšŒê¹Œì§€ retry

------

### 3ï¸âƒ£ ì‹¤ì „ ìš´ì˜ Tips

âœ… ìŠ¤ì¼€ì¤„ë§ êµ¬ì„± ì‹œ

- ìš´ì˜ ì„œë²„ì—ì„œëŠ” **Quartz + External Scheduler** ë³‘í–‰ ì¶”ì²œ
- ê°œë°œ/í…ŒìŠ¤íŠ¸ ë‹¨ê³„ì—ì„œëŠ” **@Scheduled** ë¡œ ë¹ ë¥´ê²Œ í…ŒìŠ¤íŠ¸ ê°€ëŠ¥

âœ… ì‹¤íŒ¨ ë³µêµ¬ êµ¬ì„± ì‹œ

- **saveState, ExecutionContext ì ê·¹ í™œìš©**
- JobRepository ë°˜ë“œì‹œ ìœ ì§€ (H2 ì‚¬ìš© ë§ê³  MySQL/Postgres ê¶Œì¥)
- ì‹¤íŒ¨ ì‹œ ìš´ì˜íˆ´ì—ì„œ ìˆ˜ë™ ì¬ì‹œì‘ â†’ ì´ì–´ì„œ ë³µêµ¬ ê°€ëŠ¥

âœ… ëª¨ë‹ˆí„°ë§

- **Actuator** ë¡œ Job ìƒíƒœ ë…¸ì¶œ ê°€ëŠ¥ (`/actuator/batch` ë“±)
- JobExecution ìƒíƒœë¥¼ DB ê¸°ë°˜ ëª¨ë‹ˆí„°ë§ í˜ì´ì§€ êµ¬ì„± ê¶Œì¥

------

### ì •ë¦¬í•˜ë©´:

| ê¸°ëŠ¥                                  | ì£¼ ìš©ë„ / ëª©ì                 |
| ------------------------------------- | ----------------------------- |
| @Scheduled                            | ê°„ë‹¨í•œ ì£¼ê¸°ì  ì‹¤í–‰            |
| Quartz                                | ê³ ê¸‰ ìŠ¤ì¼€ì¤„ë§, ë¶„ì‚° í™˜ê²½ ì§€ì› |
| External Scheduler (cron/systemd/K8S) | ë…ë¦½ì , ì‹œìŠ¤í…œ ìˆ˜ì¤€ ì œì–´      |
| saveState                             | Step ë‹¨ìœ„ ìƒíƒœ ë³µêµ¬           |
| RetryPolicy                           | ì¥ì•  ì‹œ ì¬ì‹œë„ ì§€ì›           |
| skipPolicy                            | ì¼ë¶€ ê±´ skip ì²˜ë¦¬             |
| JobExplorer / JobRepository           | Job ìƒíƒœ ê´€ë¦¬, ì¬ì‹œì‘ ì§€ì›    |