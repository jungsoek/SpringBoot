# 9. ê²Œì‹œíŒ ê¸°ëŠ¥ êµ¬í˜„

## ê²Œì‹œê¸€ CRUD

**(Post Create / Read / Update / Delete Implementation)**

ê²Œì‹œê¸€ CRUDëŠ” ê²Œì‹œíŒ ì‹œìŠ¤í…œì˜ í•µì‹¬ ê¸°ëŠ¥ìœ¼ë¡œ, ì‚¬ìš©ìëŠ” ê²Œì‹œê¸€ì„ ì‘ì„±, ì¡°íšŒ, ìˆ˜ì •, ì‚­ì œí•  ìˆ˜ ìˆì–´ì•¼ í•œë‹¤. ì´ ê¸°ëŠ¥ì€ **ë„ë©”ì¸ ëª¨ë¸ â†’ ì„œë¹„ìŠ¤ â†’ ì»¨íŠ¸ë¡¤ëŸ¬ â†’ ë·°(ë˜ëŠ” API)**ë¡œ ì´ì–´ì§€ëŠ” ì „í˜•ì ì¸ MVC êµ¬ì¡°ë¥¼ ë”°ë¥¸ë‹¤.

------

### 1. ë„ë©”ì¸ ëª¨ë¸ ì„¤ê³„

```
@Entity
public class Post {
    @Id @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;

    @NotBlank
    private String title;

    @Lob
    private String content;

    private String author;

    private LocalDateTime createdAt;
    private LocalDateTime updatedAt;

    // ìƒì„± ì‹œê°„ ìë™ ì„¤ì •
    @PrePersist
    public void prePersist() {
        this.createdAt = LocalDateTime.now();
        this.updatedAt = LocalDateTime.now();
    }

    @PreUpdate
    public void preUpdate() {
        this.updatedAt = LocalDateTime.now();
    }

    // Getter / Setter
}
```

------

### 2. Repository ì‘ì„±

```
public interface PostRepository extends JpaRepository<Post, Long> {
    List<Post> findByTitleContaining(String keyword); // ê²€ìƒ‰ìš©
}
```

------

### 3. ì„œë¹„ìŠ¤ ë ˆì´ì–´

```
@Service
@RequiredArgsConstructor
public class PostService {

    private final PostRepository postRepository;

    public Post create(Post post) {
        return postRepository.save(post);
    }

    public Post read(Long id) {
        return postRepository.findById(id)
                .orElseThrow(() -> new EntityNotFoundException("ê²Œì‹œê¸€ ì—†ìŒ"));
    }

    public Post update(Long id, Post updatedPost) {
        Post post = read(id);
        post.setTitle(updatedPost.getTitle());
        post.setContent(updatedPost.getContent());
        return postRepository.save(post);
    }

    public void delete(Long id) {
        postRepository.deleteById(id);
    }

    public List<Post> listAll() {
        return postRepository.findAll(Sort.by(Sort.Direction.DESC, "createdAt"));
    }
}
```

------

### 4. ì»¨íŠ¸ë¡¤ëŸ¬ êµ¬ì„± (ì›¹ MVC)

```
@Controller
@RequiredArgsConstructor
@RequestMapping("/posts")
public class PostController {

    private final PostService postService;

    @GetMapping
    public String list(Model model) {
        model.addAttribute("posts", postService.listAll());
        return "post/list";
    }

    @GetMapping("/{id}")
    public String detail(@PathVariable Long id, Model model) {
        model.addAttribute("post", postService.read(id));
        return "post/detail";
    }

    @GetMapping("/new")
    public String form(Model model) {
        model.addAttribute("post", new Post());
        return "post/form";
    }

    @PostMapping
    public String create(@ModelAttribute @Valid Post post, BindingResult result) {
        if (result.hasErrors()) {
            return "post/form";
        }
        Post saved = postService.create(post);
        return "redirect:/posts/" + saved.getId();
    }

    @GetMapping("/{id}/edit")
    public String edit(@PathVariable Long id, Model model) {
        model.addAttribute("post", postService.read(id));
        return "post/edit";
    }

    @PostMapping("/{id}/edit")
    public String update(@PathVariable Long id, @ModelAttribute Post post) {
        postService.update(id, post);
        return "redirect:/posts/" + id;
    }

    @PostMapping("/{id}/delete")
    public String delete(@PathVariable Long id) {
        postService.delete(id);
        return "redirect:/posts";
    }
}
```

------

### 5. ë·° í…œí”Œë¦¿ êµ¬ì„± (Thymeleaf ì˜ˆì‹œ)

#### ğŸ“„ `list.html`

```
<table>
  <tr th:each="post : ${posts}">
    <td th:text="${post.title}"></td>
    <td><a th:href="@{'/posts/' + ${post.id}}">ë³´ê¸°</a></td>
  </tr>
</table>
```

#### ğŸ“„ `detail.html`

```
<h1 th:text="${post.title}"></h1>
<p th:text="${post.content}"></p>
<a th:href="@{'/posts/' + ${post.id} + '/edit'}">ìˆ˜ì •</a>
<form th:action="@{'/posts/' + ${post.id} + '/delete'}" method="post">
  <button type="submit">ì‚­ì œ</button>
</form>
```

------

### 6. ìœ íš¨ì„± ê²€ì¦

- `@NotBlank`, `@Size`, `@Valid`, `BindingResult`ë¥¼ í™œìš©í•˜ì—¬ ì‚¬ìš©ì ì…ë ¥ì„ ê²€ì¦
- ì—ëŸ¬ ë©”ì‹œì§€ëŠ” Thymeleafì—ì„œ `${#fields.hasErrors()}`ë¡œ í‘œì‹œ

------

### 7. REST API ë²„ì „ ì»¨íŠ¸ë¡¤ëŸ¬ ì˜ˆì‹œ

```
@RestController
@RequiredArgsConstructor
@RequestMapping("/api/posts")
public class PostApiController {

    private final PostService postService;

    @PostMapping
    public ResponseEntity<Post> create(@RequestBody Post post) {
        return ResponseEntity.ok(postService.create(post));
    }

    @GetMapping("/{id}")
    public ResponseEntity<Post> read(@PathVariable Long id) {
        return ResponseEntity.ok(postService.read(id));
    }

    @PutMapping("/{id}")
    public ResponseEntity<Post> update(@PathVariable Long id, @RequestBody Post post) {
        return ResponseEntity.ok(postService.update(id, post));
    }

    @DeleteMapping("/{id}")
    public ResponseEntity<Void> delete(@PathVariable Long id) {
        postService.delete(id);
        return ResponseEntity.noContent().build();
    }
}
```

------

### ê²°ë¡ 

ê²Œì‹œê¸€ CRUDëŠ” ê²Œì‹œíŒ ì‹œìŠ¤í…œì˜ í•µì‹¬ì´ì ê¸°ë³¸ ê¸°ëŠ¥ì´ë‹¤.

- MVC íŒ¨í„´ì„ ëª…í™•íˆ ë”°ë¥´ë©° Controller â†’ Service â†’ Repository â†’ Entityë¡œ êµ¬ì„±
- ìœ íš¨ì„± ê²€ì¦, ì˜ˆì™¸ ì²˜ë¦¬, ë³´ì•ˆ ì²˜ë¦¬, ë·° ë Œë”ë§ ë° REST API ì§€ì›ì„ í†µí•´ ìœ ì§€ë³´ìˆ˜ì„±ê³¼ í™•ì¥ì„±ì´ ë†’ì€ êµ¬ì¡°ë¡œ êµ¬í˜„í•˜ëŠ” ê²ƒì´ ë°”ëŒì§í•˜ë‹¤.

------

> âœ… ì‹¤ë¬´ì—ì„œëŠ” DTOì™€ Mapper ê³„ì¸µì„ ë„ì…í•˜ê³ , ê²Œì‹œê¸€ ì‘ì„±ì ì¸ì¦, ìˆ˜ì • ê¶Œí•œ ê²€ì¦, íŒŒì¼ ì²¨ë¶€ ë“± ê¸°ëŠ¥ì„ ì¶”ê°€í•˜ë©´ì„œ ì™„ì„±ë„ë¥¼ ë†’ì¸ë‹¤.

- ## ê²Œì‹œê¸€ ëª©ë¡

  **(Post List View â€“ í˜ì´ì§•, ì •ë ¬, ê²€ìƒ‰ í¬í•¨)**

  ê²Œì‹œê¸€ ëª©ë¡ í™”ë©´ì€ ì‚¬ìš©ìê°€ ê²Œì‹œíŒì—ì„œ ì‘ì„±ëœ ëª¨ë“  ê¸€ì„ ì—´ëŒí•  ìˆ˜ ìˆëŠ” ì§„ì…ì ì´ë©°, ì¼ë°˜ì ìœ¼ë¡œ **í˜ì´ì§•, ì •ë ¬, ê²€ìƒ‰** ê¸°ëŠ¥ê³¼ í•¨ê»˜ êµ¬ì„±ëœë‹¤.

  ------

  ### 1. ê¸°ë³¸ ìš”êµ¬ì‚¬í•­

  - ì „ì²´ ê²Œì‹œê¸€ì„ ìµœì‹ ìˆœìœ¼ë¡œ ì¶œë ¥
  - í˜ì´ì§€ë„¤ì´ì…˜ ì ìš© (ì˜ˆ: í•œ í˜ì´ì§€ë‹¹ 10ê°œ)
  - ê° ê²Œì‹œê¸€ì˜ **ì œëª©**, **ì‘ì„±ì**, **ì‘ì„±ì¼**, **ì¡°íšŒìˆ˜** ë“± ìš”ì•½ ì •ë³´ ì¶œë ¥
  - ì œëª© í´ë¦­ ì‹œ ìƒì„¸ í˜ì´ì§€ë¡œ ì´ë™
  - ì„ íƒì ìœ¼ë¡œ ê²€ìƒ‰ ë° ì •ë ¬ ê¸°ëŠ¥ í¬í•¨

  ------

  ### 2. Repository êµ¬ì„±

  Spring Data JPAì˜ `PagingAndSortingRepository` ê¸°ëŠ¥ì„ í™œìš©í•œë‹¤:

  ```
  public interface PostRepository extends JpaRepository<Post, Long> {
  
      // ì œëª© + ë‚´ìš© ê²€ìƒ‰ì„ ìœ„í•œ ì»¤ìŠ¤í…€ ë©”ì„œë“œ
      Page<Post> findByTitleContainingOrContentContaining(String title, String content, Pageable pageable);
  }
  ```

  ------

  ### 3. ì„œë¹„ìŠ¤ ê³„ì¸µ

  ```
  @Service
  @RequiredArgsConstructor
  public class PostService {
  
      private final PostRepository postRepository;
  
      public Page<Post> getPostList(String keyword, Pageable pageable) {
          if (keyword == null || keyword.trim().isEmpty()) {
              return postRepository.findAll(pageable);
          }
          return postRepository.findByTitleContainingOrContentContaining(keyword, keyword, pageable);
      }
  }
  ```

  ------

  ### 4. ì»¨íŠ¸ë¡¤ëŸ¬ êµ¬ì„±

  ```
  @Controller
  @RequiredArgsConstructor
  @RequestMapping("/posts")
  public class PostController {
  
      private final PostService postService;
  
      @GetMapping
      public String list(@RequestParam(value = "page", defaultValue = "0") int page,
                         @RequestParam(value = "size", defaultValue = "10") int size,
                         @RequestParam(value = "keyword", required = false) String keyword,
                         Model model) {
          Pageable pageable = PageRequest.of(page, size, Sort.by("createdAt").descending());
          Page<Post> postPage = postService.getPostList(keyword, pageable);
  
          model.addAttribute("postPage", postPage);
          model.addAttribute("keyword", keyword);
  
          return "post/list";
      }
  }
  ```

  ------

  ### 5. Thymeleaf í…œí”Œë¦¿ ì˜ˆì‹œ

  #### ğŸ“„ `list.html`

  ```
  <h2>ê²Œì‹œê¸€ ëª©ë¡</h2>
  
  <form th:action="@{/posts}" method="get">
      <input type="text" name="keyword" th:value="${keyword}" placeholder="ê²€ìƒ‰ì–´ ì…ë ¥" />
      <button type="submit">ê²€ìƒ‰</button>
  </form>
  
  <table>
    <thead>
      <tr>
        <th>ë²ˆí˜¸</th>
        <th>ì œëª©</th>
        <th>ì‘ì„±ì</th>
        <th>ì‘ì„±ì¼</th>
      </tr>
    </thead>
    <tbody>
      <tr th:each="post, stat : ${postPage.content}">
        <td th:text="${stat.count + postPage.number * postPage.size}">1</td>
        <td>
          <a th:href="@{|/posts/${post.id}|}" th:text="${post.title}">ì œëª©</a>
        </td>
        <td th:text="${post.author}">ì‘ì„±ì</td>
        <td th:text="${#temporals.format(post.createdAt, 'yyyy-MM-dd HH:mm')}">ë‚ ì§œ</td>
      </tr>
    </tbody>
  </table>
  
  <div>
    <span th:text="|ì´ ${postPage.totalElements}ê±´ / ${postPage.totalPages}í˜ì´ì§€|"></span>
  </div>
  
  <div>
    <ul>
      <li th:if="${postPage.hasPrevious()}">
        <a th:href="@{/posts(page=${postPage.number - 1}, keyword=${keyword})}">ì´ì „</a>
      </li>
      <li th:each="i : ${#numbers.sequence(0, postPage.totalPages - 1)}">
        <a th:href="@{/posts(page=${i}, keyword=${keyword})}"
           th:text="${i + 1}"
           th:classappend="${postPage.number == i} ? 'active'">1</a>
      </li>
      <li th:if="${postPage.hasNext()}">
        <a th:href="@{/posts(page=${postPage.number + 1}, keyword=${keyword})}">ë‹¤ìŒ</a>
      </li>
    </ul>
  </div>
  ```

  ------

  ### 6. ì •ë ¬ ê¸°ëŠ¥ í™•ì¥ (ì„ íƒ)

  ì •ë ¬ ê¸°ì¤€ì„ URL íŒŒë¼ë¯¸í„°ë¡œ ì¶”ê°€í•˜ì—¬ ë™ì  ì •ë ¬ì´ ê°€ëŠ¥í•˜ë„ë¡ ì„¤ê³„í•  ìˆ˜ ìˆë‹¤:

  ```
  Pageable pageable = PageRequest.of(page, size, Sort.by(Sort.Direction.DESC, "createdAt"));
  // ë˜ëŠ” ë™ì  ì •ë ¬ íŒŒë¼ë¯¸í„° ì²˜ë¦¬ ë¡œì§ ì¶”ê°€
  ```

  ------

  ### 7. API ë°©ì‹ì˜ êµ¬í˜„ ì˜ˆ (ì„ íƒ)

  ```
  @GetMapping("/api/posts")
  public ResponseEntity<Page<Post>> apiList(@RequestParam int page,
                                            @RequestParam int size,
                                            @RequestParam(required = false) String keyword) {
      Pageable pageable = PageRequest.of(page, size);
      Page<Post> result = postService.getPostList(keyword, pageable);
      return ResponseEntity.ok(result);
  }
  ```

  ------

  ### ê²°ë¡ 

  ê²Œì‹œê¸€ ëª©ë¡ ê¸°ëŠ¥ì€ ë‹¨ìˆœí•œ ë°ì´í„° ì¶œë ¥ ì´ìƒìœ¼ë¡œ, **í˜ì´ì§•, ì •ë ¬, ê²€ìƒ‰, ì‚¬ìš©ì ê²½í—˜(UI)**ê³¼ ë°€ì ‘í•˜ê²Œ ì—°ê´€ëœë‹¤.
   Spring Data JPAì˜ `Page`, `Sort`, `Pageable`ì„ íš¨ê³¼ì ìœ¼ë¡œ ì¡°í•©í•˜ë©´ ìœ ì§€ë³´ìˆ˜ì„±ê³¼ í™•ì¥ì„±ì´ ë†’ì€ êµ¬í˜„ì´ ê°€ëŠ¥í•˜ë‹¤.

  ------

  > âœ… ì‹¤ë¬´ì—ì„œëŠ” ëª©ë¡ í™”ë©´ì— "ì¢‹ì•„ìš” ìˆ˜", "ëŒ“ê¸€ ìˆ˜", "ì¸ë„¤ì¼", "ì‘ì„±ì í”„ë¡œí•„" ë“± ë¶€ê°€ ì •ë³´ë¥¼ í•¨ê»˜ í‘œì‹œí•˜ì—¬ ì‚¬ìš©ìì˜ ë§Œì¡±ë„ë¥¼ ë†’ì´ëŠ” ë°©í–¥ìœ¼ë¡œ ë°œì „ì‹œí‚¨ë‹¤.

- ## ê²Œì‹œê¸€ ìƒì„¸

  **(Post Detail View â€“ ID ê¸°ë°˜ ì¡°íšŒ ë° ì¶œë ¥)**

  ê²Œì‹œê¸€ ìƒì„¸ í˜ì´ì§€ëŠ” ì‚¬ìš©ìê°€ íŠ¹ì • ê²Œì‹œê¸€ì„ ì„ íƒí–ˆì„ ë•Œ í•´ë‹¹ ê²Œì‹œê¸€ì˜ ì „ì²´ ë‚´ìš©ì„ í™•ì¸í•  ìˆ˜ ìˆë„ë¡ ì œê³µë˜ëŠ” í™”ë©´ì´ë‹¤. ì¼ë°˜ì ìœ¼ë¡œ ì œëª©, ë³¸ë¬¸, ì‘ì„±ì, ì‘ì„±ì¼, ì¡°íšŒìˆ˜ ë“±ì˜ ì •ë³´ê°€ í¬í•¨ë˜ë©°, ìˆ˜ì •/ì‚­ì œ ê¸°ëŠ¥ê³¼ ëŒ“ê¸€ ê¸°ëŠ¥ìœ¼ë¡œ í™•ì¥ë  ìˆ˜ ìˆë‹¤.

  ------

  ### 1. ê¸°ë³¸ ìš”êµ¬ì‚¬í•­

  - ê²Œì‹œê¸€ `id` ê°’ì„ ê¸°ë°˜ìœ¼ë¡œ í•´ë‹¹ ê²Œì‹œê¸€ì„ ì¡°íšŒ
  - ê²Œì‹œê¸€ì˜ **ì œëª©**, **ë‚´ìš©**, **ì‘ì„±ì**, **ì‘ì„±ì¼**, **ì¡°íšŒìˆ˜** ë“±ì„ ì¶œë ¥
  - í•˜ë‹¨ì— "ìˆ˜ì •", "ì‚­ì œ", "ëª©ë¡" ë“±ì˜ ë§í¬ ë˜ëŠ” ë²„íŠ¼ ì œê³µ
  - ì˜¤ë¥˜ ì²˜ë¦¬: ì¡´ì¬í•˜ì§€ ì•ŠëŠ” `id`ì— ëŒ€í•œ ìš”ì²­ì— ëŒ€í•´ ì˜ˆì™¸ ì²˜ë¦¬ í•„ìš”

  ------

  ### 2. ì„œë¹„ìŠ¤ ê³„ì¸µ

  ```
  @Service
  @RequiredArgsConstructor
  public class PostService {
  
      private final PostRepository postRepository;
  
      public Post getPostById(Long id) {
          return postRepository.findById(id)
              .orElseThrow(() -> new EntityNotFoundException("ê²Œì‹œê¸€ì´ ì¡´ì¬í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤."));
      }
  }
  ```

  ------

  ### 3. ì»¨íŠ¸ë¡¤ëŸ¬ êµ¬ì„±

  ```
  @Controller
  @RequiredArgsConstructor
  @RequestMapping("/posts")
  public class PostController {
  
      private final PostService postService;
  
      @GetMapping("/{id}")
      public String detail(@PathVariable Long id, Model model) {
          Post post = postService.getPostById(id);
          model.addAttribute("post", post);
          return "post/detail";
      }
  }
  ```

  ------

  ### 4. Thymeleaf í…œí”Œë¦¿ ì˜ˆì‹œ

  #### ğŸ“„ `detail.html`

  ```
  <h2 th:text="${post.title}">ì œëª©</h2>
  <p>
    ì‘ì„±ì: <span th:text="${post.author}">ì‘ì„±ì</span> |
    ì‘ì„±ì¼: <span th:text="${#temporals.format(post.createdAt, 'yyyy-MM-dd HH:mm')}">ë‚ ì§œ</span> |
    ì¡°íšŒìˆ˜: <span th:text="${post.viewCount}">0</span>
  </p>
  
  <hr/>
  
  <div th:utext="${post.content}">ë³¸ë¬¸ ë‚´ìš©</div>
  
  <hr/>
  
  <div>
    <a th:href="@{/posts}">ëª©ë¡</a>
    <a th:href="@{|/posts/${post.id}/edit|}">ìˆ˜ì •</a>
    <form th:action="@{|/posts/${post.id}/delete|}" method="post" style="display:inline">
      <button type="submit" onclick="return confirm('ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')">ì‚­ì œ</button>
    </form>
  </div>
  ```

  > `th:utext`ëŠ” HTML íƒœê·¸ê°€ í¬í•¨ëœ ë‚´ìš©ì„ ì•ˆì „í•˜ê²Œ ë Œë”ë§í•  ë•Œ ì‚¬ìš©í•œë‹¤. ì…ë ¥ê°’ì„ `XSS` í•„í„°ë§í•œ ê²½ìš°ì—ë§Œ ì‚¬ìš©í•œë‹¤.

  ------

  ### 5. ì¡°íšŒìˆ˜ ì¦ê°€ ì²˜ë¦¬ (ì„ íƒ)

  ê²Œì‹œê¸€ ìƒì„¸ í˜ì´ì§€ ì§„ì… ì‹œ ì¡°íšŒìˆ˜ë¥¼ ì¦ê°€ì‹œí‚¤ëŠ” ë¡œì§ì„ ì¶”ê°€í•  ìˆ˜ ìˆë‹¤:

  ```
  @Transactional
  public Post getPostByIdAndIncreaseView(Long id) {
      Post post = postRepository.findById(id)
          .orElseThrow(() -> new EntityNotFoundException("ê²Œì‹œê¸€ì´ ì¡´ì¬í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤."));
      post.setViewCount(post.getViewCount() + 1);
      return post;
  }
  ```

  ë˜ëŠ” Entityì— `@Version`ì„ ì´ìš©í•œ ë™ì‹œì„± ì²˜ë¦¬ í˜¹ì€ Redisì™€ ê°™ì€ ìºì‹œ ê¸°ë°˜ ì²˜ë¦¬ë¡œ í™•ì¥ ê°€ëŠ¥.

  ------

  ### 6. ì˜¤ë¥˜ ì²˜ë¦¬

  ì¡´ì¬í•˜ì§€ ì•ŠëŠ” ê²Œì‹œê¸€ì„ ìš”ì²­í•˜ëŠ” ê²½ìš°, ì „ì—­ ì˜ˆì™¸ ì²˜ë¦¬ë¡œ ëŒ€ì‘í•  ìˆ˜ ìˆë‹¤:

  ```
  @ControllerAdvice
  public class GlobalExceptionHandler {
  
      @ExceptionHandler(EntityNotFoundException.class)
      public String handleNotFound(EntityNotFoundException ex, Model model) {
          model.addAttribute("errorMessage", ex.getMessage());
          return "error/404";
      }
  }
  ```

  ------

  ### ê²°ë¡ 

  ê²Œì‹œê¸€ ìƒì„¸ ê¸°ëŠ¥ì€ ì‚¬ìš©ìê°€ ê°œë³„ ê¸€ì˜ ë‚´ìš©ì„ í™•ì¸í•˜ëŠ” í•µì‹¬ ì¸í„°í˜ì´ìŠ¤ë¡œ,

  - ID ê¸°ë°˜ì˜ ì•ˆì „í•œ ì¡°íšŒ
  - ì˜ˆì™¸ ì²˜ë¦¬
  - ì¡°íšŒìˆ˜ ì²˜ë¦¬
  - ìˆ˜ì •/ì‚­ì œ ë§í¬ ë° ë³´ì•ˆ ì²˜ë¦¬

  ë“±ì„ ê³ ë ¤í•˜ì—¬ ê²¬ê³ í•˜ê²Œ ì„¤ê³„ë˜ì–´ì•¼ í•œë‹¤. íŠ¹íˆ ëŒ“ê¸€, ì²¨ë¶€íŒŒì¼, ì¶”ì²œ ê¸°ëŠ¥ ë“±ê³¼ì˜ í†µí•©ì„ ê³ ë ¤í•œ í™•ì¥ì„±ì´ ì¤‘ìš”í•˜ë‹¤.

  ------

  > âœ… ì‹¤ë¬´ì—ì„œëŠ” ìƒì„¸ í˜ì´ì§€ ë‚´ì— ëŒ“ê¸€ ëª©ë¡, íƒœê·¸, ê³µìœ  ë²„íŠ¼, ì‘ì„±ì í”„ë¡œí•„, ìˆ˜ì • ì´ë ¥ ë“±ì˜ UI ìš”ì†Œë„ í•¨ê»˜ êµ¬ì„±í•˜ì—¬ ì½˜í…ì¸  ì¤‘ì‹¬ì˜ UXë¥¼ ì œê³µí•œë‹¤.

- ## ê²Œì‹œê¸€ ì‘ì„±

  **(Post Create â€“ Form ì…ë ¥, ê²€ì¦, ì €ì¥ ì²˜ë¦¬)**

  ê²Œì‹œê¸€ ì‘ì„± ê¸°ëŠ¥ì€ ì‚¬ìš©ìë¡œë¶€í„° ì œëª©ê³¼ ë‚´ìš©ì„ ì…ë ¥ë°›ì•„ ì„œë²„ì— ì €ì¥í•˜ëŠ” í•µì‹¬ ê¸°ëŠ¥ ì¤‘ í•˜ë‚˜ì´ë‹¤. ì£¼ë¡œ `GET` ìš”ì²­ì„ í†µí•´ ì‘ì„± í™”ë©´ì„ ì œê³µí•˜ê³ , `POST` ìš”ì²­ì„ í†µí•´ í¼ ë°ì´í„°ë¥¼ ì²˜ë¦¬í•˜ê³  ì €ì¥í•˜ëŠ” êµ¬ì¡°ë¥¼ ë”°ë¥¸ë‹¤.

  ------

  ### 1. ìš”êµ¬ì‚¬í•­

  - ì‚¬ìš©ìê°€ ì œëª©, ë‚´ìš©ì„ ì‘ì„±í•˜ì—¬ ê²Œì‹œê¸€ì„ ë“±ë¡í•  ìˆ˜ ìˆì–´ì•¼ í•¨
  - ì„œë²„ ì¸¡ ìœ íš¨ì„± ê²€ì¦ ì ìš© (ì˜ˆ: ì œëª© í•„ìˆ˜)
  - ì‘ì„± ì™„ë£Œ í›„ ìƒì„¸ í˜ì´ì§€ë¡œ ë¦¬ë””ë ‰ì…˜
  - ì˜ëª»ëœ ì…ë ¥ ì‹œ ì…ë ¥ í¼ ì¬í‘œì‹œ ë° ì—ëŸ¬ ë©”ì‹œì§€ ì¶œë ¥
  - ë¡œê·¸ì¸ ê¸°ëŠ¥ì´ ìˆëŠ” ê²½ìš° ì‘ì„±ì ì •ë³´ ìë™ ì„¤ì •

  ------

  ### 2. Entity í´ë˜ìŠ¤

  ```
  @Entity
  public class Post {
  
      @Id @GeneratedValue(strategy = GenerationType.IDENTITY)
      private Long id;
  
      @NotBlank(message = "ì œëª©ì€ í•„ìˆ˜ í•­ëª©ì…ë‹ˆë‹¤.")
      private String title;
  
      @Lob
      private String content;
  
      private String author;
  
      private LocalDateTime createdAt;
  
      @PrePersist
      public void prePersist() {
          this.createdAt = LocalDateTime.now();
      }
  
      // Getter / Setter ìƒëµ
  }
  ```

  ------

  ### 3. Controller êµ¬ì„±

  ```
  @Controller
  @RequiredArgsConstructor
  @RequestMapping("/posts")
  public class PostController {
  
      private final PostService postService;
  
      // ì‘ì„± í¼ ì œê³µ
      @GetMapping("/new")
      public String createForm(Model model) {
          model.addAttribute("post", new Post());
          return "post/form";
      }
  
      // ì‘ì„± í¼ ì²˜ë¦¬
      @PostMapping
      public String create(@ModelAttribute @Valid Post post,
                           BindingResult bindingResult,
                           RedirectAttributes redirectAttributes) {
          if (bindingResult.hasErrors()) {
              return "post/form";
          }
  
          Post saved = postService.create(post);
          redirectAttributes.addFlashAttribute("message", "ê²Œì‹œê¸€ì´ ì„±ê³µì ìœ¼ë¡œ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤.");
          return "redirect:/posts/" + saved.getId();
      }
  }
  ```

  ------

  ### 4. ì„œë¹„ìŠ¤ ê³„ì¸µ

  ```
  @Service
  @RequiredArgsConstructor
  public class PostService {
  
      private final PostRepository postRepository;
  
      public Post create(Post post) {
          return postRepository.save(post);
      }
  }
  ```

  ------

  ### 5. ì‘ì„± í¼ ë·° (Thymeleaf)

  #### ğŸ“„ `form.html`

  ```
  <h2>ê²Œì‹œê¸€ ì‘ì„±</h2>
  
  <form th:action="@{/posts}" th:object="${post}" method="post">
    <div>
      <label for="title">ì œëª©</label>
      <input type="text" th:field="*{title}" id="title" />
      <div th:if="${#fields.hasErrors('title')}" th:errors="*{title}">ì œëª© ì˜¤ë¥˜</div>
    </div>
  
    <div>
      <label for="content">ë‚´ìš©</label>
      <textarea th:field="*{content}" id="content"></textarea>
    </div>
  
    <button type="submit">ì‘ì„±í•˜ê¸°</button>
  </form>
  ```

  ------

  ### 6. Flash ë©”ì‹œì§€ í‘œì‹œ (ì„ íƒ)

  ```
  <div th:if="${message}" th:text="${message}" class="alert alert-success"></div>
  ```

  ì»¨íŠ¸ë¡¤ëŸ¬ì—ì„œ:

  ```
  redirectAttributes.addFlashAttribute("message", "ê²Œì‹œê¸€ì´ ì„±ê³µì ìœ¼ë¡œ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤.");
  ```

  ------

  ### 7. ì¸ì¦ ì‚¬ìš©ìì™€ ì—°ê³„ (ì„ íƒ)

  Spring Securityì™€ ì—°ë™ëœ ê²½ìš° ì‘ì„±ì ì •ë³´ë¥¼ `SecurityContextHolder`ì—ì„œ ê°€ì ¸ì˜¬ ìˆ˜ ìˆë‹¤:

  ```
  Authentication auth = SecurityContextHolder.getContext().getAuthentication();
  String username = auth.getName();
  post.setAuthor(username);
  ```

  ë˜ëŠ” ì»¨íŠ¸ë¡¤ëŸ¬ì— `@AuthenticationPrincipal` ì£¼ì… ë°©ì‹ ì‚¬ìš©:

  ```
  @PostMapping
  public String create(@ModelAttribute @Valid Post post,
                       BindingResult result,
                       @AuthenticationPrincipal UserDetails userDetails) {
      post.setAuthor(userDetails.getUsername());
      ...
  }
  ```

  ------

  ### ê²°ë¡ 

  ê²Œì‹œê¸€ ì‘ì„±ì€ MVC êµ¬ì¡°ì˜ ì „í˜•ì ì¸ í¼ ì…ë ¥ ì²˜ë¦¬ íë¦„ì„ ë”°ë¥¸ë‹¤.

  - **ìœ íš¨ì„± ê²€ì¦**, **ë°”ì¸ë”© ì²˜ë¦¬**, **ì˜¤ë¥˜ ë©”ì‹œì§€ í‘œì‹œ**, **ì‘ì„±ì ì •ë³´ ìë™ ì…ë ¥**, **ë¦¬ë””ë ‰ì…˜ ë° ë©”ì‹œì§€ ì¶œë ¥** ë“±ì˜ ìš”ì†Œë¥¼ ì ì ˆíˆ êµ¬ì„±í•´ì•¼ í•œë‹¤.
  - ì‹¤ë¬´ì—ì„œëŠ” XSS ë°©ì§€, ì´ë¯¸ì§€ ì—…ë¡œë“œ, ìë™ ì €ì¥ ë“±ì˜ ê³ ê¸‰ ê¸°ëŠ¥ì„ ì¶”ê°€í•˜ì—¬ UXë¥¼ ê°•í™”í•  ìˆ˜ ìˆë‹¤.

  ------

  > âœ… íŒ: ê²Œì‹œê¸€ ì‘ì„± ê¸°ëŠ¥ì€ ì´í›„ ëŒ“ê¸€, ì²¨ë¶€íŒŒì¼, íƒœê·¸ ë“± ì—¬ëŸ¬ ê¸°ëŠ¥ê³¼ ì—°ê²°ë˜ë¯€ë¡œ ë„ë©”ì¸ ëª¨ë¸ì„ ìœ ì—°í•˜ê²Œ ì„¤ê³„í•´ë‘ëŠ” ê²ƒì´ ì¤‘ìš”í•˜ë‹¤.

- ## ê²Œì‹œê¸€ ìˆ˜ì •

  **(Post Edit â€“ Form ê¸°ë°˜ ìˆ˜ì •, ë°ì´í„° ê²€ì¦, ë³€ê²½ì‚¬í•­ ë°˜ì˜)**

  ê²Œì‹œê¸€ ìˆ˜ì • ê¸°ëŠ¥ì€ ì‚¬ìš©ìê°€ ê¸°ì¡´ì— ì‘ì„±í•œ ê²Œì‹œê¸€ì„ ìˆ˜ì •í•  ìˆ˜ ìˆë„ë¡ í•˜ëŠ” ê¸°ëŠ¥ìœ¼ë¡œ, ì¼ë°˜ì ìœ¼ë¡œ `GET` ìš”ì²­ìœ¼ë¡œ ìˆ˜ì • í¼ì„ ì œê³µí•˜ê³ , `POST` ë˜ëŠ” `PUT` ìš”ì²­ìœ¼ë¡œ ë³€ê²½ì‚¬í•­ì„ ì„œë²„ì— ë°˜ì˜í•œë‹¤.

  ------

  ### 1. ìš”êµ¬ì‚¬í•­

  - ê¸°ì¡´ ê²Œì‹œê¸€ì˜ ì •ë³´ë¥¼ ìˆ˜ì •í•  ìˆ˜ ìˆëŠ” í¼ ì œê³µ
  - ì œëª©ê³¼ ë‚´ìš© í•„ë“œë¥¼ ìˆ˜ì • ê°€ëŠ¥
  - ìˆ˜ì • ì‹œ ìœ íš¨ì„± ê²€ì‚¬ ì ìš©
  - ìˆ˜ì • í›„ ìƒì„¸ í˜ì´ì§€ë¡œ ë¦¬ë””ë ‰ì…˜
  - ì¸ì¦ëœ ì‚¬ìš©ìë§Œ ìˆ˜ì • ê°€ëŠ¥ (ì„ íƒ)

  ------

  ### 2. Controller êµ¬ì„±

  ```
  @Controller
  @RequiredArgsConstructor
  @RequestMapping("/posts")
  public class PostController {
  
      private final PostService postService;
  
      // ìˆ˜ì • í¼ ì œê³µ
      @GetMapping("/{id}/edit")
      public String editForm(@PathVariable Long id, Model model) {
          Post post = postService.getPostById(id);
          model.addAttribute("post", post);
          return "post/form";
      }
  
      // ìˆ˜ì • í¼ ì²˜ë¦¬
      @PostMapping("/{id}/edit")
      public String edit(@PathVariable Long id,
                         @ModelAttribute @Valid Post updatedPost,
                         BindingResult result,
                         RedirectAttributes redirectAttributes) {
  
          if (result.hasErrors()) {
              return "post/form";
          }
  
          postService.updatePost(id, updatedPost);
          redirectAttributes.addFlashAttribute("message", "ê²Œì‹œê¸€ì´ ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤.");
          return "redirect:/posts/" + id;
      }
  }
  ```

  ------

  ### 3. ì„œë¹„ìŠ¤ ê³„ì¸µ

  ```
  @Service
  @RequiredArgsConstructor
  public class PostService {
  
      private final PostRepository postRepository;
  
      @Transactional
      public void updatePost(Long id, Post updatedPost) {
          Post original = postRepository.findById(id)
              .orElseThrow(() -> new EntityNotFoundException("ê²Œì‹œê¸€ì´ ì¡´ì¬í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤."));
  
          original.setTitle(updatedPost.getTitle());
          original.setContent(updatedPost.getContent());
      }
  }
  ```

  â€» ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ì˜ Dirty Checkingì„ í™œìš©í•˜ì—¬ ë³„ë„ì˜ `save()` í˜¸ì¶œ ì—†ì´ë„ íŠ¸ëœì­ì…˜ ì»¤ë°‹ ì‹œ ë³€ê²½ ì‚¬í•­ì´ ë°˜ì˜ëœë‹¤.

  ------

  ### 4. ë·° ì¬ì‚¬ìš© (Thymeleaf)

  ê²Œì‹œê¸€ ì‘ì„±ê³¼ ìˆ˜ì •ì— ë™ì¼í•œ `form.html` í…œí”Œë¦¿ì„ ì¬ì‚¬ìš©í•œë‹¤:

  ```
  <h2 th:text="${post.id} == null ? 'ê²Œì‹œê¸€ ì‘ì„±' : 'ê²Œì‹œê¸€ ìˆ˜ì •'">ê²Œì‹œê¸€ ì‘ì„±</h2>
  
  <form th:action="${post.id} == null ? @{/posts} : @{/posts/{id}/edit(id=${post.id})}"
        th:object="${post}" method="post">
    <div>
      <label for="title">ì œëª©</label>
      <input type="text" th:field="*{title}" id="title" />
      <div th:if="${#fields.hasErrors('title')}" th:errors="*{title}">ì œëª© ì˜¤ë¥˜</div>
    </div>
  
    <div>
      <label for="content">ë‚´ìš©</label>
      <textarea th:field="*{content}" id="content"></textarea>
    </div>
  
    <button type="submit" th:text="${post.id} == null ? 'ì‘ì„±' : 'ìˆ˜ì •'">ì‘ì„±</button>
  </form>
  ```

  ------

  ### 5. ìœ íš¨ì„± ê²€ì¦ ë° ì—ëŸ¬ ë©”ì‹œì§€ ì²˜ë¦¬

  ì‘ì„± ì‹œì™€ ë™ì¼í•˜ê²Œ `@Valid`, `BindingResult`ë¥¼ í™œìš©í•œ ìœ íš¨ì„± ê²€ì¦ì„ ì ìš©í•˜ë©°, ì˜¤ë¥˜ê°€ ë°œìƒí•  ê²½ìš° ì…ë ¥ê°’ì„ ìœ ì§€í•˜ê³  ì ì ˆí•œ ë©”ì‹œì§€ë¥¼ í•¨ê»˜ ì¶œë ¥í•œë‹¤.

  ------

  ### 6. ì¸ì¦ ì‚¬ìš©ì ê²€ì¦ (ì„ íƒ)

  ë¡œê·¸ì¸ëœ ì‚¬ìš©ìì™€ ê²Œì‹œê¸€ì˜ ì‘ì„±ìê°€ ì¼ì¹˜í•˜ëŠ” ê²½ìš°ì—ë§Œ ìˆ˜ì • ê°€ëŠ¥í•˜ë„ë¡ ë‹¤ìŒê³¼ ê°™ì€ ê²€ì¦ì„ ì¶”ê°€í•  ìˆ˜ ìˆë‹¤:

  ```
  if (!original.getAuthor().equals(authenticatedUser.getUsername())) {
      throw new AccessDeniedException("ìˆ˜ì • ê¶Œí•œì´ ì—†ìŠµë‹ˆë‹¤.");
  }
  ```

  ------

  ### ê²°ë¡ 

  ê²Œì‹œê¸€ ìˆ˜ì • ê¸°ëŠ¥ì€ ê²Œì‹œê¸€ ë“±ë¡ê³¼ ìœ ì‚¬í•˜ì§€ë§Œ, **ê¸°ì¡´ ë°ì´í„°ë¥¼ ì¡°íšŒí•˜ê³ , ì´ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ìˆ˜ì •í•˜ì—¬ ë°˜ì˜**í•˜ëŠ” íë¦„ì´ë¯€ë¡œ ë‹¤ìŒì„ ê³ ë ¤í•´ì•¼ í•œë‹¤:

  - `GET`ìœ¼ë¡œ ìˆ˜ì • í¼ ì œê³µ
  - `POST`(ë˜ëŠ” `PUT`)ë¡œ ë³€ê²½ ì‚¬í•­ ë°˜ì˜
  - ìœ íš¨ì„± ê²€ì¦
  - ì¸ì¦ ì‚¬ìš©ì í™•ì¸ (ì„ íƒ)
  - ë·° íŒŒì¼ ì¬ì‚¬ìš©ìœ¼ë¡œ ì½”ë“œ ì¤‘ë³µ ë°©ì§€

  ------

  > âœ… íŒ: ê²Œì‹œê¸€ì˜ ìˆ˜ì • ì´ë ¥ì„ ë³„ë„ í…Œì´ë¸”ë¡œ ê´€ë¦¬í•˜ê±°ë‚˜, "ìµœê·¼ ìˆ˜ì •ì¼" í•„ë“œë¥¼ ì¶”ê°€í•˜ì—¬ ê°€ì‹œì„±ì„ ë†’ì´ëŠ” ê²ƒë„ ì¢‹ì€ ì‹¤ë¬´ ì „ëµì´ë‹¤.

- ## ê²Œì‹œê¸€ ì‚­ì œ

  **(Post Delete â€“ ì•ˆì „í•œ ì‚­ì œ ì²˜ë¦¬ ë° ë¦¬ë””ë ‰ì…˜)**

  ê²Œì‹œê¸€ ì‚­ì œëŠ” ê²Œì‹œíŒì˜ ê¸°ë³¸ ê¸°ëŠ¥ ì¤‘ í•˜ë‚˜ë¡œ, ì‚¬ìš©ìê°€ ë” ì´ìƒ ìœ ì§€í•˜ê³  ì‹¶ì§€ ì•Šì€ ê²Œì‹œê¸€ì„ ì œê±°í•  ìˆ˜ ìˆë„ë¡ í•œë‹¤. ì‚­ì œ ê¸°ëŠ¥ì€ ë°˜ë“œì‹œ **ì•ˆì „ì„±**ê³¼ **ê¶Œí•œ ê²€ì¦**ì„ ê³ ë ¤í•´ì•¼ í•˜ë©°, ì˜ëª»ëœ ìš”ì²­ì„ ë°©ì§€í•˜ê¸° ìœ„í•œ **CSRF ë°©ì§€** ë° **í™•ì¸ ì ˆì°¨**ë¥¼ í¬í•¨í•˜ëŠ” ê²ƒì´ ì¼ë°˜ì ì´ë‹¤.

  ------

  ### 1. ìš”êµ¬ì‚¬í•­

  - ê²Œì‹œê¸€ì„ ID ê¸°ì¤€ìœ¼ë¡œ ì‚­ì œ ê°€ëŠ¥í•´ì•¼ í•¨
  - ì‚­ì œ ìš”ì²­ì€ POST ë°©ì‹ ë˜ëŠ” DELETE ë°©ì‹ ì‚¬ìš©
  - ì‚­ì œ í›„ ê²Œì‹œê¸€ ëª©ë¡ í˜ì´ì§€ë¡œ ë¦¬ë””ë ‰ì…˜
  - ì¸ì¦ëœ ì‚¬ìš©ìë§Œ ì‚­ì œ ê°€ëŠ¥ (ì˜µì…˜)
  - ì‚­ì œ ì „ í™•ì¸ ë©”ì‹œì§€ ë˜ëŠ” íŒì—… í‘œì‹œ ê¶Œì¥

  ------

  ### 2. Controller êµ¬ì„±

  ```
  @Controller
  @RequiredArgsConstructor
  @RequestMapping("/posts")
  public class PostController {
  
      private final PostService postService;
  
      @PostMapping("/{id}/delete")
      public String delete(@PathVariable Long id, RedirectAttributes redirectAttributes) {
          postService.deletePost(id);
          redirectAttributes.addFlashAttribute("message", "ê²Œì‹œê¸€ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.");
          return "redirect:/posts";
      }
  }
  ```

  > `POST` ë°©ì‹ì€ HTML `<form>`ì„ í†µí•´ CSRF ë³´í˜¸ê°€ ê¸°ë³¸ ì ìš©ë˜ë¯€ë¡œ ë³´ì•ˆìƒ ì•ˆì „í•˜ë‹¤. `DELETE` ë°©ì‹ì€ REST APIë‚˜ JavaScriptë¥¼ í†µí•œ Ajax ìš”ì²­ì—ì„œ í™œìš©ëœë‹¤.

  ------

  ### 3. ì„œë¹„ìŠ¤ ê³„ì¸µ

  ```
  @Service
  @RequiredArgsConstructor
  public class PostService {
  
      private final PostRepository postRepository;
  
      @Transactional
      public void deletePost(Long id) {
          Post post = postRepository.findById(id)
              .orElseThrow(() -> new EntityNotFoundException("ê²Œì‹œê¸€ì´ ì¡´ì¬í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤."));
          postRepository.delete(post);
      }
  }
  ```

  ------

  ### 4. Thymeleaf ë·° ì˜ˆì‹œ

  ê²Œì‹œê¸€ ìƒì„¸ í˜ì´ì§€ë‚˜ ëª©ë¡ì—ì„œ ì‚­ì œ ë²„íŠ¼ì„ ì œê³µí•  ìˆ˜ ìˆë‹¤.

  ```
  <form th:action="@{|/posts/${post.id}/delete|}" method="post" onsubmit="return confirm('ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?');">
    <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
    <button type="submit">ì‚­ì œ</button>
  </form>
  ```

  > CSRF í† í°ì€ Spring Securityê°€ ìë™ìœ¼ë¡œ ì œê³µí•œë‹¤. `th:name`ê³¼ `th:value` ì†ì„±ì€ ë³´ì•ˆì„ ìœ„í•´ í•„ìˆ˜ë¡œ í¬í•¨í•´ì•¼ í•œë‹¤.

  ------

  ### 5. ì‚­ì œ ê¶Œí•œ ê²€ì¦ (ì„ íƒ)

  ë¡œê·¸ì¸í•œ ì‚¬ìš©ìì™€ ê²Œì‹œê¸€ ì‘ì„±ìê°€ ì¼ì¹˜í•˜ëŠ”ì§€ ê²€ì¦í•˜ì—¬ ì ‘ê·¼ì„ ì œí•œí•  ìˆ˜ ìˆë‹¤.

  ```
  public void deletePost(Long id, String currentUsername) {
      Post post = postRepository.findById(id)
          .orElseThrow(() -> new EntityNotFoundException("ê²Œì‹œê¸€ì´ ì¡´ì¬í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤."));
  
      if (!post.getAuthor().equals(currentUsername)) {
          throw new AccessDeniedException("ì‚­ì œ ê¶Œí•œì´ ì—†ìŠµë‹ˆë‹¤.");
      }
  
      postRepository.delete(post);
  }
  ```

  ------

  ### 6. ì‚­ì œ í›„ ì‚¬ìš©ì ê²½í—˜ ê°œì„ 

  - ì‚­ì œ í›„ Flash ë©”ì‹œì§€ë¡œ ì‚¬ìš©ìì—ê²Œ í”¼ë“œë°± ì œê³µ
  - ì‹¤ìˆ˜ ë°©ì§€ë¥¼ ìœ„í•œ `confirm()` ì°½ ë˜ëŠ” `SweetAlert2` íŒì—… ì‚¬ìš© ê¶Œì¥
  - ì‚­ì œëœ ê²Œì‹œê¸€ì— ëŒ€í•œ ì ‘ê·¼ì€ `404` ë˜ëŠ” ì‚¬ìš©ì ì •ì˜ ì—ëŸ¬ í˜ì´ì§€ë¡œ ì²˜ë¦¬

  ------

  ### ê²°ë¡ 

  ê²Œì‹œê¸€ ì‚­ì œ ê¸°ëŠ¥ì€ ë‹¨ìˆœí•œ CRUDì˜ ì¼ë¶€ì´ì§€ë§Œ ë³´ì•ˆê³¼ ì‚¬ìš©ì ê²½í—˜ ì¸¡ë©´ì—ì„œ ë‹¤ìŒì„ ì‹ ê²½ ì¨ì•¼ í•œë‹¤:

  - `@Transactional`ë¡œ ì•ˆì „í•œ ì‚­ì œ ì²˜ë¦¬
  - CSRF ë³´í˜¸
  - ì¸ì¦ ë° ê¶Œí•œ í™•ì¸
  - ì‚¬ìš©ìì—ê²Œ ëª…í™•í•œ í”¼ë“œë°± ì œê³µ

  ------

  > âœ… íŒ: ì‹¤ë¬´ì—ì„œëŠ” ë¬¼ë¦¬ì  ì‚­ì œ ëŒ€ì‹  **ë…¼ë¦¬ì  ì‚­ì œ(soft delete)** ì „ëµì„ í™œìš©í•´ ê²Œì‹œê¸€ì„ "ìˆ¨ê¹€ ì²˜ë¦¬"í•˜ê±°ë‚˜ "íœ´ì§€í†µ"ìœ¼ë¡œ ì˜®ê¸°ëŠ” ë°©ì‹ë„ ìì£¼ ì‚¬ìš©ëœë‹¤.
  >  ì˜ˆ: `deleted` í”Œë˜ê·¸ í•„ë“œ ì¶”ê°€ â†’ ì‹¤ì œ ì‚­ì œëŠ” í•˜ì§€ ì•Šê³  ìˆ¨ê¹€ ì²˜ë¦¬.

## ëŒ“ê¸€ ê¸°ëŠ¥

**(Comment CRUD â€“ ê²Œì‹œê¸€ í•˜ìœ„ì— ì¢…ì†ëœ êµ¬ì¡°ë¡œ ëŒ“ê¸€ ë“±ë¡, ìˆ˜ì •, ì‚­ì œ ì²˜ë¦¬)**

ëŒ“ê¸€ì€ ê²Œì‹œê¸€(Post)ê³¼ **1:N ê´€ê³„**ë¥¼ ê°€ì§€ë©°, ê²Œì‹œíŒì˜ ìƒí˜¸ì‘ìš©ì„±ì„ ë†’ì´ëŠ” í•µì‹¬ ìš”ì†Œì´ë‹¤. ëŒ“ê¸€ ê¸°ëŠ¥ì€ ì£¼ë¡œ ê²Œì‹œê¸€ ìƒì„¸ í˜ì´ì§€ ë‚´ì—ì„œ ë“±ë¡/ìˆ˜ì •/ì‚­ì œê°€ ë¹„ë™ê¸° ë˜ëŠ” ë™ê¸° ë°©ì‹ìœ¼ë¡œ ì²˜ë¦¬ëœë‹¤.

------

### 1. ìš”êµ¬ì‚¬í•­

- ê²Œì‹œê¸€ì— ëŒ“ê¸€ì„ ì‘ì„±í•  ìˆ˜ ìˆì–´ì•¼ í•¨
- ê° ëŒ“ê¸€ì€ ê²Œì‹œê¸€ê³¼ ì—°ê²°ë˜ë©°, ì‘ì„±ì/ì‘ì„±ì¼ í¬í•¨
- ëŒ“ê¸€ ë“±ë¡/ìˆ˜ì •/ì‚­ì œ ê¸°ëŠ¥ í¬í•¨
- ì¸ì¦ ì‚¬ìš©ì ê¸°ë°˜ ì²˜ë¦¬ (ì„ íƒ)
- Ajaxë¥¼ í†µí•œ ë¹„ë™ê¸° êµ¬í˜„ë„ ê°€ëŠ¥ (í›„ì† í™•ì¥)

------

### 2. Entity ì„¤ê³„

```
@Entity
public class Comment {

    @Id @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;

    @ManyToOne(fetch = FetchType.LAZY)
    private Post post;

    @NotBlank(message = "ëŒ“ê¸€ ë‚´ìš©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.")
    private String content;

    private String author;

    private LocalDateTime createdAt;

    @PrePersist
    public void createdAt() {
        this.createdAt = LocalDateTime.now();
    }

    // Getter / Setter ìƒëµ
}
```

------

### 3. Repository

```
public interface CommentRepository extends JpaRepository<Comment, Long> {
    List<Comment> findByPostIdOrderByCreatedAtAsc(Long postId);
}
```

------

### 4. Controller

```
@Controller
@RequiredArgsConstructor
@RequestMapping("/comments")
public class CommentController {

    private final CommentService commentService;

    @PostMapping
    public String create(@ModelAttribute @Valid Comment comment,
                         BindingResult result,
                         RedirectAttributes redirectAttributes) {
        if (result.hasErrors()) {
            redirectAttributes.addFlashAttribute("error", "ëŒ“ê¸€ ë‚´ìš©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.");
            return "redirect:/posts/" + comment.getPost().getId();
        }

        commentService.save(comment);
        return "redirect:/posts/" + comment.getPost().getId();
    }

    @PostMapping("/{id}/delete")
    public String delete(@PathVariable Long id,
                         @RequestParam Long postId,
                         RedirectAttributes redirectAttributes) {
        commentService.delete(id);
        redirectAttributes.addFlashAttribute("message", "ëŒ“ê¸€ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.");
        return "redirect:/posts/" + postId;
    }
}
```

------

### 5. Service

```
@Service
@RequiredArgsConstructor
public class CommentService {

    private final CommentRepository commentRepository;

    @Transactional
    public Comment save(Comment comment) {
        return commentRepository.save(comment);
    }

    @Transactional
    public void delete(Long id) {
        commentRepository.deleteById(id);
    }

    @Transactional(readOnly = true)
    public List<Comment> findByPost(Long postId) {
        return commentRepository.findByPostIdOrderByCreatedAtAsc(postId);
    }
}
```

------

### 6. ê²Œì‹œê¸€ ìƒì„¸ í˜ì´ì§€ì— ëŒ“ê¸€ ì¶œë ¥

```
<h4>ëŒ“ê¸€</h4>

<ul>
  <li th:each="comment : ${comments}">
    <p><strong th:text="${comment.author}">ì‘ì„±ì</strong></p>
    <p th:text="${comment.content}">ëŒ“ê¸€ ë‚´ìš©</p>

    <form th:action="@{|/comments/${comment.id}/delete|}" method="post">
      <input type="hidden" name="postId" th:value="${post.id}" />
      <button type="submit">ì‚­ì œ</button>
    </form>
  </li>
</ul>
```

------

### 7. ëŒ“ê¸€ ë“±ë¡ í¼

```
<form th:action="@{/comments}" method="post" th:object="${newComment}">
  <input type="hidden" th:field="*{post.id}" />
  <input type="text" th:field="*{content}" placeholder="ëŒ“ê¸€ ì…ë ¥" />
  <button type="submit">ë“±ë¡</button>
</form>
```

> `Model`ì—ì„œ `newComment` ê°ì²´ë¥¼ `new Comment()`ë¡œ ì´ˆê¸°í™”í•´ì„œ ì „ë‹¬

------

### 8. ê²Œì‹œê¸€ ìƒì„¸ Controllerì— ëŒ“ê¸€ í¬í•¨

```
@GetMapping("/{id}")
public String detail(@PathVariable Long id, Model model) {
    Post post = postService.getPostById(id);
    List<Comment> comments = commentService.findByPost(id);

    model.addAttribute("post", post);
    model.addAttribute("comments", comments);
    model.addAttribute("newComment", new Comment());
    return "post/detail";
}
```

------

### 9. í™•ì¥ ê³ ë ¤ ì‚¬í•­

- **ë¹„ë™ê¸° ëŒ“ê¸€ ì²˜ë¦¬ (Ajax, Fetch API)**
- **ëŒ€ëŒ“ê¸€(ê³„ì¸µí˜• ëŒ“ê¸€) êµ¬í˜„**
- **ì‘ì„±ì ì¸ì¦ ë° ì‚­ì œ ê¶Œí•œ ê²€ì¦**
- **ëŒ“ê¸€ ì‹ ê³ , ì¢‹ì•„ìš”, ì •ë ¬ ë“± ë¶€ê°€ê¸°ëŠ¥**

------

### ê²°ë¡ 

ëŒ“ê¸€ ê¸°ëŠ¥ì€ ê²Œì‹œíŒì—ì„œ ì‚¬ìš©ìì˜ ì°¸ì—¬ë¥¼ ì´ëŒì–´ë‚´ëŠ” í•„ìˆ˜ ìš”ì†Œë¡œ, ë‹¤ìŒì„ ê³ ë ¤í•˜ì—¬ ì„¤ê³„í•´ì•¼ í•œë‹¤:

- ê²Œì‹œê¸€ê³¼ì˜ ê´€ê³„ (`@ManyToOne`)
- ì…ë ¥ ìœ íš¨ì„± ê²€ì¦
- ê¶Œí•œ ë° ì¸ì¦ ì •ì±…
- ì ì ˆí•œ ì‚¬ìš©ì í”¼ë“œë°±
- í™•ì¥ ê°€ëŠ¥í•œ êµ¬ì¡° ì„¤ê³„

------

> âœ… íŒ: ì‹¤ë¬´ì—ì„œëŠ” ëŒ“ê¸€ ìˆ˜ë¥¼ ê²Œì‹œê¸€ì— ìºì‹±í•˜ê±°ë‚˜, ëŒ“ê¸€ ì•Œë¦¼ ê¸°ëŠ¥ê³¼ ì—°ë™í•˜ì—¬ UXë¥¼ í–¥ìƒì‹œí‚¬ ìˆ˜ ìˆë‹¤.

- ## ëŒ“ê¸€ ë“±ë¡

  **(Comment Create â€“ ìœ íš¨ì„± ê²€ì¦, ê²Œì‹œê¸€ ì—°ê´€, ì‚¬ìš©ì í”¼ë“œë°± ì²˜ë¦¬ ì¤‘ì‹¬)**

  ëŒ“ê¸€ ë“±ë¡ ê¸°ëŠ¥ì€ ì‚¬ìš©ìê°€ ê²Œì‹œê¸€(Post)ì— ëŒ€í•œ ì˜ê²¬ì„ ë‚¨ê¸¸ ìˆ˜ ìˆë„ë¡ í•˜ëŠ” ì£¼ìš” ì¸í„°ë™ì…˜ ì¤‘ í•˜ë‚˜ë¡œ, ë‹¨ì¼ ì…ë ¥ í•„ë“œë¥¼ í†µí•´ ì…ë ¥ê°’ì„ ë°›ì•„ ì„œë²„ì— ì €ì¥í•˜ê³ , ë“±ë¡ í›„ ì›ë˜ í˜ì´ì§€ë¡œ ë¦¬ë””ë ‰ì…˜í•˜ëŠ” ë°©ì‹ì´ ì¼ë°˜ì ì´ë‹¤.

  ------

  ### 1. ìš”êµ¬ì‚¬í•­

  - ëŒ“ê¸€ì€ íŠ¹ì • ê²Œì‹œê¸€(Post)ì— ì¢…ì†ëœë‹¤ (`@ManyToOne` ê´€ê³„)
  - ëŒ“ê¸€ì€ ë‚´ìš©(content)ì„ ë°˜ë“œì‹œ í¬í•¨í•´ì•¼ í•˜ë©°, ì‘ì„±ì ì •ë³´ì™€ í•¨ê»˜ ì €ì¥ëœë‹¤
  - ë“±ë¡ ì„±ê³µ í›„ ê²Œì‹œê¸€ ìƒì„¸ í˜ì´ì§€ë¡œ ë¦¬ë””ë ‰ì…˜ëœë‹¤
  - ìœ íš¨ì„± ê²€ì¦ ì‹¤íŒ¨ ì‹œ ë©”ì‹œì§€ ì¶œë ¥ê³¼ ì…ë ¥ê°’ ìœ ì§€ê°€ í•„ìš”í•˜ë‹¤

  ------

  ### 2. ëŒ“ê¸€ Entity

  ```
  @Entity
  public class Comment {
  
      @Id @GeneratedValue(strategy = GenerationType.IDENTITY)
      private Long id;
  
      @ManyToOne(fetch = FetchType.LAZY)
      private Post post;
  
      @NotBlank(message = "ëŒ“ê¸€ ë‚´ìš©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.")
      private String content;
  
      private String author;
  
      private LocalDateTime createdAt;
  
      @PrePersist
      protected void prePersist() {
          this.createdAt = LocalDateTime.now();
      }
  
      // getter/setter ìƒëµ
  }
  ```

  ------

  ### 3. ëŒ“ê¸€ ë“±ë¡ Controller

  ```
  @Controller
  @RequiredArgsConstructor
  @RequestMapping("/comments")
  public class CommentController {
  
      private final CommentService commentService;
  
      @PostMapping
      public String create(@ModelAttribute("comment") @Valid Comment comment,
                           BindingResult result,
                           RedirectAttributes redirectAttributes) {
  
          if (result.hasErrors()) {
              redirectAttributes.addFlashAttribute("errorMessage", "ëŒ“ê¸€ ë‚´ìš©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.");
              return "redirect:/posts/" + comment.getPost().getId();
          }
  
          commentService.save(comment);
          redirectAttributes.addFlashAttribute("message", "ëŒ“ê¸€ì´ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤.");
          return "redirect:/posts/" + comment.getPost().getId();
      }
  }
  ```

  > ğŸ’¡ ëŒ“ê¸€ì€ ê²Œì‹œê¸€ ìƒì„¸ í˜ì´ì§€ ë‚´ì—ì„œ ì‘ì„±ë˜ë¯€ë¡œ, ë“±ë¡ ì‹¤íŒ¨ ì‹œì—ë„ ê°™ì€ í˜ì´ì§€ë¡œ ë¦¬ë””ë ‰ì…˜í•´ì•¼ í•œë‹¤.

  ------

  ### 4. ëŒ“ê¸€ ë“±ë¡ Service

  ```
  @Service
  @RequiredArgsConstructor
  public class CommentService {
  
      private final CommentRepository commentRepository;
  
      @Transactional
      public void save(Comment comment) {
          commentRepository.save(comment);
      }
  }
  ```

  ------

  ### 5. ë·°(View)ì—ì„œ ëŒ“ê¸€ ë“±ë¡ í¼

  ```
  <form th:action="@{/comments}" method="post" th:object="${newComment}">
    <input type="hidden" th:field="*{post.id}" />
    <input type="text" th:field="*{content}" placeholder="ëŒ“ê¸€ì„ ì…ë ¥í•˜ì„¸ìš”" required />
    <button type="submit">ëŒ“ê¸€ ë“±ë¡</button>
  </form>
  ```

  - `newComment`ëŠ” `Controller`ì—ì„œ `model.addAttribute("newComment", new Comment())`ë¡œ ì „ë‹¬
  - `post.id`ëŠ” ìˆ¨ê¹€ í•„ë“œë¡œ ê²Œì‹œê¸€ IDë¥¼ ì„œë²„ì— ì „ë‹¬

  ------

  ### 6. ê²Œì‹œê¸€ ìƒì„¸ í˜ì´ì§€ Controllerì— `newComment` ì¶”ê°€

  ```
  @GetMapping("/{id}")
  public String detail(@PathVariable Long id, Model model) {
      Post post = postService.getPostById(id);
      List<Comment> comments = commentService.findByPost(id);
  
      model.addAttribute("post", post);
      model.addAttribute("comments", comments);
      model.addAttribute("newComment", new Comment());
      return "post/detail";
  }
  ```

  ------

  ### 7. ìœ íš¨ì„± ì‹¤íŒ¨ ì‹œ ì‚¬ìš©ì í”¼ë“œë°±

  - `BindingResult`ë¥¼ í†µí•´ ì„œë²„ì—ì„œ ê²€ì¦ ì‹¤íŒ¨ë¥¼ ê°ì§€í•˜ê³  Flash Attributeë¥¼ ì‚¬ìš©í•´ ë©”ì‹œì§€ë¥¼ ì „ë‹¬
  - Viewì—ì„œ ì¡°ê±´ë¶€ë¡œ ì¶œë ¥

  ```
  <div th:if="${errorMessage}" class="alert alert-danger" th:text="${errorMessage}"></div>
  ```

  ------

  ### ê²°ë¡ 

  ëŒ“ê¸€ ë“±ë¡ì€ ê²Œì‹œê¸€ ìƒì„¸ í˜ì´ì§€ì˜ ë™ì‘ íë¦„ê³¼ ê°•í•˜ê²Œ ì—°ê²°ë˜ì–´ ìˆìœ¼ë©°, ë‹¤ìŒì˜ ìš”ì†Œë“¤ì„ ì¶©ì‹¤íˆ ë°˜ì˜í•˜ëŠ” ê²ƒì´ ì¤‘ìš”í•˜ë‹¤:

  - `@Valid`ë¥¼ í†µí•œ ìœ íš¨ì„± ê²€ì¦
  - `@ManyToOne` ê´€ê³„ë¡œ ê²Œì‹œê¸€ê³¼ ì—°ê²°
  - ë¦¬ë””ë ‰ì…˜ í›„ ì‚¬ìš©ì ë©”ì‹œì§€ ì²˜ë¦¬
  - ìˆ¨ê¹€ í•„ë“œë¥¼ í†µí•œ ê²Œì‹œê¸€ ID ì „ë‹¬

  ------

  > âœ… íŒ: ëŒ“ê¸€ì„ ì…ë ¥í•œ ì‚¬ìš©ì ì •ë³´ëŠ” ë¡œê·¸ì¸ ì‚¬ìš©ì ì„¸ì…˜ì´ë‚˜ `SecurityContextHolder`ë¥¼ í™œìš©í•´ ìë™ ì‚½ì…í•˜ëŠ” ê²ƒì´ ì¼ë°˜ì ì´ë‹¤. `comment.setAuthor(currentUser.getUsername())` í˜•íƒœë¡œ ì²˜ë¦¬í•œë‹¤.

- ## ëŒ“ê¸€ ìˆ˜ì •

  **(Comment Update â€“ ê¶Œí•œ ê²€ì¦, ë°”ì¸ë”© ì²˜ë¦¬, ë¦¬ë””ë ‰ì…˜ ê¸°ë°˜ ì—…ë°ì´íŠ¸ ì²˜ë¦¬)**

  ëŒ“ê¸€ ìˆ˜ì • ê¸°ëŠ¥ì€ ì‚¬ìš©ìê°€ ê¸°ì¡´ì— ì‘ì„±í•œ ëŒ“ê¸€ì„ ë‹¤ì‹œ í¸ì§‘í•  ìˆ˜ ìˆë„ë¡ í•˜ëŠ” ì¸í„°í˜ì´ìŠ¤ë¥¼ ì œê³µí•˜ë©°, ì¼ë°˜ì ìœ¼ë¡œ **ëŒ“ê¸€ ìƒì„¸ ë³´ê¸° ë˜ëŠ” ê²Œì‹œê¸€ ìƒì„¸ í˜ì´ì§€ ë‚´ì—ì„œ ì§ì ‘ ìˆ˜ì •** ê°€ëŠ¥í•œ ë°©ì‹ìœ¼ë¡œ êµ¬ì„±ëœë‹¤.

  ------

  ### 1. ìš”êµ¬ì‚¬í•­

  - íŠ¹ì • ëŒ“ê¸€ì„ ìˆ˜ì •í•  ìˆ˜ ìˆì–´ì•¼ í•¨
  - ìˆ˜ì •ì€ ë³¸ì¸ ëŒ“ê¸€ë§Œ ê°€ëŠ¥í•˜ë„ë¡ ê¶Œí•œ í™•ì¸ì´ í•„ìš”
  - ìœ íš¨ì„± ê²€ì¦ ì ìš© (`@Valid`)
  - ìˆ˜ì • ì™„ë£Œ í›„ ê²Œì‹œê¸€ ìƒì„¸ í˜ì´ì§€ë¡œ ë¦¬ë””ë ‰ì…˜
  - ìˆ˜ì • í¼ì€ ë³„ë„ í˜ì´ì§€ ë˜ëŠ” ëª¨ë‹¬/ì¸ë¼ì¸ í¸ì§‘ ê°€ëŠ¥

  ------

  ### 2. Controller

  ```
  @Controller
  @RequiredArgsConstructor
  @RequestMapping("/comments")
  public class CommentController {
  
      private final CommentService commentService;
  
      @GetMapping("/{id}/edit")
      public String editForm(@PathVariable Long id, Model model) {
          Comment comment = commentService.getById(id);
          model.addAttribute("comment", comment);
          return "comment/edit";
      }
  
      @PostMapping("/{id}/edit")
      public String update(@PathVariable Long id,
                           @ModelAttribute("comment") @Valid Comment updatedComment,
                           BindingResult result,
                           RedirectAttributes redirectAttributes) {
  
          if (result.hasErrors()) {
              return "comment/edit";
          }
  
          commentService.update(id, updatedComment.getContent());
          redirectAttributes.addFlashAttribute("message", "ëŒ“ê¸€ì´ ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤.");
          return "redirect:/posts/" + updatedComment.getPost().getId();
      }
  }
  ```

  ------

  ### 3. Service

  ```
  @Service
  @RequiredArgsConstructor
  public class CommentService {
  
      private final CommentRepository commentRepository;
  
      @Transactional
      public void update(Long commentId, String newContent) {
          Comment comment = commentRepository.findById(commentId)
              .orElseThrow(() -> new EntityNotFoundException("ëŒ“ê¸€ì´ ì¡´ì¬í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤."));
          comment.setContent(newContent);
      }
  
      @Transactional(readOnly = true)
      public Comment getById(Long id) {
          return commentRepository.findById(id)
              .orElseThrow(() -> new EntityNotFoundException("ëŒ“ê¸€ì´ ì¡´ì¬í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤."));
      }
  }
  ```

  ------

  ### 4. ìˆ˜ì • í¼ (edit.html)

  ```
  <h2>ëŒ“ê¸€ ìˆ˜ì •</h2>
  
  <form th:action="@{|/comments/${comment.id}/edit|}" method="post" th:object="${comment}">
    <input type="hidden" th:field="*{id}" />
    <input type="hidden" th:field="*{post.id}" />
    
    <label>ë‚´ìš©</label>
    <input type="text" th:field="*{content}" required />
    
    <button type="submit">ìˆ˜ì • ì™„ë£Œ</button>
  </form>
  ```

  > `post.id`ëŠ” ìˆ˜ì • ì™„ë£Œ í›„ ë¦¬ë””ë ‰ì…˜ ê²½ë¡œ êµ¬ì„±ì— í•„ìš”í•˜ë‹¤. `comment.getPost().getId()`ë¥¼ ì‚¬ìš©í•˜ì—¬ ì „ë‹¬í•œë‹¤.

  ------

  ### 5. ê¶Œí•œ ê²€ì¦ ë¡œì§ ì¶”ê°€ (ì„ íƒ)

  ```
  if (!comment.getAuthor().equals(currentUser.getUsername())) {
      throw new AccessDeniedException("ìˆ˜ì • ê¶Œí•œì´ ì—†ìŠµë‹ˆë‹¤.");
  }
  ```

  ------

  ### 6. ìœ íš¨ì„± ê²€ì¦ ì‹¤íŒ¨ ë©”ì‹œì§€ í‘œì‹œ

  ```
  <div th:if="${#fields.hasErrors('content')}" class="error">
      <p th:errors="*{content}">ë‚´ìš© ì˜¤ë¥˜</p>
  </div>
  ```

  ------

  ### 7. í™•ì¥ ê°€ëŠ¥ì„±

  - **Ajax ê¸°ë°˜ ì¸ë¼ì¸ ìˆ˜ì •**: ëŒ“ê¸€ ë¦¬ìŠ¤íŠ¸ ë‚´ì—ì„œ ì§ì ‘ ìˆ˜ì • ê°€ëŠ¥
  - **Modal ì°½ ê¸°ë°˜ ìˆ˜ì • í¼**: ì‚¬ìš©ì ê²½í—˜ í–¥ìƒ
  - **ìˆ˜ì • ì´ë ¥ ì €ì¥**: ë³€ê²½ ì´ë ¥ ê´€ë¦¬ í•„ìš” ì‹œ

  ------

  ### ê²°ë¡ 

  ëŒ“ê¸€ ìˆ˜ì •ì€ ì‚¬ìš©ì ì¹œí™”ì ì¸ ì¸í„°í˜ì´ìŠ¤ ì œê³µê³¼ í•¨ê»˜ ë°ì´í„°ì˜ ë¬´ê²°ì„±ê³¼ ê¶Œí•œ ê²€ì¦ì„ ë™ì‹œì— ê³ ë ¤í•´ì•¼ í•˜ë©°, ë‹¤ìŒ í•­ëª©ì„ ì¶©ì¡±í•˜ëŠ” ê²ƒì´ ì´ìƒì ì´ë‹¤:

  - ìœ íš¨ì„± ê²€ì¦ ë° ë°”ì¸ë”© ì²˜ë¦¬
  - ë³¸ì¸ ì—¬ë¶€ ê²€ì¦
  - ìˆ˜ì • ì™„ë£Œ í›„ ì‚¬ìš©ì í”¼ë“œë°± ì œê³µ
  - ì›ë˜ ê²Œì‹œê¸€ë¡œ ë¦¬ë””ë ‰ì…˜

  ------

  > âœ… íŒ: ëŒ“ê¸€ ìˆ˜ì •ì¼(`modifiedAt`)ì„ ë³„ë„ë¡œ ê¸°ë¡í•´ `"ìˆ˜ì •ë¨"` í‘œì‹œë¥¼ ì¶”ê°€í•  ìˆ˜ ìˆë‹¤.
  >  ì˜ˆ: `@PreUpdate`ë¥¼ ì´ìš©í•œ ìë™ íƒ€ì„ìŠ¤íƒ¬í”„ ê°±ì‹ .

- ## ëŒ“ê¸€ ì‚­ì œ

  **(Comment Delete â€“ ë³¸ì¸ í™•ì¸, ì•ˆì „í•œ ì‚­ì œ ì²˜ë¦¬, ë¦¬ë””ë ‰ì…˜ ê¸°ë°˜ ì‘ë‹µ)**

  ëŒ“ê¸€ ì‚­ì œ ê¸°ëŠ¥ì€ ì‚¬ìš©ìê°€ ìì‹ ì´ ì‘ì„±í•œ ëŒ“ê¸€ì„ ì‚­ì œí•  ìˆ˜ ìˆë„ë¡ í•˜ë©°, ì¼ë°˜ì ìœ¼ë¡œ **POST ë°©ì‹ì˜ í¼ ì œì¶œ**ì„ í†µí•´ ì„œë²„ë¡œ ì‚­ì œ ìš”ì²­ì„ ì „ë‹¬í•œë‹¤. ì‚­ì œ ì™„ë£Œ í›„ì—ëŠ” ê´€ë ¨ ê²Œì‹œê¸€ ìƒì„¸ í˜ì´ì§€ë¡œ ë¦¬ë””ë ‰ì…˜ëœë‹¤.

  ------

  ## 1. ìš”êµ¬ì‚¬í•­

  - ì‚¬ìš©ìê°€ ë³¸ì¸ì˜ ëŒ“ê¸€ì„ ì‚­ì œí•  ìˆ˜ ìˆì–´ì•¼ í•¨
  - ì‚­ì œëŠ” CSRF ë³´í˜¸ë¥¼ ìœ„í•´ `POST` ë˜ëŠ” `DELETE` ë°©ì‹ìœ¼ë¡œ ìˆ˜í–‰
  - ì‚­ì œ ì™„ë£Œ í›„ ì›ë˜ ê²Œì‹œê¸€ ìƒì„¸ í˜ì´ì§€ë¡œ ë¦¬ë””ë ‰ì…˜
  - ì‚­ì œ ì „ ì‚¬ìš©ì í™•ì¸(íŒì—… ë˜ëŠ” ëª¨ë‹¬)ì€ UIì—ì„œ ì²˜ë¦¬ ê°€ëŠ¥

  ------

  ## 2. Controller

  ```
  @Controller
  @RequiredArgsConstructor
  @RequestMapping("/comments")
  public class CommentController {
  
      private final CommentService commentService;
  
      @PostMapping("/{id}/delete")
      public String delete(@PathVariable Long id,
                           @RequestParam("postId") Long postId,
                           RedirectAttributes redirectAttributes) {
  
          commentService.deleteById(id);
          redirectAttributes.addFlashAttribute("message", "ëŒ“ê¸€ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.");
          return "redirect:/posts/" + postId;
      }
  }
  ```

  > `postId`ëŠ” ë¦¬ë””ë ‰ì…˜ ê²½ë¡œë¥¼ ìœ„í•´ ë³„ë„ë¡œ ì „ë‹¬ë°›ëŠ”ë‹¤.

  ------

  ## 3. Service

  ```
  @Service
  @RequiredArgsConstructor
  public class CommentService {
  
      private final CommentRepository commentRepository;
  
      @Transactional
      public void deleteById(Long id) {
          Comment comment = commentRepository.findById(id)
              .orElseThrow(() -> new EntityNotFoundException("ëŒ“ê¸€ì´ ì¡´ì¬í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤."));
          commentRepository.delete(comment);
      }
  }
  ```

  ------

  ## 4. View ë‚´ ì‚­ì œ í¼

  ```
  <form th:action="@{|/comments/${comment.id}/delete|}" method="post" onsubmit="return confirm('ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?');">
    <input type="hidden" name="postId" th:value="${post.id}" />
    <button type="submit" class="btn btn-sm btn-danger">ì‚­ì œ</button>
  </form>
  ```

  - `onsubmit="return confirm(...)"`: ë¸Œë¼ìš°ì € ë‚´ í™•ì¸ íŒì—…
  - ì„œë²„ì— `POST` ë°©ì‹ìœ¼ë¡œ ìš”ì²­í•˜ë©°, CSRF í† í°ì€ ìë™ í¬í•¨ (`th:action` ì´ìš© ì‹œ)

  ------

  ## 5. ì¸ì¦ëœ ì‚¬ìš©ì í™•ì¸ (ì„ íƒ)

  ```
  if (!comment.getAuthor().equals(currentUser.getUsername())) {
      throw new AccessDeniedException("ì‚­ì œ ê¶Œí•œì´ ì—†ìŠµë‹ˆë‹¤.");
  }
  ```

  ------

  ## 6. í™•ì¥ ê³ ë ¤ ì‚¬í•­

  - ëŒ“ê¸€ ì‚­ì œ ì‹œ **ë…¼ë¦¬ ì‚­ì œ ì²˜ë¦¬** ì ìš© ê°€ëŠ¥ (`deleted=true` í”Œë˜ê·¸)
  - **Soft Delete ì²˜ë¦¬** ì‹œ Hibernate í•„í„°, ì¡°ê±´ë¶€ ì¿¼ë¦¬ ì¡°í•© í•„ìš”
  - ê´€ë¦¬ì ê¶Œí•œì„ í†µí•œ ì „ì²´ ëŒ“ê¸€ ì‚­ì œ ê¸°ëŠ¥ ì œê³µ ê°€ëŠ¥

  ------

  ## 7. ê²°ê³¼ ë©”ì‹œì§€ ì¶œë ¥ (ìƒì„¸ í˜ì´ì§€ì—ì„œ)

  ```
  <div th:if="${message}" class="alert alert-success" th:text="${message}"></div>
  ```

  ------

  ## ê²°ë¡ 

  ëŒ“ê¸€ ì‚­ì œ ê¸°ëŠ¥ì€ ì‚¬ìš©ì ê¶Œí•œ, ë¦¬ë””ë ‰ì…˜ íë¦„, ì•ˆì „í•œ ìš”ì²­ ì²˜ë¦¬ë¥¼ ê³ ë ¤í•˜ì—¬ êµ¬ì„±í•´ì•¼ í•˜ë©°, ë‹¤ìŒì˜ íŠ¹ì„±ì„ ê°–ëŠ”ë‹¤:

  - `POST` ë°©ì‹ìœ¼ë¡œ ìš”ì²­ ì²˜ë¦¬ (CSRF ë³´í˜¸)
  - ê²Œì‹œê¸€ IDë¥¼ í•¨ê»˜ ì „ë‹¬í•˜ì—¬ ì‚­ì œ í›„ ë¦¬ë””ë ‰ì…˜ ê²½ë¡œ ìœ ì§€
  - ì‚¬ìš©ì í”¼ë“œë°± ë©”ì‹œì§€ ì œê³µ
  - ê¶Œí•œ í™•ì¸ í¬í•¨ ì‹œ ë³´ì•ˆì„± í–¥ìƒ

  ------

  > âœ… íŒ: ëŒ“ê¸€ ìˆ˜ ê°ì†Œ, ì•Œë¦¼ íšŒìˆ˜ ë“± ì‚­ì œì— ë”°ë¥¸ ë¶€ìˆ˜ ë¡œì§ì€ ì„œë¹„ìŠ¤ ê³„ì¸µì—ì„œ ì´ë²¤íŠ¸ ê¸°ë°˜ ì²˜ë¦¬ë¡œ ë¶„ë¦¬í•˜ëŠ” ê²ƒì´ ì¢‹ë‹¤.

## ê²Œì‹œê¸€ ì¡°íšŒìˆ˜ ì¦ê°€ ì²˜ë¦¬

## ê²Œì‹œê¸€ í˜ì´ì§• ì²˜ë¦¬

## ê²Œì‹œê¸€ ê²€ìƒ‰ ê¸°ëŠ¥ (ì œëª©, ë‚´ìš©, ì‘ì„±ì ê¸°ë°˜)

## ê²Œì‹œê¸€ ì •ë ¬ ê¸°ëŠ¥ (ìµœì‹ ìˆœ, ì¡°íšŒìˆœ ë“±)

## ê²Œì‹œê¸€ ì²¨ë¶€íŒŒì¼ ì—…ë¡œë“œ/ë‹¤ìš´ë¡œë“œ

## ì²¨ë¶€íŒŒì¼ ì„œë²„ ì €ì¥ ì „ëµ (íŒŒì¼ì‹œìŠ¤í…œ / DB BLOB)

## ê²Œì‹œê¸€ ì¢‹ì•„ìš” ê¸°ëŠ¥ êµ¬í˜„ (Ajax ê¸°ë°˜)

