# 5. ë°ì´í„° ì²˜ë¦¬ ë° JPA ì—°ë™

## Spring Data JPA ê¸°ì´ˆ

Spring Data JPAëŠ” **Springê³¼ JPA(Java Persistence API)**ë¥¼ ì‰½ê²Œ ì—°ë™í•˜ì—¬
 ë°ì´í„°ë² ì´ìŠ¤ ì ‘ê·¼ì„ ìë™í™”í•˜ê³ , ë°˜ë³µì ì¸ CRUD ì½”ë“œë¥¼ ì œê±°í•´ì£¼ëŠ” **ì¶”ìƒí™” ê³„ì¸µ í”„ë ˆì„ì›Œí¬**ë‹¤.
 ì¦‰, **JPAë¥¼ ë” ì‰½ê³  ë¹ ë¥´ê²Œ ì‚¬ìš©í•˜ëŠ” Springì˜ í‘œì¤€ ë°©ì‹**ì´ë‹¤.

------

### 1. Spring Data JPAë€?

> **Spring + JPA + Repository íŒ¨í„´**ì„ ê²°í•©í•œ ORM ë°ì´í„° ì ‘ê·¼ ê¸°ìˆ 

- ì¸í„°í˜ì´ìŠ¤ë§Œ ì •ì˜í•˜ë©´ Springì´ êµ¬í˜„ì²´ë¥¼ ìë™ ìƒì„±
- ë°˜ë³µì ì¸ SQL ì‘ì„± ì—†ì´ë„ CRUD, í˜ì´ì§•, ì •ë ¬, ì¿¼ë¦¬ ë©”ì„œë“œ ê°€ëŠ¥
- `Hibernate`, `EclipseLink` ë“±ì˜ JPA êµ¬í˜„ì²´ ìœ„ì—ì„œ ë™ì‘

------

### 2. ê¸°ë³¸ êµ¬ì„± ìš”ì†Œ

| êµ¬ì„± ìš”ì†Œ         | ì„¤ëª…                                                  |
| ----------------- | ----------------------------------------------------- |
| `Entity`          | í…Œì´ë¸”ê³¼ ë§¤í•‘ë˜ëŠ” í´ë˜ìŠ¤ (`@Entity`)                  |
| `Repository`      | ë°ì´í„° ì ‘ê·¼ ê³„ì¸µ ì¸í„°í˜ì´ìŠ¤ (`extends JpaRepository`) |
| `Service`         | ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ ê³„ì¸µ, íŠ¸ëœì­ì…˜ ê´€ë¦¬                     |
| `@Transactional`  | ë°ì´í„° ë³€ê²½ ì‹œ íŠ¸ëœì­ì…˜ ì ìš©                          |
| `application.yml` | DB ì—°ê²° ì„¤ì •, JPA ì„¤ì •                                |

------

### 3. ì˜ì¡´ì„± ì„¤ì •

#### Gradle

```
dependencies {
    implementation 'org.springframework.boot:spring-boot-starter-data-jpa'
    runtimeOnly 'com.h2database:h2' // or MySQL, PostgreSQL
}
```

------

### 4. application.yml ì„¤ì • ì˜ˆì‹œ

```
spring:
  datasource:
    url: jdbc:h2:mem:testdb
    driver-class-name: org.h2.Driver
    username: sa
    password:
  jpa:
    hibernate:
      ddl-auto: update  # create, validate, none, update ë“±
    show-sql: true
    properties:
      hibernate:
        format_sql: true
```

------

### 5. Entity í´ë˜ìŠ¤ ì •ì˜

```
@Entity
public class Member {

    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;

    private String name;
    private String email;

    // ìƒì„±ì, Getter/Setter ìƒëµ
}
```

- `@Entity`: í…Œì´ë¸”ê³¼ ë§¤í•‘
- `@Id`: ê¸°ë³¸ í‚¤
- `@GeneratedValue`: ìë™ ì¦ê°€ ì „ëµ

------

### 6. Repository ì¸í„°í˜ì´ìŠ¤ ì •ì˜

```
public interface MemberRepository extends JpaRepository<Member, Long> {
    // ê¸°ë³¸ ì œê³µ: save, findById, findAll, delete ë“±
}
```

- Spring Data JPAëŠ” ì´ ì¸í„°í˜ì´ìŠ¤ì˜ **êµ¬í˜„ì²´ë¥¼ ìë™ ìƒì„±**í•´ì¤€ë‹¤
- `JpaRepository<T, ID>`ë¥¼ ìƒì†í•˜ë©´ CRUD ê¸°ë³¸ ë©”ì„œë“œë¥¼ ëª¨ë‘ ìƒì†ë°›ìŒ

------

### 7. ì‚¬ìš© ì˜ˆì‹œ

#### 1) ì„œë¹„ìŠ¤ ê³„ì¸µ

```
@Service
@RequiredArgsConstructor
public class MemberService {

    private final MemberRepository memberRepository;

    public Member save(String name, String email) {
        return memberRepository.save(new Member(name, email));
    }

    public List<Member> findAll() {
        return memberRepository.findAll();
    }
}
```

------

### 8. ì¿¼ë¦¬ ë©”ì„œë“œ (Method ì´ë¦„ ê¸°ë°˜ ìë™ ì¿¼ë¦¬ ìƒì„±)

```
public interface MemberRepository extends JpaRepository<Member, Long> {
    List<Member> findByName(String name);
    boolean existsByEmail(String email);
    List<Member> findByNameContaining(String keyword);
}
```

Springì€ ë©”ì„œë“œ ì´ë¦„ì„ ë¶„ì„í•˜ì—¬ JPQLì„ ìë™ ìƒì„±í•œë‹¤.

------

### 9. í˜ì´ì§• & ì •ë ¬

```
Page<Member> findAll(Pageable pageable);
```

ì‚¬ìš© ì˜ˆ:

```
Pageable pageable = PageRequest.of(0, 10, Sort.by("name").descending());
Page<Member> members = memberRepository.findAll(pageable);
```

------

### 10. íŠ¸ëœì­ì…˜ ì²˜ë¦¬

- ì½ê¸° ì „ìš©: `@Transactional(readOnly = true)`
- ë°ì´í„° ë³€ê²½: `@Transactional`

```
@Transactional
public void registerMember(MemberDto dto) {
    Member member = new Member(dto.getName(), dto.getEmail());
    memberRepository.save(member);
}
```

------

### 11. ì •ë¦¬

| í•­ëª©              | ì„¤ëª…                              |
| ----------------- | --------------------------------- |
| `@Entity`         | í…Œì´ë¸”ê³¼ ë§¤í•‘ë˜ëŠ” í´ë˜ìŠ¤          |
| `@Id`             | ê¸°ë³¸ í‚¤ í•„ë“œ ì§€ì •                 |
| `@GeneratedValue` | ìë™ ì¦ê°€ ì „ëµ                    |
| `JpaRepository`   | CRUD + ì¿¼ë¦¬ ë©”ì„œë“œ ì œê³µ           |
| ì¿¼ë¦¬ ë©”ì„œë“œ       | ë©”ì„œë“œëª…ìœ¼ë¡œ ìë™ JPQL ìƒì„±       |
| íŠ¸ëœì­ì…˜          | `@Transactional`ë¡œ ë³´ì¥           |
| ì„¤ì •              | `application.yml`ë¡œ DB + JPA êµ¬ì„± |

------

### ê²°ë¡ 

**Spring Data JPA**ëŠ” JPAë¥¼ ì‹¤ë¬´ì—ì„œ **ë” ì‰½ê²Œ ì‚¬ìš©í•˜ê²Œ í•´ì£¼ëŠ” ê³ ìˆ˜ì¤€ í”„ë ˆì„ì›Œí¬**ì´ë‹¤.
 ê¸°ë³¸ CRUDëŠ” ë¬¼ë¡ , ì¿¼ë¦¬ ë©”ì„œë“œ, í˜ì´ì§•, ì •ë ¬, ë™ì  ì¿¼ë¦¬(QueryDSL) ë“±ë„ í­ë„“ê²Œ ì§€ì›í•œë‹¤.
 Entity, Repository, Service ê³„ì¸µ êµ¬ì¡°ë¥¼ ì •í™•íˆ ì„¤ê³„í•˜ê³ , í•„ìš”í•œ ì¿¼ë¦¬ëŠ” ë©”ì„œë“œëª… ë˜ëŠ” JPQLë¡œ ì„ ì–¸í•¨ìœ¼ë¡œì¨ **SQLì„ ì§ì ‘ ì‘ì„±í•˜ì§€ ì•Šì•„ë„ ê°•ë ¥í•œ ë°ì´í„° ì ‘ê·¼ì´ ê°€ëŠ¥í•˜ë‹¤.**

## Entity, Repository, Service ì„¤ê³„

Spring Bootì—ì„œì˜ ë°ì´í„° ì²˜ë¦¬ ê³„ì¸µì€ ë‹¤ìŒê³¼ ê°™ì€ **3ë‹¨ êµ¬ì¡°(Entity â†’ Repository â†’ Service)**ë¡œ êµ¬ì„±ëœë‹¤.
 ì´ êµ¬ì¡°ëŠ” **ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§, ë°ì´í„° ì €ì¥ì†Œ, ë„ë©”ì¸ ê°ì²´ì˜ ì±…ì„ì„ ë¶„ë¦¬**í•¨ìœ¼ë¡œì¨ ìœ ì§€ë³´ìˆ˜ì„±ê³¼ í™•ì¥ì„±ì„ ê·¹ëŒ€í™”í•œë‹¤.

------

### 1. ì „ì²´ ì„¤ê³„ êµ¬ì¡°

```
[Client ìš”ì²­]
   â†“
@Controller
   â†“
@Service        â† ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§, íŠ¸ëœì­ì…˜ ì²˜ë¦¬
   â†“
@Repository     â† ë°ì´í„°ë² ì´ìŠ¤ ì—°ë™ (JPA)
   â†“
@Entity         â† í…Œì´ë¸”ê³¼ ë§¤í•‘ë˜ëŠ” ë„ë©”ì¸ ê°ì²´
```

------

### 2. Entity ì„¤ê³„

**ì—­í• :** DB í…Œì´ë¸”ê³¼ 1:1 ë§¤í•‘ë˜ëŠ” ê°ì²´
 **ê·œì¹™:** ê¸°ë³¸ ìƒì„±ì í•„ìˆ˜, `@Id` í•„ìš”, `equals/hashCode` ì£¼ì˜

```
@Entity
public class Member {

    @Id @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;

    @Column(nullable = false)
    private String name;

    private String email;

    protected Member() {}  // JPA ê¸°ë³¸ ìƒì„±ì

    public Member(String name, String email) {
        this.name = name;
        this.email = email;
    }

    // Getter/Setter ìƒëµ ê°€ëŠ¥ (ë¡¬ë³µ ê¶Œì¥)
}
```

------

### 3. Repository ì„¤ê³„

**ì—­í• :** ë°ì´í„° CRUDë¥¼ ì²˜ë¦¬í•˜ëŠ” ì¸í„°í˜ì´ìŠ¤
 **ê¸°ë°˜:** `JpaRepository<Entity, ID>`

```
public interface MemberRepository extends JpaRepository<Member, Long> {
    Optional<Member> findByEmail(String email);
    boolean existsByName(String name);
}
```

- Spring Data JPAê°€ ìë™ìœ¼ë¡œ êµ¬í˜„ì²´ë¥¼ ìƒì„±
- `findByXxx`, `existsByXxx`, `countByXxx` ë“± ë‹¤ì–‘í•œ ë©”ì„œë“œ ì§€ì›

------

### 4. Service ì„¤ê³„

**ì—­í• :** ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ ì²˜ë¦¬, íŠ¸ëœì­ì…˜ ê´€ë¦¬, ì—¬ëŸ¬ ë¦¬í¬ì§€í† ë¦¬ ì¡°í•©

```
@Service
@RequiredArgsConstructor
public class MemberService {

    private final MemberRepository memberRepository;

    @Transactional
    public Member register(String name, String email) {
        if (memberRepository.existsByName(name)) {
            throw new IllegalStateException("ì´ë¯¸ ì¡´ì¬í•˜ëŠ” íšŒì›ì…ë‹ˆë‹¤.");
        }
        Member member = new Member(name, email);
        return memberRepository.save(member);
    }

    @Transactional(readOnly = true)
    public List<Member> findAll() {
        return memberRepository.findAll();
    }

    @Transactional(readOnly = true)
    public Member findById(Long id) {
        return memberRepository.findById(id)
                .orElseThrow(() -> new EntityNotFoundException("íšŒì› ì—†ìŒ"));
    }
}
```

- `@Transactional`ì„ í†µí•´ **íŠ¸ëœì­ì…˜ ê²½ê³„ ì„¤ì •**
- ì½ê¸° ì „ìš© íŠ¸ëœì­ì…˜ì—ëŠ” `readOnly = true`ë¡œ ì„±ëŠ¥ ìµœì í™”

------

### 5. DTOì™€ ì‘ë‹µ êµ¬ì¡°

```
public class MemberDto {
    private String name;
    private String email;

    public static MemberDto from(Member member) {
        return new MemberDto(member.getName(), member.getEmail());
    }
}
```

â†’ Service â†’ Controller ê°„ ë°ì´í„° ì „ë‹¬ ì‹œ Entity ëŒ€ì‹  DTO ì‚¬ìš© ê¶Œì¥

------

### 6. Controllerì—ì„œ ì‚¬ìš© ì˜ˆì‹œ

```
@RestController
@RequestMapping("/api/members")
@RequiredArgsConstructor
public class MemberController {

    private final MemberService memberService;

    @PostMapping
    public ResponseEntity<MemberDto> register(@RequestBody MemberDto dto) {
        Member saved = memberService.register(dto.getName(), dto.getEmail());
        return ResponseEntity.status(HttpStatus.CREATED).body(MemberDto.from(saved));
    }

    @GetMapping("/{id}")
    public ResponseEntity<MemberDto> get(@PathVariable Long id) {
        return ResponseEntity.ok(MemberDto.from(memberService.findById(id)));
    }
}
```

------

### 7. ê³„ì¸µ ë¶„ë¦¬ì˜ ì´ì 

| ê³„ì¸µ       | ì±…ì„          | íŠ¹ì§•                     |
| ---------- | ------------- | ------------------------ |
| Entity     | ë„ë©”ì¸ ëª¨ë¸   | DB êµ¬ì¡°ë¥¼ ë°˜ì˜           |
| Repository | ë°ì´í„° ì ‘ê·¼   | ì¸í„°í˜ì´ìŠ¤ë¡œ ì„ ì–¸ë§Œ      |
| Service    | ë¹„ì¦ˆë‹ˆìŠ¤ ì²˜ë¦¬ | ë¡œì§, íŠ¸ëœì­ì…˜ ë‹´ë‹¹      |
| Controller | HTTP ì²˜ë¦¬     | ìš”ì²­ ë§¤í•‘, DTO ë³€í™˜ ë‹´ë‹¹ |

- **ê´€ì‹¬ì‚¬ ë¶„ë¦¬:** í•œ ê³„ì¸µì˜ ìˆ˜ì •ì´ ë‹¤ë¥¸ ê³„ì¸µì— ì˜í–¥ì„ ìµœì†Œí™”
- **í…ŒìŠ¤íŠ¸ ìš©ì´ì„±:** ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ì™€ Mock ì£¼ì…ì— ìœ ë¦¬
- **í™•ì¥ì„±:** ê³„ì¸µ ê°„ ì—°ê²°ì„ ìœ ì§€í•˜ë©° ê¸°ëŠ¥ í™•ì¥ ê°€ëŠ¥

------

### 8. íŒ¨í‚¤ì§€ êµ¬ì¡° ì˜ˆì‹œ

```
com.example.app
â”œâ”€â”€ domain/
â”‚   â””â”€â”€ Member.java
â”œâ”€â”€ repository/
â”‚   â””â”€â”€ MemberRepository.java
â”œâ”€â”€ service/
â”‚   â””â”€â”€ MemberService.java
â”œâ”€â”€ controller/
â”‚   â””â”€â”€ MemberController.java
â”œâ”€â”€ dto/
â”‚   â””â”€â”€ MemberDto.java
```

------

### ê²°ë¡ 

Spring Bootì—ì„œì˜ Entity, Repository, Service ì„¤ê³„ëŠ” **í´ë¦° ì•„í‚¤í…ì²˜ë¥¼ ê¸°ë°˜ìœ¼ë¡œ í•œ ì±…ì„ ë¶„ë¦¬ êµ¬ì¡°**ë‹¤.
 ë°ì´í„° êµ¬ì¡°(Entity), ì €ì¥ì†Œ ì¸í„°í˜ì´ìŠ¤(Repository), ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§(Service)ë¥¼ ëª…í™•íˆ ë¶„ë¦¬í•˜ë©´ **ìœ ì§€ë³´ìˆ˜ì„±, í™•ì¥ì„±, í…ŒìŠ¤íŠ¸ íš¨ìœ¨ì„±**ì„ ê·¹ëŒ€í™”í•  ìˆ˜ ìˆë‹¤.

## CRUD ë° í˜ì´ì§• ì²˜ë¦¬

Spring Data JPAë¥¼ ì´ìš©í•œ **CRUD ë° í˜ì´ì§• ì²˜ë¦¬**ëŠ” ë§¤ìš° ê°„ê²°í•˜ê³  ê°•ë ¥í•œ ê¸°ëŠ¥ ì¤‘ í•˜ë‚˜ë‹¤.
 ë³µì¡í•œ SQL ì‘ì„± ì—†ì´ë„ ê¸°ë³¸ì ì¸ ë°ì´í„° ì €ì¥, ì¡°íšŒ, ìˆ˜ì •, ì‚­ì œëŠ” ë¬¼ë¡ ì´ê³ ,
 **í˜ì´ì§•, ì •ë ¬**ë„ ì†ì‰½ê²Œ êµ¬í˜„í•  ìˆ˜ ìˆë‹¤.

------

### 1. ê¸°ë³¸ CRUD (Create / Read / Update / Delete)

`JpaRepository<Entity, ID>`ë¥¼ ìƒì†í•˜ë©´ ë‹¤ìŒê³¼ ê°™ì€ ê¸°ë³¸ ë©”ì„œë“œë¥¼ ìë™ìœ¼ë¡œ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.

| ë©”ì„œë“œ           | ì„¤ëª…                                    |
| ---------------- | --------------------------------------- |
| `save(entity)`   | ì €ì¥ ë˜ëŠ” ìˆ˜ì • (id ê°’ ì¡´ì¬ ì—¬ë¶€ì— ë”°ë¼) |
| `findById(id)`   | IDë¡œ ë‹¨ê±´ ì¡°íšŒ                          |
| `findAll()`      | ì „ì²´ ëª©ë¡ ì¡°íšŒ                          |
| `delete(entity)` | ì—”í‹°í‹° ì‚­ì œ                             |
| `deleteById(id)` | IDë¡œ ì‚­ì œ                               |
| `count()`        | ì´ ê°œìˆ˜ ë°˜í™˜                            |
| `existsById(id)` | ì¡´ì¬ ì—¬ë¶€ í™•ì¸                          |

#### ì˜ˆì‹œ

```
Member member = new Member("kim", "kim@example.com");
memberRepository.save(member); // CREATE

Optional<Member> findOne = memberRepository.findById(1L); // READ

member.setName("kim2");
memberRepository.save(member); // UPDATE

memberRepository.deleteById(1L); // DELETE
```

------

### 2. í˜ì´ì§• ì²˜ë¦¬

Spring Data JPAëŠ” `PagingAndSortingRepository`ë¥¼ ìƒì†í•œ `JpaRepository`ë¥¼ í†µí•´ **ìë™ í˜ì´ì§• ì²˜ë¦¬ ê¸°ëŠ¥**ì„ ì œê³µí•œë‹¤.

#### 2.1 ë©”ì„œë“œ ì‹œê·¸ë‹ˆì²˜

```
Page<T> findAll(Pageable pageable);
```

------

#### 2.2 Pageable ê°ì²´ ìƒì„±

```
Pageable pageable = PageRequest.of(page, size, Sort.by("name").descending());
```

- `page`: 0ë¶€í„° ì‹œì‘
- `size`: í˜ì´ì§€ë‹¹ ê°œìˆ˜
- `Sort`: ì •ë ¬ í•„ë“œ ë° ë°©í–¥

------

#### 2.3 Controller ì˜ˆì‹œ

```
@GetMapping("/members")
public Page<MemberDto> list(@RequestParam(defaultValue = "0") int page,
                            @RequestParam(defaultValue = "10") int size) {
    Pageable pageable = PageRequest.of(page, size, Sort.by("id").descending());
    Page<Member> result = memberRepository.findAll(pageable);
    return result.map(MemberDto::from);
}
```

------

### 3. ì‘ë‹µ êµ¬ì¡° (Page ê°ì²´)

`Page<T>`ëŠ” ë‹¤ìŒê³¼ ê°™ì€ ì •ë³´ë¥¼ í•¨ê»˜ í¬í•¨í•œë‹¤:

- `getContent()` â†’ í˜„ì¬ í˜ì´ì§€ ë°ì´í„° ë¦¬ìŠ¤íŠ¸
- `getTotalElements()` â†’ ì „ì²´ í•­ëª© ìˆ˜
- `getTotalPages()` â†’ ì´ í˜ì´ì§€ ìˆ˜
- `getNumber()` â†’ í˜„ì¬ í˜ì´ì§€ ë²ˆí˜¸
- `isFirst()`, `isLast()` â†’ ì‹œì‘/ë ì—¬ë¶€

â†’ API ì‘ë‹µ ì‹œ, ë‹¤ìŒê³¼ ê°™ì€ êµ¬ì¡°ê°€ ìë™ ìƒì„±ë¨:

```
{
  "content": [...],
  "pageable": {...},
  "totalPages": 3,
  "totalElements": 27,
  "last": false,
  "first": true,
  ...
}
```

------

### 4. ì •ë ¬ ì²˜ë¦¬

ì •ë ¬ì€ `PageRequest` ìƒì„± ì‹œ `Sort` ê°ì²´ë¡œ í•¨ê»˜ ì „ë‹¬:

```
Sort sort = Sort.by("createdAt").descending().and(Sort.by("name").ascending());
Pageable pageable = PageRequest.of(0, 20, sort);
```

------

### 5. í˜ì´ì§• + ì¡°ê±´ ê²€ìƒ‰

ì¿¼ë¦¬ ë©”ì„œë“œ ë˜ëŠ” `@Query`ë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.

```
Page<Member> findByNameContaining(String name, Pageable pageable);
```

â†’ `/members?name=kim&page=0&size=10`

------

### 6. ì‘ë‹µ DTO ë§¤í•‘

`Page.map()`ì„ í™œìš©í•˜ì—¬ Entityë¥¼ ì§ì ‘ ë…¸ì¶œí•˜ì§€ ì•Šê³  DTOë¡œ ë³€í™˜í•  ìˆ˜ ìˆë‹¤.

```
Page<MemberDto> dtoPage = entityPage.map(MemberDto::from);
```

------

### 7. ì •ë¦¬ëœ Controller ì˜ˆì‹œ

```
@GetMapping("/api/members")
public ResponseEntity<Page<MemberDto>> getMembers(
        @RequestParam(defaultValue = "0") int page,
        @RequestParam(defaultValue = "10") int size) {

    Pageable pageable = PageRequest.of(page, size, Sort.by("id").descending());
    Page<MemberDto> result = memberRepository.findAll(pageable).map(MemberDto::from);

    return ResponseEntity.ok(result);
}
```

------

### 8. ê²°ë¡ 

Spring Data JPAì˜ CRUD + í˜ì´ì§• ê¸°ëŠ¥ì€ ë‹¤ìŒê³¼ ê°™ì€ ì¥ì ì„ ê°€ì§„ë‹¤:

| í•­ëª©             | ì¥ì                                              |
| ---------------- | ------------------------------------------------ |
| ê¸°ë³¸ ë©”ì„œë“œ ì œê³µ | ì €ì¥, ìˆ˜ì •, ì‚­ì œ, ì¡°íšŒ ëª¨ë‘ êµ¬í˜„ ì—†ì´ ì‚¬ìš© ê°€ëŠ¥  |
| í˜ì´ì§• ì§€ì›      | `Pageable` + `Page<T>` ê°ì²´ë¡œ êµ¬ì¡°í™”ëœ ì‘ë‹µ ê°€ëŠ¥ |
| ì •ë ¬ ì§€ì›        | `Sort` ê°ì²´ ì¡°í•©ìœ¼ë¡œ ë‹¤ì¤‘ í•„ë“œ ì •ë ¬              |
| DTO ë§¤í•‘         | `map()`ì„ í†µí•œ ì•ˆì „í•œ ë°ì´í„° ë³€í™˜                |
| ì¿¼ë¦¬ ë©”ì„œë“œ í†µí•© | ê²€ìƒ‰ ì¡°ê±´ + í˜ì´ì§• ì¡°í•©ë„ ìì—°ìŠ¤ëŸ½ê²Œ ì²˜ë¦¬ ê°€ëŠ¥   |

## JPA ì¿¼ë¦¬ ë©”ì†Œë“œ ì •ì˜

Spring Data JPAì—ì„œëŠ” **SQLì´ë‚˜ JPQLì„ ì§ì ‘ ì‘ì„±í•˜ì§€ ì•Šê³ ë„**,
 **ë©”ì„œë“œ ì´ë¦„ë§Œìœ¼ë¡œ ì¿¼ë¦¬ë¥¼ ìë™ ìƒì„±í•˜ëŠ” ê¸°ëŠ¥**ì„ ì œê³µí•©ë‹ˆë‹¤.
 ì´ë¥¼ **ì¿¼ë¦¬ ë©”ì„œë“œ(Query Method)**ë¼ í•˜ë©°, `JpaRepository`ì—ì„œ ì•„ì£¼ ê°•ë ¥í•˜ê²Œ í™œìš©ë©ë‹ˆë‹¤.

------

### 1. ê¸°ë³¸ êµ¬ì¡°

```
ë°˜í™˜íƒ€ì… findByí•„ë“œëª…ì¡°ê±´(ì¡°ê±´ê°’)
```

> ì˜ˆ: `findByName(String name)`
>  â†’ JPQL: `SELECT m FROM Member m WHERE m.name = :name`

------

### 2. ì¿¼ë¦¬ ë©”ì„œë“œì˜ ê·œì¹™

| í‚¤ì›Œë“œ               | ì„¤ëª…            | ì˜ˆì‹œ                    |
| -------------------- | --------------- | ----------------------- |
| `findBy`             | ì¡°íšŒ ì‹œì‘       | `findByName`            |
| `existsBy`           | ì¡´ì¬ ì—¬ë¶€       | `existsByEmail`         |
| `countBy`            | ê°œìˆ˜ ë°˜í™˜       | `countByStatus`         |
| `deleteBy`           | ì‚­ì œ ìˆ˜í–‰       | `deleteByCreatedBefore` |
| `readBy` / `queryBy` | `findBy`ì™€ ë™ì¼ | `readByName`            |

------

### 3. ë¹„êµ ì—°ì‚°ì

| ì¡°ê±´               | ì˜ˆì‹œ ë©”ì„œë“œ                             | ìƒì„± JPQL                   |
| ------------------ | --------------------------------------- | --------------------------- |
| Equals             | `findByEmail(String email)`             | `email = :email`            |
| Not Equals         | `findByNameNot(String name)`            | `name <> :name`             |
| Greater Than       | `findByAgeGreaterThan(int age)`         | `age > :age`                |
| Less Than          | `findByAgeLessThan(int age)`            | `age < :age`                |
| Between            | `findByAgeBetween(int min, int max)`    | `age BETWEEN :min AND :max` |
| Like               | `findByNameLike(String name)`           | `name LIKE :name`           |
| Contains           | `findByNameContaining(String keyword)`  | `name LIKE %:keyword%`      |
| StartsWith         | `findByNameStartingWith(String prefix)` | `name LIKE :prefix%`        |
| EndsWith           | `findByNameEndingWith(String suffix)`   | `name LIKE %:suffix`        |
| IsNull / IsNotNull | `findByDeletedAtIsNull()`               | `deletedAt IS NULL`         |

------

### 4. ë…¼ë¦¬ ì—°ì‚°ì

| ì—°ì‚°ì | ì„¤ëª…                 | ì˜ˆì‹œ                                            |
| ------ | -------------------- | ----------------------------------------------- |
| `And`  | ëª¨ë“  ì¡°ê±´ì„ ë§Œì¡±     | `findByEmailAndName(String email, String name)` |
| `Or`   | í•˜ë‚˜ë§Œ ë§Œì¡±í•´ë„ ê°€ëŠ¥ | `findByEmailOrName(String email, String name)`  |

------

### 5. ì •ë ¬

ì •ë ¬ì€ `Sort` ê°ì²´ë¡œ ì œì–´í•˜ëŠ” ê²ƒì´ ì¼ë°˜ì ì´ì§€ë§Œ, ë©”ì„œë“œ ì´ë¦„ì—ë„ í¬í•¨ ê°€ëŠ¥

```
List<Member> findByNameOrderByAgeDesc();
List<Member> findByStatusOrderByCreatedAtDescIdAsc();
```

------

### 6. í˜ì´ì§• ì§€ì›

```
Page<Member> findByName(String name, Pageable pageable);
List<Member> findByAgeGreaterThan(int age, Pageable pageable);
```

> `Pageable`ì„ íŒŒë¼ë¯¸í„°ë¡œ ë„˜ê¸°ë©´ Spring Data JPAê°€ ìë™ìœ¼ë¡œ í˜ì´ì§• ì¿¼ë¦¬ë¥¼ ìƒì„±í•¨

------

### 7. ë°˜í™˜ íƒ€ì…

| ë°˜í™˜ íƒ€ì…     | ì„¤ëª…                                                   |
| ------------- | ------------------------------------------------------ |
| `List<T>`     | ì—¬ëŸ¬ ê°œ ë°˜í™˜ (ê¸°ë³¸)                                    |
| `Optional<T>` | ë‹¨ì¼ ê°ì²´ + null-safe                                  |
| `T`           | ë‹¨ì¼ ê°ì²´ (nullable)                                   |
| `Page<T>`     | í˜ì´ì§•ëœ ê²°ê³¼                                          |
| `Slice<T>`    | ë‹¤ìŒ í˜ì´ì§€ ì¡´ì¬ ì—¬ë¶€ë§Œ íŒë‹¨ (ì´ ê°œìˆ˜ ì—†ìŒ)            |
| `Stream<T>`   | Java Stream ì²˜ë¦¬ìš© (ì£¼ì˜: íŠ¸ëœì­ì…˜ ë‚´ì—ì„œ ì‚¬ìš©í•´ì•¼ í•¨) |

------

### 8. ì˜ˆì‹œ ëª¨ìŒ

```
List<Member> findByName(String name);
Optional<Member> findByEmail(String email);
List<Member> findByAgeBetween(int min, int max);
List<Member> findByNameContainingAndAgeGreaterThan(String keyword, int age);
Page<Member> findByStatus(String status, Pageable pageable);
boolean existsByEmail(String email);
long countByStatus(String status);
```

------

### 9. ì¡°ê±´ í‚¤ì›Œë“œ ì •ë¦¬í‘œ

| ì¡°ê±´ í‚¤ì›Œë“œ            | ì˜ë¯¸         |
| ---------------------- | ------------ |
| `Is`, `Equals`         | =            |
| `IsNot`, `Not`         | !=           |
| `GreaterThan`, `Gt`    | >            |
| `LessThan`, `Lt`       | <            |
| `Between`              | BETWEEN      |
| `Like`, `Containing`   | LIKE '%...%' |
| `StartingWith`         | LIKE '...%'  |
| `EndingWith`           | LIKE '%...'  |
| `In`                   | IN (...)     |
| `IsNull`, `Null`       | IS NULL      |
| `IsNotNull`, `NotNull` | IS NOT NULL  |

------

### 10. ì£¼ì˜ì‚¬í•­

- í•„ë“œ ì´ë¦„ì€ ì •í™•íˆ Entityì˜ **ì†ì„±ëª…**ê³¼ ì¼ì¹˜í•´ì•¼ í•¨
- **ë³µì¡í•œ ì¡°ê±´**ì€ `@Query` ë˜ëŠ” **QueryDSL** ì‚¬ìš© ê¶Œì¥
- ë©”ì„œë“œëª…ì´ ë„ˆë¬´ ê¸¸ì–´ì§€ë©´ â†’ **ëª…ì‹œì  ì¿¼ë¦¬ë¡œ ì „í™˜**

------

### 11. ì˜ˆì™¸ ë° í™•ì¥

#### 1) ì˜ëª»ëœ í•„ë“œëª…

```
findByNames() // ì˜¤ë¥˜: Entityì— names ì—†ìŒ â†’ ì»´íŒŒì¼ íƒ€ì„ì—ì„œ ê°ì§€ X
```

â†’ í…ŒìŠ¤íŠ¸ ì½”ë“œë¡œ ë°˜ë“œì‹œ ê²€ì¦í•´ì•¼ í•¨

#### 2) ì»¤ìŠ¤í…€ ì¿¼ë¦¬ í˜¼í•©

```
@Query("SELECT m FROM Member m WHERE m.name = :name AND m.age >= :age")
List<Member> search(@Param("name") String name, @Param("age") int age);
```

------

### ê²°ë¡ 

Spring Data JPAì˜ **ì¿¼ë¦¬ ë©”ì„œë“œ ê¸°ëŠ¥**ì€ SQL ì—†ì´ë„ ë³µì¡í•œ ì¡°ê±´ ê²€ìƒ‰ì„ **ëª…í™•í•˜ê³  ì„ ì–¸ì ìœ¼ë¡œ í‘œí˜„**í•  ìˆ˜ ìˆê²Œ í•œë‹¤.
 **ë©”ì„œë“œ ì´ë¦„ë§Œìœ¼ë¡œë„ ì¿¼ë¦¬ë¥¼ ì™„ì„±í•  ìˆ˜ ìˆë‹¤ëŠ” ì **ì—ì„œ ìƒì‚°ì„±ê³¼ ê°€ë…ì„±ì´ ë§¤ìš° ë›°ì–´ë‚˜ë©°,
 **ì¡°ê±´ì´ ë³µì¡í•´ì§ˆ ê²½ìš° `@Query` ë˜ëŠ” QueryDSLë¡œ ì´ê´€í•˜ëŠ” ì „ëµ**ì„ ë³‘í–‰í•˜ë©´ ì•ˆì •ì ì¸ ì•„í‚¤í…ì²˜ êµ¬ì„±ì´ ê°€ëŠ¥í•˜ë‹¤.

## JPQL, Native Query

Spring Data JPAì—ì„œëŠ” ê¸°ë³¸ ì¿¼ë¦¬ ë©”ì„œë“œ ì™¸ì—ë„ **ë³µì¡í•œ ì¿¼ë¦¬**ê°€ í•„ìš”í•œ ê²½ìš°,
 **JPQL(Java Persistence Query Language)** ë˜ëŠ” **Native Query(SQL)**ë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.
 ì´ë¥¼ í†µí•´ **ì¡°ì¸, ì„œë¸Œì¿¼ë¦¬, ì§‘ê³„, ë³µì¡í•œ ì¡°ê±´ ê²€ìƒ‰** ë“±ì„ ìœ ì—°í•˜ê²Œ ì²˜ë¦¬í•  ìˆ˜ ìˆë‹¤.

------

### 1. JPQLì´ë€?

**JPQL**ì€ **ê°ì²´(Entity)ë¥¼ ëŒ€ìƒìœ¼ë¡œ ì‘ì„±í•˜ëŠ” SQL ìœ ì‚¬ ë¬¸ë²•**ì´ë‹¤.

| íŠ¹ì§•               | ì„¤ëª…                                              |
| ------------------ | ------------------------------------------------- |
| í…Œì´ë¸” ê¸°ë°˜ì´ ì•„ë‹˜ | `SELECT * FROM member` â†’ `SELECT m FROM Member m` |
| ëŒ€ì†Œë¬¸ì êµ¬ë¶„      | Entity ì´ë¦„ê³¼ í•„ë“œëŠ” ëŒ€ì†Œë¬¸ì êµ¬ë¶„                |
| ìë™ ë§¤í•‘          | ê²°ê³¼ê°€ ìë™ìœ¼ë¡œ Entityì— ë§¤í•‘ë¨                   |
| DB ì¢…ì†ì„± ì—†ìŒ     | Hibernate, EclipseLink ë“±ê³¼ ë…ë¦½ì  ì‘ë™           |

------

### 2. JPQL ê¸°ë³¸ ì˜ˆì‹œ

```
@Query("SELECT m FROM Member m WHERE m.name = :name")
List<Member> findByName(@Param("name") String name);
```

```
@Query("SELECT m FROM Member m WHERE m.age > :age ORDER BY m.name DESC")
List<Member> findByAgeGreaterThan(@Param("age") int age);
```

------

### 3. @Query ì• ë…¸í…Œì´ì…˜

Spring Data JPAì—ì„œëŠ” `@Query`ë¡œ JPQL ë˜ëŠ” Native SQLì„ ì§ì ‘ ì‘ì„±í•  ìˆ˜ ìˆë‹¤.

#### ë¬¸ë²• êµ¬ì¡°

```
@Query("SELECT e FROM Entity e WHERE e.prop = :param")
List<Entity> methodName(@Param("param") íƒ€ì… ê°’);
```

------

### 4. Native Query

Native QueryëŠ” **DBì— ì§ì ‘ SQLì„ ì‘ì„±í•˜ì—¬ ì‹¤í–‰**í•˜ëŠ” ë°©ì‹ì´ë‹¤.
 â†’ JPQLë¡œ í‘œí˜„í•˜ê¸° ì–´ë ¤ìš´ ì¿¼ë¦¬, ë³µì¡í•œ SQL ë¬¸ë²• ì‚¬ìš© ê°€ëŠ¥

```
@Query(value = "SELECT * FROM member WHERE email = :email", nativeQuery = true)
Member findByEmailNative(@Param("email") String email);
```

- `nativeQuery = true` í•„ìˆ˜
- ê²°ê³¼ ë§¤í•‘ì€ Entity ê¸°ì¤€ìœ¼ë¡œ ì´ë£¨ì–´ì§
- Join + Alias ë“± **DB ì¢…ì†ì  í‘œí˜„ ê°€ëŠ¥**

------

### 5. ë°˜í™˜ íƒ€ì…

| ë°˜í™˜ íƒ€ì…                  | ì„¤ëª…                                      |
| -------------------------- | ----------------------------------------- |
| Entity                     | JPQL/Native ëª¨ë‘ ê°€ëŠ¥                     |
| DTO                        | JPQLì—ì„œ `new íŒ¨í‚¤ì§€ëª….ìƒì„±ì()` ì‚¬ìš©     |
| `Object[], List<Object[]>` | Native Query ë‹¤ì¤‘ ì—´ ëŒ€ì‘                 |
| Interface ê¸°ë°˜ Projection  | JPQLì—ì„œëŠ” ë¶ˆê°€, NativeëŠ” ì¼ë¶€ ì§€ì›       |
| `Page<T>`                  | í˜ì´ì§• ëŒ€ì‘ ê°€ëŠ¥ (`countQuery` ì¶”ê°€ ê¶Œì¥) |

------

### 6. DTO ì§ì ‘ ì¡°íšŒ (JPQL)

```
@Query("SELECT new com.example.dto.MemberDto(m.name, m.age) FROM Member m")
List<MemberDto> findAllDto();
```

- `MemberDto(String name, int age)` ìƒì„±ì í•„ìš”
- ì „ì²´ ê²½ë¡œ íŒ¨í‚¤ì§€ëª… ë°˜ë“œì‹œ í¬í•¨

------

### 7. í˜ì´ì§• + JPQL

```
@Query("SELECT m FROM Member m WHERE m.age > :age")
Page<Member> findByAge(@Param("age") int age, Pageable pageable);
```

â†’ ìë™ìœ¼ë¡œ count ì¿¼ë¦¬ê°€ ì¶”ê°€ë¨
 â†’ í•„ìš” ì‹œ `countQuery`ë¥¼ ëª…ì‹œí•´ ì„±ëŠ¥ ìµœì í™” ê°€ëŠ¥

```
@Query(
  value = "SELECT m FROM Member m WHERE m.status = :status",
  countQuery = "SELECT COUNT(m) FROM Member m WHERE m.status = :status"
)
Page<Member> findByStatus(@Param("status") String status, Pageable pageable);
```

------

### 8. Native Query + DTO ë§¤í•‘

Entityê°€ ì•„ë‹Œ DTOë¡œ ì§ì ‘ ë§¤í•‘í•˜ë ¤ë©´ **ResultSetMapping**, Projection, ë˜ëŠ” interface ê¸°ë°˜ Projection ì‚¬ìš©ì´ í•„ìš”í•˜ë©°
 ë³µì¡í•˜ê³  ìœ ì§€ë³´ìˆ˜ ì–´ë ¤ì›Œì„œ ë³´í†µì€ **QueryDSL ë˜ëŠ” ì§ì ‘ ë§¤í•‘**ì„ ì„ íƒí•¨

ì˜ˆì‹œ (interface ê¸°ë°˜):

```
public interface MemberSummary {
    String getName();
    int getAge();
}
```

```
@Query(value = "SELECT name, age FROM member", nativeQuery = true)
List<MemberSummary> findAllSummary();
```

------

### 9. ì£¼ì˜ ì‚¬í•­

| í•­ëª©               | ì£¼ì˜ì                                              |
| ------------------ | -------------------------------------------------- |
| Native Query       | DB ì¢…ì†ì„± ìˆìŒ (MySQL vs PostgreSQL ë“±)            |
| DTO ë§¤í•‘           | ìƒì„±ì ë°©ì‹ì€ í•„ë“œëª… ì˜¤ë¥˜ê°€ ì»´íŒŒì¼ íƒ€ì„ì— ì•ˆ ì¡í˜  |
| `*` ì‚¬ìš© ê¸ˆì§€      | JPQLì—ì„œëŠ” `SELECT *` ì‚¬ìš© ë¶ˆê°€                    |
| join ì‹œ alias í•„ìˆ˜ | `SELECT m FROM Member m JOIN m.team t` ì‹ìœ¼ë¡œ ì‘ì„± |

------

### 10. ì •ë¦¬ ë¹„êµ

| í•­ëª©        | JPQL                   | Native Query                  |
| ----------- | ---------------------- | ----------------------------- |
| ëŒ€ìƒ        | Entity ê¸°ì¤€            | í…Œì´ë¸” ê¸°ì¤€                   |
| í¬í„°ë¸”      | O                      | X (DB ì¢…ì†ì )                 |
| ìë™ ë§¤í•‘   | Entity ë˜ëŠ” DTO ìƒì„±ì | Entity ë˜ëŠ” Projection        |
| ì‚¬ìš© ë‚œì´ë„ | ì‰½ê³  ì„ ì–¸ì             | ê°•ë ¥í•˜ì§€ë§Œ ë³µì¡í•¨             |
| ì„±ëŠ¥        | Hibernate ìµœì í™” ëŒ€ìƒ  | ì§ì ‘ íŠœë‹ ê°€ëŠ¥                |
| í˜ì´ì§• ì§€ì› | O                      | O (countQuery ìˆ˜ë™ ì‘ì„± ê¶Œì¥) |

------

### ê²°ë¡ 

Spring Data JPAì—ì„œëŠ”

- **ê°„ë‹¨í•œ ì¡°ê±´ ê²€ìƒ‰ â†’ ì¿¼ë¦¬ ë©”ì„œë“œ**
- **ì¤‘ê°„ ë³µì¡ë„ â†’ @Query(JPQL)**
- **ë³µì¡í•œ ì¿¼ë¦¬ ë˜ëŠ” ì„±ëŠ¥ íŠœë‹ â†’ Native Query ë˜ëŠ” QueryDSL**
   ì´ë¼ëŠ” íë¦„ìœ¼ë¡œ ì¿¼ë¦¬ ì „ëµì„ ì„ íƒí•˜ëŠ” ê²ƒì´ ê°€ì¥ í•©ë¦¬ì ì´ë‹¤.

## ì§€ì—° ë¡œë”© vs ì¦‰ì‹œ ë¡œë”©

JPAì—ì„œ ì—”í‹°í‹° ê°„ ì—°ê´€ ê´€ê³„ë¥¼ ë§ºì„ ë•Œ,
 **ì—°ê´€ëœ ì—”í‹°í‹°ë¥¼ ì–¸ì œ ë¡œë”©í• ì§€ë¥¼ ê²°ì •í•˜ëŠ” ì „ëµ**ì´ ë°”ë¡œ `ì§€ì—° ë¡œë”©(LAZY)`ê³¼ `ì¦‰ì‹œ ë¡œë”©(EAGER)`ì´ë‹¤.

ì´ ì „ëµì€ **í¼í¬ë¨¼ìŠ¤, ì¿¼ë¦¬ íš¨ìœ¨ì„±, ì„¤ê³„ ì¼ê´€ì„±**ì— í° ì˜í–¥ì„ ë¯¸ì¹˜ê¸° ë•Œë¬¸ì—
 ì •í™•í•œ ì´í•´ì™€ ëª…í™•í•œ ê¸°ì¤€ì´ ë§¤ìš° ì¤‘ìš”í•˜ë‹¤.

------

### 1. ê¸°ë³¸ ê°œë…

| ì „ëµ                  | ì„¤ëª…                                                |
| --------------------- | --------------------------------------------------- |
| **ì§€ì—° ë¡œë”© (LAZY)**  | ì—°ê´€ ê°ì²´ë¥¼ ì‹¤ì œë¡œ ì‚¬ìš©í•  ë•Œ DBì—ì„œ ì¡°íšŒí•¨          |
| **ì¦‰ì‹œ ë¡œë”© (EAGER)** | ì£¼ ì—”í‹°í‹°ê°€ ë¡œë”©ë  ë•Œ, ì—°ê´€ ê°ì²´ë„ í•¨ê»˜ ì¦‰ì‹œ ì¡°íšŒí•¨ |

```
@ManyToOne(fetch = FetchType.LAZY)
private Team team;
```

```
@ManyToOne(fetch = FetchType.EAGER)
private Team team;
```

------

### 2. ë™ì‘ ì˜ˆì‹œ

#### ì˜ˆ: Member â†’ Team ê´€ê³„

```
@Entity
public class Member {
    @Id @GeneratedValue
    private Long id;

    private String name;

    @ManyToOne(fetch = FetchType.LAZY)
    private Team team;
}
```

```
Member member = memberRepository.findById(1L).get();
Team team = member.getTeam(); // ì—¬ê¸°ì„œ SELECT team ì¿¼ë¦¬ ë°œìƒ (LAZY)
```

â†’ LAZYëŠ” **`getTeam()` í˜¸ì¶œ ì‹œì **ì— ì¶”ê°€ ì¿¼ë¦¬ ë°œìƒ
 â†’ EAGERëŠ” **`findById()` ì‹¤í–‰ ì‹œì ì— Join ì¿¼ë¦¬ë¡œ í•¨ê»˜ ì¡°íšŒ**

------

### 3. ì¿¼ë¦¬ ë°œìƒ ë¹„êµ

#### 1) ì§€ì—° ë¡œë”© (LAZY)

```
-- Memberë§Œ ì¡°íšŒ
SELECT * FROM member WHERE id = 1;

-- team ì ‘ê·¼ ì‹œ
SELECT * FROM team WHERE id = ?;
```

#### 2) ì¦‰ì‹œ ë¡œë”© (EAGER)

```
-- ì¦‰ì‹œ ì¡°ì¸ ë°œìƒ
SELECT * FROM member m
JOIN team t ON m.team_id = t.id
WHERE m.id = 1;
```

------

### 4. ë””í´íŠ¸ ê°’

| ê´€ê³„ ì¢…ë¥˜                   | ê¸°ë³¸ FetchType |
| --------------------------- | -------------- |
| `@OneToOne`                 | EAGER          |
| `@ManyToOne`                | EAGER          |
| `@OneToMany`, `@ManyToMany` | LAZY           |

> ê·¸ëŸ¬ë‚˜ ì‹¤ë¬´ì—ì„œëŠ” **ëª¨ë“  ì—°ê´€ ê´€ê³„ë¥¼ LAZYë¡œ ì„¤ì •í•˜ê³ , í•„ìš”í•œ ê³³ì—ì„œ ëª…ì‹œì ìœ¼ë¡œ Fetch Join ë˜ëŠ” EntityGraphë¥¼ ì‚¬ìš©í•˜ëŠ” ì „ëµ**ì´ ê°€ì¥ ì•ˆì „í•˜ê³  ì„±ëŠ¥ ìµœì í™”ì— ìœ ë¦¬í•¨

------

### 5. ë¬¸ì œì : EAGERì˜ ì¹˜ëª…ì ì¸ ë‹¨ì 

- **ì˜ë„í•˜ì§€ ì•Šì€ Join ë°œìƒ**
- **N+1 ë¬¸ì œ ìœ ë°œ ìœ„í—˜ ì¦ê°€**
- ì¬ì‚¬ìš©ì„±ì´ ë–¨ì–´ì§ (Repository ë©”ì„œë“œë§ˆë‹¤ ì¿¼ë¦¬ êµ¬ì¡°ê°€ ë‹¬ë¼ì§)

```
List<Member> members = memberRepository.findAll(); // EAGERì´ë©´ íšŒì› ìˆ˜ë§Œí¼ íŒ€ ì¡°íšŒ ë°œìƒ ê°€ëŠ¥ì„±
```

------

### 6. ì„±ëŠ¥ ìµœì í™” ì „ëµ: Fetch Join

ì§€ì—° ë¡œë”©(LAZY)ì„ ê¸°ë³¸ìœ¼ë¡œ í•˜ë˜,
 **JPQLì—ì„œ í•„ìš”í•œ ê²½ìš°ë§Œ Fetch Joinì„ í†µí•´ í•¨ê»˜ ì¡°íšŒ**í•œë‹¤:

```
@Query("SELECT m FROM Member m JOIN FETCH m.team")
List<Member> findAllWithTeam();
```

â†’ 1ê°œì˜ SQLë¡œ Member + Team í•¨ê»˜ ì¡°íšŒ

------

### 7. ì„±ëŠ¥ ë¹„êµ ìš”ì•½

| í•­ëª©           | LAZY               | EAGER                                |
| -------------- | ------------------ | ------------------------------------ |
| ì¿¼ë¦¬ ë°œìƒ ì‹œì  | ì—°ê´€ ê°ì²´ ì ‘ê·¼ ì‹œ  | ì¦‰ì‹œ (ì¡°íšŒ ì‹œì )                     |
| ì¿¼ë¦¬ ê°œìˆ˜      | í•„ìš”í•  ë•Œë§Œ ë°œìƒ   | í•­ìƒ í•¨ê»˜ ë°œìƒ                       |
| ì„±ëŠ¥ ìœ ì—°ì„±    | ë†’ìŒ (ìµœì í™” ê°€ëŠ¥) | ë‚®ìŒ (ì˜ë„í•˜ì§€ ì•Šì€ ì¿¼ë¦¬ ë°œìƒ)       |
| ê¶Œì¥ ì—¬ë¶€      | âœ… ê¶Œì¥ (ê¸°ë³¸ ì „ëµ) | âŒ ë¹„ê¶Œì¥ (íŠ¹íˆ OneToManyì—ì„œ ì¹˜ëª…ì ) |

------

### 8. ê²°ë¡  ë° ì‹¤ë¬´ ê°€ì´ë“œ

| ì „ëµ                      | ì‹¤ë¬´ ê¸°ì¤€                                         |
| ------------------------- | ------------------------------------------------- |
| **ê¸°ë³¸ ì„¤ì •**             | ëª¨ë“  ì—°ê´€ê´€ê³„ `FetchType.LAZY` ì„¤ì • ê¶Œì¥          |
| **ì¦‰ì‹œ ì¡°íšŒ í•„ìš” ì‹œ**     | `@Query` + `JOIN FETCH`, ë˜ëŠ” `EntityGraph` ì‚¬ìš©  |
| **í•œë²ˆì— ì—¬ëŸ¬ ì—°ê´€ ì¡°íšŒ** | DTOë¡œ ì§ì ‘ ì¡°íšŒ or QueryDSL                       |
| **N+1 ë¬¸ì œ ê°ì§€**         | Hibernate ì¿¼ë¦¬ ë¡œê·¸ + í…ŒìŠ¤íŠ¸ ë°ì´í„°ë¡œ ë°˜ë“œì‹œ í™•ì¸ |

------

### ê²°ë¡ 

- **ì§€ì—° ë¡œë”©(LAZY)**ì€ ì„±ëŠ¥, ì„¤ê³„ ì¼ê´€ì„±, ìœ ì—°ì„± ë©´ì—ì„œ **ì‚¬ì‹¤ìƒì˜ í‘œì¤€**ì´ë‹¤.
- **ì¦‰ì‹œ ë¡œë”©(EAGER)**ì€ í¸ë¦¬í•´ ë³´ì´ì§€ë§Œ, **ì˜ˆìƒì¹˜ ëª»í•œ ì¿¼ë¦¬ í­ì£¼, Join, N+1 ë¬¸ì œë¥¼ ì¼ìœ¼í‚¬ ê°€ëŠ¥ì„±ì´ ë§¤ìš° ë†’ë‹¤.**

## N+1 ë¬¸ì œì™€ í•´ê²° ë°©ë²•

**N+1 ë¬¸ì œ**ëŠ” JPAì—ì„œ **ì§€ì—° ë¡œë”©(LAZY)** ì„¤ì •ê³¼ ì—°ê´€ëœ **ì„±ëŠ¥ ë¬¸ì œ ì¤‘ ê°€ì¥ ë¹ˆë²ˆí•˜ê³  ì¹˜ëª…ì ì¸ ë¬¸ì œ**ë‹¤.
 ì´ˆê¸°ì—ëŠ” ëˆˆì— ë„ì§€ ì•Šì§€ë§Œ, ë°ì´í„°ê°€ ë§ì•„ì§ˆìˆ˜ë¡ **ì¿¼ë¦¬ ìˆ˜ê°€ ê¸°í•˜ê¸‰ìˆ˜ì ìœ¼ë¡œ ì¦ê°€**í•˜ì—¬ ì‹œìŠ¤í…œ ì„±ëŠ¥ì„ ì‹¬ê°í•˜ê²Œ ì €í•˜ì‹œí‚¨ë‹¤.

------

### 1. N+1 ë¬¸ì œë€?

> **1ê°œì˜ ì¿¼ë¦¬(N=1)**ë¡œ ê¸°ë³¸ ë°ì´í„°ë¥¼ ì¡°íšŒí•œ í›„,
>  ê° ë°ì´í„°ì˜ **ì—°ê´€ ê°ì²´ë¥¼ ì¡°íšŒí•˜ê¸° ìœ„í•´ ì¶”ê°€ë¡œ Nê°œì˜ ì¿¼ë¦¬**ê°€ ë°œìƒí•˜ëŠ” ë¬¸ì œ

------

#### ì˜ˆì‹œ: Member â†’ Team (ManyToOne)

```
@Entity
public class Member {
    @ManyToOne(fetch = FetchType.LAZY)
    private Team team;
}

```

```
List<Member> members = memberRepository.findAll(); // íŒ€ ì •ë³´ë„ ì‚¬ìš©í•¨
for (Member m : members) {
    System.out.println(m.getTeam().getName());
}
```

**ë°œìƒ ì¿¼ë¦¬ íë¦„:**

```
1. SELECT * FROM member      -- ê¸°ë³¸ ì¡°íšŒ (1íšŒ)
2. SELECT * FROM team WHERE id = ?   -- ê° ë©¤ë²„ë§ˆë‹¤ íŒ€ ì¡°íšŒ (NíšŒ)
3. ...
```

â†’ ì´ **1 + N ì¿¼ë¦¬ ë°œìƒ**

------

### 2. ì™œ ë°œìƒí•˜ëŠ”ê°€?

- `@ManyToOne(fetch = LAZY)`ë¡œ ì„¤ì • â†’ ì§€ì—° ë¡œë”©
- ì—”í‹°í‹°ë¥¼ ë£¨í”„ ëŒë©´ì„œ ì—°ê´€ ê°ì²´ì— ì ‘ê·¼í•˜ë©´, **ê·¸ ì‹œì ë§ˆë‹¤ SQL ì¶”ê°€ ì‹¤í–‰**
- ê°œë°œìëŠ” ì½”ë“œ ìƒ ë¬¸ì œ ì—†ì–´ ë³´ì´ì§€ë§Œ, **DBì—ì„œëŠ” ì—„ì²­ë‚œ ë¶€í•˜ ë°œìƒ**

------

### 3. ì‹¤ë¬´ì—ì„œì˜ í”¼í•´

| ìƒí™©                           | ê²°ê³¼                                   |
| ------------------------------ | -------------------------------------- |
| íšŒì› 1,000ëª… ì¡°íšŒ â†’ ê° íŒ€ ì¡°íšŒ | **ì´ 1,001ê°œì˜ ì¿¼ë¦¬ ë°œìƒ**             |
| ë‹¨ìˆœ ê´€ë¦¬ì ì¡°íšŒ í™”ë©´          | í˜ì´ì§€ ëŠë ¤ì§, íŠ¸ë˜í”½ ê¸‰ì¦, ë¹„ìš© í­ì¦  |
| ìºì‹œ ì—†ìŒ                      | DB ë¶€í•˜ ê¸‰ì¦                           |
| ì§€ì—° ì¸ì‹                      | QA ì´í›„ ë˜ëŠ” ì‹¤ì œ ìš´ì˜ì—ì„œ ë¬¸ì œ ë“œëŸ¬ë‚¨ |

------

### 4. í•´ê²° ë°©ë²•

#### âœ… 1) Fetch Join (JPQL ê¸°ë°˜ ìµœì í™”)

```
@Query("SELECT m FROM Member m JOIN FETCH m.team")
List<Member> findAllWithTeam();
```

â†’ `JOIN FETCH`ë¥¼ ì‚¬ìš©í•˜ë©´ **ì—°ê´€ ê°ì²´ë¥¼ í•œ ë²ˆì— í•¨ê»˜ ì¡°íšŒ**
 â†’ ì¿¼ë¦¬: ë‹¨ **1íšŒë§Œ ì‹¤í–‰**

```
SELECT m.*, t.* FROM member m
JOIN team t ON m.team_id = t.id
```

------

#### âœ… 2) EntityGraph (ì„ ì–¸í˜• Fetch Join)

```
@EntityGraph(attributePaths = {"team"})
@Query("SELECT m FROM Member m")
List<Member> findAllWithTeam();
```

â†’ ë³µì¡í•œ Join ì—†ì´ë„, **Fetch Joinê³¼ ê°™ì€ íš¨ê³¼**

------

#### âœ… 3) DTOë¡œ ì§ì ‘ ì¡°íšŒ (ê°€ì¥ ê¶Œì¥)

```
@Query("SELECT new com.example.MemberDto(m.id, m.name, t.name) FROM Member m JOIN m.team t")
List<MemberDto> findAllMemberDto();
```

â†’ **ë¶ˆí•„ìš”í•œ Entity ê°ì²´ ìƒì„± ì—†ì´ ë°”ë¡œ í•„ìš”í•œ í•„ë“œë§Œ ì¡°íšŒ**
 â†’ **ëŒ€ê·œëª¨ í˜ì´ì§€, ë¦¬ìŠ¤íŠ¸ ë·°ì— ë§¤ìš° ì í•©**

------

#### âœ… 4) BatchSize ì„¤ì • (ì»¬ë ‰ì…˜ í•´ê²°ìš©)

**N+1 ë¬¸ì œëŠ” OneToManyì—ì„œë„ ë°œìƒ**
 ì´ë¥¼ ìœ„í•œ í•´ê²° ë°©ë²•:

```
@OneToMany(mappedBy = "member")
@BatchSize(size = 100)
private List<Order> orders;
```

ë˜ëŠ” ì „ì²´ ì„¤ì •:

```
spring.jpa.properties.hibernate.default_batch_fetch_size=100
```

â†’ ì§€ì •ëœ ê°œìˆ˜ë§Œí¼ `IN (...)` ì¿¼ë¦¬ë¡œ ë¬¶ì–´ì„œ ì¡°íšŒ

------

### 5. ì •ë¦¬ ë¹„êµ

| ë°©ë²•          | ì¥ì                                | ë‹¨ì                                  |
| ------------- | ---------------------------------- | ------------------------------------ |
| Fetch Join    | í•œ ë²ˆì˜ ì¿¼ë¦¬ë¡œ ì—°ê´€ ê°ì²´ í•¨ê»˜ ì¡°íšŒ | ë‹¤ì¤‘ ì»¬ë ‰ì…˜ join ì–´ë ¤ì›€              |
| EntityGraph   | ì„ ì–¸ì  ë°©ì‹, ì½”ë“œ ê°€ë…ì„± ë†’ìŒ      | ë³µì¡í•œ ì¡°í•© ì‹œ í•œê³„                  |
| DTO ì§ì ‘ ì¡°íšŒ | ê°€ì¥ ì„±ëŠ¥ ìµœì í™”                   | ì •í˜•í™”ëœ ì¿¼ë¦¬ ì‘ì„± í•„ìš”              |
| BatchSize     | ì»¬ë ‰ì…˜ N+1 ëŒ€ì‘                    | IN ì¿¼ë¦¬ì´ë¯€ë¡œ ê²°ê³¼ê°€ ë©”ëª¨ë¦¬ì— ì§‘ì¤‘ë¨ |

------

### 6. ì‹¤ë¬´ ê¶Œì¥ ì „ëµ

| ìƒí™©                        | ì „ëµ                                |
| --------------------------- | ----------------------------------- |
| ë‹¨ê±´ ì¡°íšŒ                   | LAZY + í•„ìš” ì‹œ Fetch Join           |
| ë¦¬ìŠ¤íŠ¸/í…Œì´ë¸” ì¡°íšŒ          | DTO ì§ì ‘ ì¡°íšŒ                       |
| @OneToMany ë¦¬ìŠ¤íŠ¸ ë°˜ë³µ ì¡°íšŒ | LAZY + BatchSize or QueryDSL        |
| Admin í˜ì´ì§€                | DTO + `JOIN FETCH` or `EntityGraph` |
| í˜ì´ì§• + ì»¬ë ‰ì…˜ Join        | ì ˆëŒ€ Fetch Join âŒ â†’ DTO ë¶„ë¦¬ ì¡°íšŒ   |

------

### 7. íƒì§€ ë°©ë²•

- **Hibernate SQL ë¡œê·¸ í™•ì¸**
- í…ŒìŠ¤íŠ¸ ì‹œ `@Transactional(readOnly = true)`ë¡œ ì¡°íšŒí•˜ê³  **ì¿¼ë¦¬ ìˆ˜ë¥¼ ë¡œê·¸ë¡œ ì¶”ì **
- `p6spy`, `datasource-proxy` í™œìš© ì¶”ì²œ

------

### ê²°ë¡ 

- **N+1 ë¬¸ì œëŠ” ë¬´ì¡°ê±´ í”¼í•´ì•¼ í•  ì„±ëŠ¥ ë¦¬ìŠ¤í¬**
- ëª¨ë“  ì—°ê´€ê´€ê³„ëŠ” **ê¸°ë³¸ LAZY** + **Fetch Join ë˜ëŠ” DTO ì§ì ‘ ì¡°íšŒ** ì „ëµì´ ì•ˆì „í•˜ë‹¤
- **í˜ì´ì§• + Fetch Join**ì€ JPAì—ì„œ ì§€ì›í•˜ì§€ ì•Šìœ¼ë©° **ê²°ê³¼ ì™œê³¡**ì´ ë°œìƒí•  ìˆ˜ ìˆìŒ

## DTO íŒ¨í„´, Projection

Spring Data JPAì—ì„œ **DTO íŒ¨í„´**ê³¼ **Projection**ì€ ì—”í‹°í‹°ë¥¼ ê·¸ëŒ€ë¡œ ë…¸ì¶œí•˜ì§€ ì•Šê³ ,
 **ì™¸ë¶€ì— í•„ìš”í•œ ë°ì´í„°ë§Œ ì¶”ë ¤ì„œ ë°˜í™˜í•˜ê±°ë‚˜ ì„±ëŠ¥ì„ ìµœì í™”**í•˜ëŠ” ë° ë§¤ìš° ì¤‘ìš”í•œ ê¸°ë²•ì´ë‹¤.
 íŠ¹íˆ, API ì‘ë‹µ ì„¤ê³„ë‚˜ ì¿¼ë¦¬ ìµœì í™”ì—ì„œ í•µì‹¬ì ì¸ ì—­í• ì„ í•œë‹¤.

------

### 1. DTO (Data Transfer Object) íŒ¨í„´ì´ë€?

> Entityë¥¼ ì™¸ë¶€ì— ë…¸ì¶œí•˜ì§€ ì•Šê³ , í•„ìš”í•œ í•„ë“œë§Œ ì¶”ë ¤ì„œ ì „ë‹¬í•˜ëŠ” **ì „ìš© ì‘ë‹µ/ìš”ì²­ìš© ê°ì²´**

#### ì‚¬ìš© ëª©ì 

- ë³´ì•ˆì„± (ë¯¼ê° ì •ë³´ ë³´í˜¸)
- ìœ ì—°ì„± (ë·°ë‚˜ APIì— ë”°ë¼ ìœ ë™ì  ì„¤ê³„)
- ìœ ì§€ë³´ìˆ˜ì„± (APIì™€ DB êµ¬ì¡° ë¶„ë¦¬)
- ì„±ëŠ¥ ìµœì í™” (ë¶ˆí•„ìš”í•œ í•„ë“œ ì œì™¸)

------

### 2. DTO íŒ¨í„´ êµ¬ì¡° ì˜ˆì‹œ

#### Entity

```
@Entity
public class Member {
    @Id @GeneratedValue
    private Long id;
    private String name;
    private String email;
    private String password;
}
```

#### DTO

```
@Getter
@AllArgsConstructor
public class MemberDto {
    private Long id;
    private String name;
    private String email;

    public static MemberDto from(Member m) {
        return new MemberDto(m.getId(), m.getName(), m.getEmail());
    }
}
```

#### ì‚¬ìš© ì˜ˆ

```
@GetMapping("/members")
public List<MemberDto> getAll() {
    return memberRepository.findAll().stream()
        .map(MemberDto::from)
        .toList();
}
```

------

### 3. DTO ì§ì ‘ ì¡°íšŒ (JPQL ê¸°ë°˜)

```
@Query("SELECT new com.example.dto.MemberDto(m.id, m.name, m.email) FROM Member m")
List<MemberDto> findAllDto();
```

- `new íŒ¨í‚¤ì§€ëª….í´ë˜ìŠ¤ëª…(...)` í˜•íƒœ
- DTOì— **ìƒì„±ì í•„ìˆ˜**

------

### 4. Interface ê¸°ë°˜ Projection

> JPAê°€ ì¿¼ë¦¬ ê²°ê³¼ë¥¼ Interface êµ¬í˜„ì²´ë¡œ **ìë™ ìƒì„±í•˜ì—¬ ë§¤í•‘**

#### ì¸í„°í˜ì´ìŠ¤ ì •ì˜

```
public interface MemberProjection {
    String getName();
    String getEmail();
}
```

#### Repository ì¿¼ë¦¬

```
List<MemberProjection> findBy();
```

â†’ JPAê°€ ë‚´ë¶€ì ìœ¼ë¡œ Proxyë¥¼ ìƒì„±í•´ì„œ ì¸í„°í˜ì´ìŠ¤ êµ¬í˜„ì²´ë¥¼ ë°˜í™˜

------

### 5. Class ê¸°ë°˜ Projection (Open Projection)

```
public class MemberDto {
    private String name;
    private String email;

    public MemberDto(String name, String email) {
        this.name = name;
        this.email = email;
    }
}
```

```
@Query("SELECT new com.example.MemberDto(m.name, m.email) FROM Member m")
List<MemberDto> findAllBy();
```

------

### 6. ë™ì  Projection

```
<T> List<T> findBy(Class<T> type);
```

ì‚¬ìš© ì˜ˆ:

```
memberRepository.findBy(MemberProjection.class);
memberRepository.findBy(MemberDto.class);
```

------

### 7. Native Query + Projection

Native Queryì—ì„œë„ Interface ê¸°ë°˜ Projection ì‚¬ìš© ê°€ëŠ¥:

```
@Query(value = "SELECT name, email FROM member", nativeQuery = true)
List<MemberProjection> findAllProjection();
```

âš  ë‹¨, í•„ë“œëª…ê³¼ ì¸í„°í˜ì´ìŠ¤ ë©”ì„œë“œëª…ì´ ì •í™•íˆ ì¼ì¹˜í•´ì•¼ í•¨

------

### 8. ì •ë¦¬: DTO vs Projection

| í•­ëª©            | DTO íŒ¨í„´           | Projection             |
| --------------- | ------------------ | ---------------------- |
| ì„ ì–¸ ë°©ì‹       | ë³„ë„ í´ë˜ìŠ¤        | ì¸í„°í˜ì´ìŠ¤ / í´ë˜ìŠ¤    |
| ë°ì´í„° ê°€ê³µ     | ë¡œì§ ê°€ëŠ¥          | ë¶ˆê°€ëŠ¥ (Getterë§Œ ì¡´ì¬) |
| ë³µì¡í•œ ì¿¼ë¦¬     | ìœ ë¦¬               | ë³µì¡ë„ ì¦ê°€ ì‹œ ë¶€ì í•©  |
| Query ì§ì ‘ ë§¤í•‘ | í•„ìš” (`@Query`)    | ìë™ ì¶”ë¡  ê°€ëŠ¥         |
| ì„±ëŠ¥            | íš¨ìœ¨ì  (í•„ë“œ ìµœì†Œ) | ë§¤ìš° íš¨ìœ¨ì             |
| ìœ ì—°ì„±          | ë†’ìŒ               | ì œí•œì                  |

------

### 9. ì‹¤ë¬´ ê°€ì´ë“œ

| ìš©ë„            | ê¶Œì¥ ë°©ë²•                  |
| --------------- | -------------------------- |
| ë‹¨ìˆœ ì¡°íšŒ       | Interface Projection       |
| ê³„ì‚°, ê°€ê³µ í•„ìš” | DTO ê°ì²´ íŒ¨í„´              |
| API ì‘ë‹µ ì „ìš©   | DTO íŒ¨í„´                   |
| ë³µì¡í•œ êµ¬ì¡°     | DTO + JPQL or QueryDSL     |
| Native SQL ì‚¬ìš© | DTO ìƒì„±ì ë˜ëŠ” Projection |

------

### ê²°ë¡ 

- **DTO íŒ¨í„´ì€ API ì‘ë‹µì´ë‚˜ View ëª¨ë¸ì— ìœ ì—°í•˜ê²Œ ëŒ€ì‘**í•  ìˆ˜ ìˆëŠ” **í‘œì¤€ ì„¤ê³„ ì „ëµ**
- **Projectionì€ ì¿¼ë¦¬ ì„±ëŠ¥ ìµœì í™”ì— ë§¤ìš° ìœ ë¦¬**í•˜ì§€ë§Œ, êµ¬ì¡°ê°€ ê³ ì •ë˜ì–´ì•¼ í•˜ë©° ë³µì¡í•œ ì—°ì‚°ì—ëŠ” í•œê³„ê°€ ìˆë‹¤
- ì‹¤ë¬´ì—ì„œëŠ” **Entity ì§ì ‘ ë…¸ì¶œì„ ì§€ì–‘**í•˜ê³ , í•­ìƒ **DTO ë˜ëŠ” Projection ê¸°ë°˜ ì‘ë‹µ ì„¤ê³„**ë¥¼ ì§€í–¥í•˜ëŠ” ê²ƒì´ ì•ˆì •ì ì´ê³  ìœ ì§€ë³´ìˆ˜ì— ìœ ë¦¬í•˜ë‹¤

## QueryDSL, Jooq ê°œìš”

Spring í™˜ê²½ì—ì„œ ë³µì¡í•œ ì¿¼ë¦¬ë¥¼ íƒ€ì… ì•ˆì „í•˜ê³  ìœ ì—°í•˜ê²Œ ì‘ì„±í•  ìˆ˜ ìˆë„ë¡ ë„ì™€ì£¼ëŠ” ëŒ€í‘œì ì¸ ë„êµ¬ëŠ” **QueryDSL**ê³¼ **jOOQ**ì…ë‹ˆë‹¤.
 ë‘ ë„êµ¬ ëª¨ë‘ SQLì„ ìë°” ì½”ë“œë¡œ ì¶”ìƒí™”í•´ì£¼ì§€ë§Œ, **ì² í•™ê³¼ ì‚¬ìš© ë°©ì‹ì´ í¬ê²Œ ë‹¤ë¥´ë©°**
 í”„ë¡œì íŠ¸ íŠ¹ì„±ì— ë”°ë¼ ì ì ˆí•œ ì„ íƒì´ ì¤‘ìš”í•©ë‹ˆë‹¤.

------

### âœ… 1. QueryDSL ê°œìš”

#### ğŸ”¹ ë¬´ì—‡ì¸ê°€?

- **JPQLì„ íƒ€ì… ì•ˆì „í•œ ë°©ì‹ìœ¼ë¡œ ì‘ì„±í•  ìˆ˜ ìˆê²Œ í•´ì£¼ëŠ” DSL (ë„ë©”ì¸ íŠ¹í™” ì–¸ì–´)**
- **JPA ìœ„ì—ì„œ ë™ì‘**í•˜ë©°, JPQLì„ ëŒ€ì‹ í•˜ì—¬ ì‚¬ìš©
- ì½”ë“œ ìë™ ìƒì„± ë„êµ¬ë¥¼ í†µí•´ ì—”í‹°í‹° ì „ìš© Qí´ë˜ìŠ¤ë¥¼ ë§Œë“¤ì–´ ì¿¼ë¦¬ ë¹Œë”©

#### ğŸ”¹ íŠ¹ì§•

| í•­ëª©        | ì„¤ëª…                                              |
| ----------- | ------------------------------------------------- |
| ê¸°ë°˜        | JPA ì—”í‹°í‹°                                        |
| ì–¸ì–´        | Java ì½”ë“œ ê¸°ë°˜ DSL                                |
| ì¥ì         | ì»´íŒŒì¼ ì‹œì  íƒ€ì… ì²´í¬, IDE ìë™ì™„ì„±               |
| ìš©ë„        | ë™ì  ê²€ìƒ‰, ì¡°ê±´ë¶€ ì¡°í•©, ë³µì¡í•œ ì¡°íšŒ ì¿¼ë¦¬          |
| ëŒ€í‘œ í´ë˜ìŠ¤ | `JPAQueryFactory`, `QMember`, `BooleanBuilder` ë“± |

#### ğŸ”¹ ì˜ˆì‹œ ì½”ë“œ

```
QMember m = QMember.member;

List<Member> result = queryFactory
    .selectFrom(m)
    .where(m.age.gt(18).and(m.name.contains("kim")))
    .fetch();
```

â†’ ìœ„ ì½”ë“œëŠ” ë‹¤ìŒ JPQLì„ ëŒ€ì²´:

```
SELECT m FROM Member m WHERE m.age > 18 AND m.name LIKE '%kim%'
```

------

### âœ… 2. jOOQ ê°œìš”

#### ğŸ”¹ ë¬´ì—‡ì¸ê°€?

- **SQL ìì²´ë¥¼ ìë°” ì½”ë“œë¡œ ì™„ì „íˆ í‘œí˜„**í•  ìˆ˜ ìˆë„ë¡ ë§Œë“  DSL
- JPAê°€ ì•„ë‹Œ **SQL ì¤‘ì‹¬** ê°œë°œì„ ì§€í–¥
- JDBC ê¸°ë°˜ìœ¼ë¡œ ì§ì ‘ SQL ì‹¤í–‰ (ì¦‰, **ORM ì•„ë‹˜**)

#### ğŸ”¹ íŠ¹ì§•

| í•­ëª© | ì„¤ëª…                                               |
| ---- | -------------------------------------------------- |
| ê¸°ë°˜ | í…Œì´ë¸”/ë·° ê¸°ë°˜ (DB ìŠ¤í‚¤ë§ˆì—ì„œ ìë™ ì½”ë“œ ìƒì„±)      |
| ì–¸ì–´ | SQL ìŠ¤íƒ€ì¼ DSL (`.select()`, `.where()`)           |
| ì¥ì  | SQL ê¸°ëŠ¥ 100% í™œìš©, DB ë²¤ë”ë³„ ì¿¼ë¦¬ ìµœì í™”          |
| ìš©ë„ | ê³ ì„±ëŠ¥ DB ì—°ì‚°, ë³µì¡í•œ ì¡°ì¸/ì§‘ê³„, í”„ë¡œì‹œì € í˜¸ì¶œ ë“± |
| ë‹¨ì  | JPAì™€ ì—°ë™ ì–´ë ¤ì›€, ê°ì²´ ì¤‘ì‹¬ ë„ë©”ì¸ ëª¨ë¸ ì•„ë‹˜      |

#### ğŸ”¹ ì˜ˆì‹œ ì½”ë“œ

```
DSLContext create = DSL.using(connection, SQLDialect.POSTGRES);

List<Record> result = create.select()
    .from(MEMBER)
    .where(MEMBER.AGE.gt(18))
    .fetch();
```

------

### âœ… 3. QueryDSL vs jOOQ ë¹„êµ

| í•­ëª©        | **QueryDSL**                     | **jOOQ**                          |
| ----------- | -------------------------------- | --------------------------------- |
| ì¤‘ì‹¬ ì² í•™   | ê°ì²´ ì¤‘ì‹¬ (Entity)               | SQL ì¤‘ì‹¬ (í…Œì´ë¸”)                 |
| ë™ì‘ ê¸°ë°˜   | JPA, Hibernate ë“± ORM            | JDBC ì§ì ‘ ì‹¤í–‰                    |
| íƒ€ì… ì•ˆì „   | O                                | O                                 |
| ë³µì¡í•œ ì¿¼ë¦¬ | O (ì¢‹ìŒ)                         | O (ë§¤ìš° ê°•ë ¥)                     |
| DB ì¢…ì†ì„±   | X (JPQL ê¸°ë°˜)                    | O (DB Dialect í•„ìš”)               |
| í˜ì´ì§•      | Pageable ì§€ì› (Spring Data í†µí•©) | ìˆ˜ë™ ì²˜ë¦¬                         |
| ì½”ë“œ ìƒì„±   | ì—”í‹°í‹° ê¸°ë°˜ Qí´ë˜ìŠ¤              | DB ìŠ¤í‚¤ë§ˆ ê¸°ë°˜ POJO               |
| ì‹¤ë¬´ í™œìš©   | ë³µì¡í•œ ì¡°íšŒ/ì¡°ê±´ ê²€ìƒ‰            | ê³ ì„±ëŠ¥ ì§‘ê³„, ë„¤ì´í‹°ë¸Œ ì¿¼ë¦¬ ìµœì í™” |
| Spring í†µí•© | ê°•ë ¥ (Spring Data QueryDSL ì§€ì›) | ë¯¸ì•½ (í†µí•© ìˆ˜ì‘ì—… í•„ìš”)           |

------

### âœ… 4. ì„ íƒ ê¸°ì¤€

| ì¡°ê±´                                   | ì¶”ì²œ           |
| -------------------------------------- | -------------- |
| JPA ê¸°ë°˜ ë„ë©”ì¸ ëª¨ë¸ ì¤‘ì‹¬ ì•„í‚¤í…ì²˜     | âœ… **QueryDSL** |
| ê³ ì„±ëŠ¥ SQL, ë³µì¡í•œ ì§‘ê³„, í”„ë¡œì‹œì € ì‚¬ìš© | âœ… **jOOQ**     |
| API ì„œë²„ + ë™ì  ê²€ìƒ‰ ì¡°ê±´              | âœ… QueryDSL     |
| Data Warehouse, OLAP, ETL              | âœ… jOOQ         |
| SQLì´ ìµìˆ™í•˜ê³  RDBMS ê¸°ëŠ¥ ê·¹ëŒ€í™” ì›í•¨  | âœ… jOOQ         |
| Spring Data JPA ì—°ë™ í¸ì˜ì„± ì¤‘ì‹œ       | âœ… QueryDSL     |

------

### âœ… 5. ê²°ë¡ 

- `**QueryDSL**`ì€ JPAì™€ì˜ í†µí•©ì„±, ë„ë©”ì¸ ì¤‘ì‹¬ ê°œë°œì— ìµœì í™”ëœ ë„êµ¬ì´ë©°, **ì‹¤ë¬´ì—ì„œ ê°€ì¥ ë„ë¦¬ ì‚¬ìš©ë¨**
- `**jOOQ**`ì€ SQLì˜ ëª¨ë“  ê¸°ëŠ¥ì„ Java ì½”ë“œë¡œ í™œìš©í•˜ë ¤ëŠ” **SQL ì¤‘ì‹¬ ê°œë°œìì—ê²Œ ìµœê³ ì˜ ë„êµ¬**
- ë‘˜ ë‹¤ ê°•ë ¥í•˜ì§€ë§Œ ì² í•™ì´ ë‹¤ë¥´ë¯€ë¡œ, **ì•„í‚¤í…ì²˜ ë°©í–¥ê³¼ íŒ€ì˜ ì—­ëŸ‰**ì— ë§ì¶° ì„ íƒí•´ì•¼ í•œë‹¤.